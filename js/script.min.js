var asteroids=[],shots=[],shotCnt=0,spaceship=new Spaceship(xLimit/2,yLimit/2,0,0,0,0,0,0),colors=["#edc951","#eb6841","#cc2a36","#4f372d","#00a0b0"],rocksLrg=["26.087899,1.0434852 49.503787,26.009091 74.220561,2.6541843 96.335572,25.203747 85.278067,50.974686 98.286898,75.940275 62.512619,99.295186 26.087905,100.10053 0.7206885,77.55096 1.3711312,27.619771","27.46638,2.6445482 66.467442,0.98983643 99.048213,24.999426 V 35.822504 L 65.202598,51.325844 98.421452,73.55696 76.484471,97.835645 H 72.723845 L 60.501821,85.842551 27.596351,98.713169 0.95859607,63.02645 1.8987487,25.29194 H 36.997914","14.670645,48.844427 1.9670478,25.614646 27.37424,2.3848478 48.335078,12.875719 73.107033,1.6354928 97.878992,24.865291 75.012591,39.102909 97.878992,60.834007 75.012591,97.552066 39.442599,87.061197 26.739004,99.050766 1.3318868,75.820971"],xLimit=resetWindowLimit("x")-1,yLimit=resetWindowLimit("y")-1,lifeCnt=3,jumpCnt=3,score=0,newLifeTarget=1e4,newLife=newLifeTarget,resetGun=!0,inPlay=!1,mode="asteroids",rockCnt=1,scale=1,rockID=0,ufo=new Ufo(-100,-100,0,0,0,0,200),nextEnemy=Math.floor(1e3*getRandomFloat(10,30)),enemyDelay=2e3,enemyUFO=[],ufoShots=[],ufoShotCnt=0,ufoActive=!1,delta_time=20,turn=0,thrust=0,turn_per_milli=.1,thrust_per_milli=15e-5,key_delay=50,del_v=0,del_vx=0,del_vy=0,shootsnd=null,thrustsnd=null,extraLifesnd=null,ufosnd=null,ufoBulletsnd=null,ufoShootingSpeed=1e3,ufoScale=.1;function animateScreen(t,e){for(var y in console.log("ufoActive: ",ufoActive),$("#scoreCnt span").html(score),$("#lifeCnt span").html(lifeCnt),asteroids){if(asteroids.hasOwnProperty(y))asteroids[y].changePosition(asteroids[y].x+asteroids[y].xv,asteroids[y].y+asteroids[y].yv),"asteroids"==mode&&((asteroids[y].x<=0-asteroids[y].width||asteroids[y].x>=xLimit+asteroids[y].width)&&(asteroids[y].x>=xLimit+asteroids[y].width?asteroids[y].x=-Math.abs(0-asteroids[y].width):asteroids[y].x=xLimit+asteroids[y].width),(asteroids[y].y<=0-asteroids[y].width||asteroids[y].y>=yLimit+asteroids[y].height)&&(asteroids[y].y>=yLimit+asteroids[y].height?asteroids[y].y=-Math.abs(0-asteroids[y].height):asteroids[y].y=yLimit+asteroids[y].height)),1==inPlay&&inCollision(asteroids[y])&&boom();$("#rockAnim"+asteroids[y].id).css("left",asteroids[y].x).css("top",asteroids[y].y)}for(var n in null!=ufo&&void 0!=ufo&&(ufo.changePosition(ufo.x+ufo.vx,ufo.y+ufo.vy),ufo.x>xLimit&&(ufo.x=0),ufo.x<0&&(ufo.x=xLimit),$("#ufoShip").css("left",ufo.x).css("top",ufo.y)),e){var i=10*Math.cos(e[n].theta*Math.PI/180)+e[n].x,x=10*Math.sin(e[n].theta*Math.PI/180)+e[n].y,s=e[n].life-5;e[n].changeLife(s),e[n].life<0?clearBullet("sp",n):(e[n].changePosition(i,x),$("#shot"+e[n].id).css("left",e[n].x).css("top",e[n].y),isHit(e[n])?clearBullet("sp",n):isUfoHit(e[n])&&clearBullet("sp",n))}for(var o in ufoShots){i=10*Math.cos(ufoShots[o].theta*Math.PI/180)+ufoShots[o].x,x=10*Math.sin(ufoShots[o].theta*Math.PI/180)+ufoShots[o].y,s=ufoShots[o].life-5;ufoShots[o].changeLife(s),ufoShots[o].life<0?clearBullet("ufo",o):(ufoShots[o].changePosition(i,x),console.log(o,ufoShots[o].id),$("#ufoshot"+ufoShots[o].id).css("left",ufoShots[o].x).css("top",ufoShots[o].y),isHit(ufoShots[o])&&(clearBullet("ufo",o),console.log("hit")))}moveSpaceship(delta_time),updateSpaceship(delta_time)}function inCollision(t){var e=spaceship,y=t;return!(e.y+e.height<y.y||e.y>y.y+y.height||e.x+e.width<y.x||e.x>y.x+y.width)}function isHit(t){var e=asteroids,y=t;for(i=0;i<e.length;i++)if(0==(e[i].y+e[i].height<y.y||e[i].y>y.y+y.height||e[i].x+e[i].width<y.x||e[i].x>y.x+y.width))return blowupAsteroid(e[i],i),!0}function isUfoHit(t){var e=ufo,y=t;if(0==(e.y+e.height<y.y||e.y>y.y+y.height||e.x+e.width<y.x||e.x>y.x+y.width))return blowupUfo(e,i),ufoActive=!1,!0}function blowupUfo(t,e){$("#sndAstroBoom").get(0).pause(),$("#sndAstroBoom").get(0).currentTime=0,$("#sndAstroBoom").get(0).play(),$("#ufoShip").remove(),pointCnt(t.points),ufo.x=-200,ufo.y=-200,ufo.vx=0,ufo.vy=0,spawnEnemy(nextEnemy=Math.floor(1e3*getRandomFloat(10,30)))}function spawnEnemy(t){setTimeout(function(){makeUFO(!0)},t)}function makeUFO(t){ufoActive=t;console.log("enemy ship");var e=Math.random()<.5?-1:1;ufo.x=e>0?0-ufo.width:xLimit+ufo.width,ufo.y=getRandomFloat(0,yLimit),ufo.vx=getRandomFloat(1,5)*e,$("body").append("<svg id='ufoShip' class='ufo'><polygon transform='scale(0.1, 0.1)'  id='myPolygon' stroke='#ffffff'   stroke-width='15' points='466.697 275.189, 350.500 226.628, 329.099 170.984, 294.919 147.509, 242.500 147.509, 242.500 112.989, 235.000 105.489, 227.500 112.989, 227.500 147.509, 175.081 147.509, 140.901 170.984, 119.500 226.628, 3.303 275.189, 0.000 281.405, 3.303 287.621, 106.027 332.782, 143.504 364.510, 326.496 364.510, 363.973 332.782, 466.697 287.621, 470.000 281.405, 466.697 275.189'></svg>"),$("#ufoShip").css("width",ufo.width).css("height",ufo.height);var y=setInterval(function(){if(1==ufoActive){ufoShotCnt++;var t=180*-Math.atan2(ufo.y-spaceship.y,ufo.x-spaceship.x)/Math.PI;console.log("shooting: ",t),ufoShots.push(new Shot(ufoShotCnt,ufo.x,ufo.y,ufo.vx,ufo.vy,t,ufo.yaw,1800,0,0)),ufoBulletsnd.play(),$("body").append("<svg id='ufoshot"+ufoShotCnt+"' data-id='"+ufoShotCnt+"' class='ufoshot' height='8' width='8'><circle cx='3' cy='3' r='3' stroke='white' stroke-width='2' fill='green' /></svg>")}else console.log("clearing"),clearInterval(y)},ufoShootingSpeed)}function makeShot(){shotCnt++,shots.push(new Shot(shotCnt,spaceship.x,spaceship.y,spaceship.vx,spaceship.vy,spaceship.theta,spaceship.yaw,1800,0,0)),$("body").append("<svg id='shot"+shotCnt+"' data-id='"+shotCnt+"' class='shot' height='6' width='6'><circle cx='3' cy='3' r='3' stroke='white' stroke-width='2' fill='red' /></svg>")}function Intersection(t){arguments.length>0&&this.init(t)}function Asteroid(t,e,y,n,i,x,s,o,r,a,c,l,h){this.id=t,this.title=e,this.width=y,this.height=n,this.x=i,this.y=x,this.xv=s,this.yv=o,this.color=r,this.type=a,this.oob=c,this.points=l,this.gravity=.1,this.gravitySpeed=0,this.bounce=.4,this.exists=!0,this.resetGravity=function(){},this.newPos=function(){this.gravitySpeed+=this.gravity,this.x+=this.xvel;var t=this.yv;this.yv<0&&(t=0),t=0,this.y+=t+this.gravitySpeed,this.hitBottom()},this.hitBottom=function(){var t=window.innerHeight-this.height;this.y>t&&(this.x=t,this.gravitySpeed=-this.gravitySpeed*this.bounce),this.x>window.innerWidth+this.width&&(this.x=0-this.width),this.x<0-this.width&&(this.x=window.innerWidth+this.width)},this.changeColor=function(t){this.color=t},this.oob=function(t){this.oob=t},this.changeVelocity=function(t,e){"x"==t&&(this.xv=e),"y"==t&&(this.yv=e)},this.changePosition=function(t,e){this.x=t,this.y=e},this.getVelocity=function(t){return this.direction},this.changeExistance=function(t){this.exists=t}}function Spaceship(t,e,y,n,i,x,s,o){this.x=t,this.y=e,this.vx=y,this.vy=n,this.theta=i,this.width=20,this.height=15,this.yaw=x,this.x_points=s,this.y_points=o,this.shape="14.383032,5.9181762 0.35137621,0.04626516 2.7568063,5.9181762 0.35137621,11.338401"}function Shot(t,e,y,n,i,x,s,o,r,a){this.id=t,this.x=e,this.y=y,this.vx=n,this.vy=i,this.theta=x,this.width=6,this.height=6,this.yaw=s,this.life=o,this.x_points=r,this.y_points=a,this.changePosition=function(t,e){this.x=t,this.y=e},this.changeLife=function(t){this.life=t}}function Sound(t){this.sound=document.createElement("audio"),this.sound.src=t,this.sound.setAttribute("preload","auto"),this.sound.setAttribute("controls","none"),this.sound.style.display="none",document.body.appendChild(this.sound),this.play=function(){this.sound.play()},this.stop=function(){this.sound.pause()}}function Ufo(t,e,y,n,i,x,s){this.x=t,this.y=e,this.vx=y,this.vy=n,this.theta=i,this.width=52,this.height=42,this.yaw=x,this.points=s,this.changePosition=function(t,e){this.x=t,this.y=e}}function resetWindowLimit(t){var e,y,n;if(y=window.innerHeight,n=window.innerHeight,"x"==t)for(e=window.innerWidth,i=0;i<asteroids.length;i++)asteroids[i].x>=y-asteroids[i].width&&asteroids[i].changePosition(y-asteroids[i].width,n-asteroids[i].height);else for(e=window.innerHeight,i=0;i<asteroids.length;i++)asteroids[i].y>=n-asteroids[i].height&&asteroids[i].changePosition(y-asteroids[i].width,e-asteroids[i].height);return e}function getRandomFloat(t,e){return Math.random()*(e-t)+t}function getSafeRandomFloat(t,e){var y=t+e/2,n=0;return Math.random()*(e-t)+t>=y&&(n=e),n}function clearBullet(t,e){"ufo"==t?($("#ufoshot"+ufoShots[e].id).remove(),ufoShots.splice(e,1)):($("#shot"+shots[e].id).remove(),shots.splice(e,1))}function moveSpaceship(t){var e=Math.PI/180;0!=turn&&void 0!=turn?(spaceship.theta=spaceship.theta+turn*turn_per_milli*t,lifeCnt>0&&$("#sndTurn").get(0).play()):($("#sndTurn").get(0).pause(),$("#sndTurn").get(0).currentTime=0),0!=thrust&&void 0!=thrust?(del_vx=(del_v=thrust*thrust_per_milli*t)*Math.cos(spaceship.theta*e),del_vy=del_v*Math.sin(spaceship.theta*e),lifeCnt>0&&thrustsnd.play()):(del_vx=0,del_vy=0,thrustsnd.stop()),spaceship.vx=spaceship.vx+del_vx,spaceship.vy=spaceship.vy+del_vy}function updateSpaceship(t){spaceship.x>=xLimit&&(spaceship.x=0),spaceship.x<0&&(spaceship.x=xLimit),spaceship.y>=yLimit&&(spaceship.y=0),spaceship.y<0&&(spaceship.y=yLimit),spaceship.theta+=spaceship.yaw*t,spaceship.x+=spaceship.vx*t,spaceship.y+=spaceship.vy*t,$("#spaceship").css("left",spaceship.x).css("top",spaceship.y).css({transform:"rotate("+spaceship.theta+"deg)"})}function hyperspace(){lifeCnt>0&&1==inPlay&&(jumpCnt>0?($("#sndHyperspace").get(0).currentTime=0,$("#sndHyperspace").get(0).play(),spaceship.x=getRandomFloat(1,xLimit-5),spaceship.y=getRandomFloat(1,yLimit-5),spaceship.vx=0,spaceship.vy=0,jumpCnt--,$("#HSCnt span").html(jumpCnt)):$("#sndHyperspaceFail").get(0).play())}function isPointInPoly(t,e){for(var y=!1,n=-1,i=t.length,x=i-1;++n<i;x=n)(t[n].y<=e.y&&e.y<t[x].y||t[x].y<=e.y&&e.y<t[n].y)&&e.x<(t[x].x-t[n].x)*(e.y-t[n].y)/(t[x].y-t[n].y)+t[n].x&&(y=!y);return y}function resetSpaceship(){lifeCnt>0?($("#spaceship").show(),spaceship=new Spaceship(xLimit/2,yLimit/2,0,0,-90,0,0,0),inPlay=!0):(inPlay=!1,$("#spaceship").hide(),$("#gameOverBoard").css("display","block"),checkHighScoreCookie())}function pewpew(){lifeCnt>0&&1==resetGun&&1==inPlay&&(shootsnd.play(),makeShot(),resetGun=!1)}function resetgame(){$("#gameOverBoard").hide(),$(".asteroid").remove(),lifeCnt=3,jumpCnt=3,score=0,asteroids=[],regenerateAsteroids(),$("body").append("<svg id='spaceship' class=''><path cx='5' cy='5' r='10' stroke='#ffffff' stroke-width='2' d='M "+spaceship.shape+" Z'  id='outerShip' /></svg>"),$("#lifeCnt span").html(lifeCnt),$("#HSCnt span").html(jumpCnt),resetSpaceship()}function regenerateAsteroids(){for(i=0;i<rockCnt;i++)rockID++,thisRockSize=100,asteroids.push(new Asteroid(rockID,"test",thisRockSize,thisRockSize,getSafeRandomFloat(0,xLimit-150),getSafeRandomFloat(0,yLimit-150),getRandomFloat(-3,3),getRandomFloat(-3,3),colors[Math.floor(getRandomFloat(0,5))],"generic",!1,20,!0));for(var t in asteroids)asteroids.hasOwnProperty(t)&&($("body").append("<svg id='rockAnim"+asteroids[t].id+"' data-id='"+asteroids[t].id+"' class='asteroid rocksize100'><path cx='"+asteroids[t].width+"' cy='"+asteroids[t].height+"' r='"+(asteroids[t].width/2-5)+"' stroke='"+asteroids[t].color+"' stroke-width='2' d='M "+rocksLrg[Math.floor(getRandomFloat(0,3))]+" Z'  id='astroPath"+asteroids[t].id+"' /><text x='20' y='55' fill='"+asteroids[t].color+"'></text></svg>"),$("#rockAnim"+asteroids[t].id).css("color",asteroids[t].color).css("border-color",asteroids[t].color).css("width",asteroids[t].width).css("height",asteroids[t].height).addClass("rockAnim"))}function blowupAsteroid(t,e){$("#sndAstroBoom").get(0).pause(),$("#sndAstroBoom").get(0).currentTime=0,$("#sndAstroBoom").get(0).play();var y=t;pointCnt(t.points),y.height>25&&makeAsteroidPieces(y.x,y.y,y.height/2,2),$("#rockAnim"+y.id).remove(),asteroids.splice(e,1),0==asteroids.length&&regenerateAsteroids()}function pointCnt(t){score+=t,(newLife-=t)<0&&(lifeCnt++,newLife=newLifeTarget+newLife,playExtraLife())}function safeSpawn(){var t=asteroids,e=spaceship;for(i=0;i<t.length;i++)if(0==(t[i].y+t[i].height<e.y-50||t[i].y>e.y+e.height+50||t[i].x+t[i].width<e.x+50||t[i].x>e.x+e.width+50))return!0}function boom(){$("#spaceship").hide(),inPlay=!1,ufoActive=!1,$("#sndBoom").get(0).play(),lifeCnt>0&&(lifeCnt--,$("#lifeCnt span").html(lifeCnt),jumpCnt=3,$("#HSCnt span").html(jumpCnt),setTimeout(function(){resetSpaceship()},3e3))}function playExtraLife(){for(i=0;i<9;i++)setTimeout(function(){extraLifesnd.play()},500)}function checkPathTouch(t){var e=spaceship,y=t,n=[],x=[];for(i=0;i<e.getTotalLength();i+=1)n.push(e.getPointAtLength(i));for(i=0;i<y.getTotalLength();i+=1)x.push(y.getPointAtLength(i));for(i=0;i<n.length;i++){var s=Math.floor(n[i].x),o=Math.floor(n[i].y);for(j=0;j<x.length;j++)if(s==Math.floor(x[j].x)&&o==Math.floor(x[j].y)){console.log(Math.floor(x[j].x)+"- "+Math.floor(x[j].y)),boom();break}}}function makeAsteroidPieces(t,e,y,n){for(i=0;i<n;i++){switch(rockID++,thisRockSize=y,y){case 100:scale="1",maxVel=3,rockPnt=20;break;case 50:scale=".5",maxVel=4,rockPnt=50;break;case 25:scale=".25",maxVel=5,rockPnt=100}asteroids.push(new Asteroid(rockID,"test",thisRockSize,thisRockSize,t,e,getRandomFloat(-Math.abs(maxVel),maxVel),getRandomFloat(-Math.abs(maxVel),maxVel),colors[Math.floor(getRandomFloat(0,5))],"generic",!1,rockPnt,!0)),$("body").append("<svg id='rockAnim"+asteroids[asteroids.length-1].id+"' data-id='"+asteroids[asteroids.length-1].id+"' class='asteroid rocksize"+y+"'><path cx='"+asteroids[asteroids.length-1].width+"' cy='"+asteroids[asteroids.length-1].height+"' r='"+(asteroids[asteroids.length-1].width/2-5)+"' stroke='"+asteroids[asteroids.length-1].color+"' stroke-width='2' d='M "+rocksLrg[Math.floor(getRandomFloat(0,3))]+" Z'  id='astroPath"+asteroids[asteroids.length-1].id+"' transform='scale("+scale+", "+scale+")' /><text x='20' y='55' fill='"+asteroids[asteroids.length-1].color+"' transform='scale("+scale+", "+scale+")></text></svg>"),$("#rockAnim"+asteroids[asteroids.length-1].id).css("color",asteroids[asteroids.length-1].color).css("border-color",asteroids[asteroids.length-1].color).css("width",asteroids[asteroids.length-1].width).css("height",asteroids[asteroids.length-1].height).addClass("rockAnim")}}function setCookie(t,e,y){var n=new Date;n.setTime(n.getTime()+24*y*60*60*1e3);var i="expires="+n.toUTCString();document.cookie=t+"="+e+";"+i+";path=/"}function getCookie(t){for(var e=t+"=",y=document.cookie.split(";"),n=0;n<y.length;n++){for(var i=y[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return""}function checkHighScoreCookie(){var t=getCookie("highScore");""!=t?setCookie("highScore",score,1e3):t<=score&&setCookie("highScore",score,1e3)}$(document).ready(function(){shootsnd=new Sound("snd/fire.mp3"),thrustsnd=new Sound("snd/thrust.mp3"),extraLifesnd=new Sound("snd/extraShip.ogg"),ufosnd=new Sound("snd/saucerBig.mp3"),ufoBulletsnd=new Sound("snd/laser.mp3"),resetgame(),xLimit>768&&(inPlay=!1,$("#welcomeModel").modal("show"),$("#welcomeModel").on("hidden.bs.modal",function(t){inPlay=!0,$("*").css("cursor","none"),spawnEnemy(nextEnemy)}));setInterval(function(){animateScreen(asteroids,shots)},delta_time)}),Intersection.prototype.init=function(t){this.status=t,this.points=new Array},Intersection.prototype.appendPoint=function(t){this.points.push(t)},Intersection.prototype.appendPoints=function(t){this.points=this.points.concat(t)},Intersection.intersectShapes=function(t,e){var y,n=t.getIntersectionParams(),i=e.getIntersectionParams();if(null!=n&&null!=i)if("Path"==n.name)y=Intersection.intersectPathShape(t,e);else if("Path"==i.name)y=Intersection.intersectPathShape(e,t);else{var x,s;if(n.name<i.name?(x="intersect"+n.name+i.name,s=n.params.concat(i.params)):(x="intersect"+i.name+n.name,s=i.params.concat(n.params)),!(x in Intersection))throw new Error("Intersection not available: "+x);y=Intersection[x].apply(null,s)}else y=new Intersection("No Intersection");return y},Intersection.intersectPathShape=function(t,e){return t.intersectShape(e)},Intersection.intersectBezier2Bezier2=function(t,e,y,n,i,x){var s,o,r,a,c,l,h,p,d,u=new Intersection("No Intersection");if(s=e.multiply(-2),r=t.add(s.add(y)),s=t.multiply(-2),o=e.multiply(2),a=s.add(o),c=new Point2D(t.x,t.y),s=i.multiply(-2),l=n.add(s.add(x)),s=n.multiply(-2),o=i.multiply(2),h=s.add(o),p=new Point2D(n.x,n.y),0==r.y){var f=(g=r.x*(c.y-p.y))+(w=g-a.x*a.y),m=a.y*a.y;d=new Polynomial(r.x*l.y*l.y,2*r.x*h.y*l.y,r.x*h.y*h.y-l.x*m-l.y*g-l.y*w,-h.x*m-h.y*g-h.y*w,(c.x-p.x)*m+(c.y-p.y)*w)}else{var g=r.x*l.y-r.y*l.x,w=r.x*h.y-h.x*r.y,I=(f=a.x*r.y-a.y*r.x,m=c.y-p.y,r.y*(c.x-p.x)-r.x*m),v=-a.y*f+r.y*I,P=f*f;d=new Polynomial(g*g,2*g*w,(-l.y*P+r.y*w*w+r.y*g*I+g*v)/r.y,(-h.y*P+r.y*w*I+w*v)/r.y,(m*P+I*v)/r.y)}for(var L=d.getRoots(),S=0;S<L.length;S++){var k=L[S];if(0<=k&&k<=1){var b=new Polynomial(r.x,a.x,c.x-p.x-k*h.x-k*k*l.x).getRoots(),C=new Polynomial(r.y,a.y,c.y-p.y-k*h.y-k*k*l.y).getRoots();if(b.length>0&&C.length>0){t:for(var D=0;D<b.length;D++){var R=b[D];if(0<=R&&R<=1)for(var $=0;$<C.length;$++)if(Math.abs(R-C[$])<1e-4){u.points.push(l.multiply(k*k).add(h.multiply(k).add(p)));break t}}}}}return u.points.length>0&&(u.status="Intersection"),u},Intersection.intersectBezier2Bezier3=function(t,e,y,n,i,x,s){var o,r,a,c,l,h,p,d,u,f,m,g=new Intersection("No Intersection");o=e.multiply(-2),l=t.add(o.add(y)),o=t.multiply(-2),r=e.multiply(2),h=o.add(r),p=new Point2D(t.x,t.y),o=n.multiply(-1),r=i.multiply(3),a=x.multiply(-3),c=o.add(r.add(a.add(s))),d=new Vector2D(c.x,c.y),o=n.multiply(3),r=i.multiply(-6),a=x.multiply(3),c=o.add(r.add(a)),u=new Vector2D(c.x,c.y),o=n.multiply(-3),r=i.multiply(3),a=o.add(r),f=new Vector2D(a.x,a.y),m=new Vector2D(n.x,n.y);for(var w=p.x*p.x,I=p.y*p.y,v=h.x*h.x,P=h.y*h.y,L=l.x*l.x,S=l.y*l.y,k=m.x*m.x,b=m.y*m.y,C=f.x*f.x,D=f.y*f.y,R=u.x*u.x,$=u.y*u.y,B=d.x*d.x,M=d.y*d.y,z=new Polynomial(-2*l.x*l.y*d.x*d.y+L*M+S*B,-2*l.x*l.y*u.x*d.y-2*l.x*l.y*u.y*d.x+2*S*u.x*d.x+2*L*u.y*d.y,-2*l.x*f.x*l.y*d.y-2*l.x*l.y*f.y*d.x-2*l.x*l.y*u.x*u.y+2*f.x*S*d.x+S*R+L*(2*f.y*d.y+$),2*p.x*l.x*l.y*d.y+2*p.y*l.x*l.y*d.x+h.x*h.y*l.x*d.y+h.x*h.y*l.y*d.x-2*m.x*l.x*l.y*d.y-2*l.x*m.y*l.y*d.x-2*l.x*f.x*l.y*u.y-2*l.x*l.y*f.y*u.x-2*p.x*S*d.x-2*p.y*L*d.y+2*m.x*S*d.x+2*f.x*S*u.x-P*l.x*d.x-v*l.y*d.y+L*(2*m.y*d.y+2*f.y*u.y),2*p.x*l.x*l.y*u.y+2*p.y*l.x*l.y*u.x+h.x*h.y*l.x*u.y+h.x*h.y*l.y*u.x-2*m.x*l.x*l.y*u.y-2*l.x*m.y*l.y*u.x-2*l.x*f.x*l.y*f.y-2*p.x*S*u.x-2*p.y*L*u.y+2*m.x*S*u.x-P*l.x*u.x-v*l.y*u.y+C*S+L*(2*m.y*u.y+D),2*p.x*l.x*l.y*f.y+2*p.y*l.x*f.x*l.y+h.x*h.y*l.x*f.y+h.x*h.y*f.x*l.y-2*m.x*l.x*l.y*f.y-2*l.x*m.y*f.x*l.y-2*p.x*f.x*S-2*p.y*L*f.y+2*m.x*f.x*S-P*l.x*f.x-v*l.y*f.y+2*L*m.y*f.y,-2*p.x*p.y*l.x*l.y-p.x*h.x*h.y*l.y-p.y*h.x*h.y*l.x+2*p.x*l.x*m.y*l.y+2*p.y*m.x*l.x*l.y+h.x*m.x*h.y*l.y+h.x*h.y*l.x*m.y-2*m.x*l.x*m.y*l.y-2*p.x*m.x*S+p.x*P*l.x+p.y*v*l.y-2*p.y*L*m.y-m.x*P*l.x-v*m.y*l.y+w*S+I*L+k*S+L*b).getRootsInInterval(0,1),A=0;A<z.length;A++){var V=z[A],E=new Polynomial(l.x,h.x,p.x-m.x-V*f.x-V*V*u.x-V*V*V*d.x).getRoots(),_=new Polynomial(l.y,h.y,p.y-m.y-V*f.y-V*V*u.y-V*V*V*d.y).getRoots();if(E.length>0&&_.length>0){t:for(var F=0;F<E.length;F++){var N=E[F];if(0<=N&&N<=1)for(var H=0;H<_.length;H++)if(Math.abs(N-_[H])<1e-4){g.points.push(d.multiply(V*V*V).add(u.multiply(V*V).add(f.multiply(V).add(m))));break t}}}}return g.points.length>0&&(g.status="Intersection"),g},Intersection.intersectBezier2Circle=function(t,e,y,n,i){return Intersection.intersectBezier2Ellipse(t,e,y,n,i,i)},Intersection.intersectBezier2Ellipse=function(t,e,y,n,i,x){var s,o,r,a,c,l=new Intersection("No Intersection");s=e.multiply(-2),r=t.add(s.add(y)),s=t.multiply(-2),o=e.multiply(2),a=s.add(o),c=new Point2D(t.x,t.y);for(var h=i*i,p=x*x,d=new Polynomial(p*r.x*r.x+h*r.y*r.y,2*(p*r.x*a.x+h*r.y*a.y),p*(2*r.x*c.x+a.x*a.x)+h*(2*r.y*c.y+a.y*a.y)-2*(p*n.x*r.x+h*n.y*r.y),2*(p*a.x*(c.x-n.x)+h*a.y*(c.y-n.y)),p*(c.x*c.x+n.x*n.x)+h*(c.y*c.y+n.y*n.y)-2*(p*n.x*c.x+h*n.y*c.y)-h*p).getRoots(),u=0;u<d.length;u++){var f=d[u];0<=f&&f<=1&&l.points.push(r.multiply(f*f).add(a.multiply(f).add(c)))}return l.points.length>0&&(l.status="Intersection"),l},Intersection.intersectBezier2Line=function(t,e,y,n,i){var x,s,o,r,a,c,l,h=n.min(i),p=n.max(i),d=new Intersection("No Intersection");x=e.multiply(-2),o=t.add(x.add(y)),x=t.multiply(-2),s=e.multiply(2),r=x.add(s),a=new Point2D(t.x,t.y),l=new Vector2D(n.y-i.y,i.x-n.x),c=n.x*i.y-i.x*n.y,roots=new Polynomial(l.dot(o),l.dot(r),l.dot(a)+c).getRoots();for(var u=0;u<roots.length;u++){var f=roots[u];if(0<=f&&f<=1){var m=t.lerp(e,f),g=e.lerp(y,f),w=m.lerp(g,f);n.x==i.x?h.y<=w.y&&w.y<=p.y&&(d.status="Intersection",d.appendPoint(w)):n.y==i.y?h.x<=w.x&&w.x<=p.x&&(d.status="Intersection",d.appendPoint(w)):w.gte(h)&&w.lte(p)&&(d.status="Intersection",d.appendPoint(w))}}return d},Intersection.intersectBezier2Polygon=function(t,e,y,n){for(var i=new Intersection("No Intersection"),x=n.length,s=0;s<x;s++){var o=n[s],r=n[(s+1)%x],a=Intersection.intersectBezier2Line(t,e,y,o,r);i.appendPoints(a.points)}return i.points.length>0&&(i.status="Intersection"),i},Intersection.intersectBezier2Rectangle=function(t,e,y,n,i){var x=n.min(i),s=n.max(i),o=new Point2D(s.x,x.y),r=new Point2D(x.x,s.y),a=Intersection.intersectBezier2Line(t,e,y,x,o),c=Intersection.intersectBezier2Line(t,e,y,o,s),l=Intersection.intersectBezier2Line(t,e,y,s,r),h=Intersection.intersectBezier2Line(t,e,y,r,x),p=new Intersection("No Intersection");return p.appendPoints(a.points),p.appendPoints(c.points),p.appendPoints(l.points),p.appendPoints(h.points),p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectBezier3Bezier3=function(t,e,y,n,i,x,s,o){var r,a,c,l,h,p,d,u,f,m,g,w,I=new Intersection("No Intersection");r=t.multiply(-1),a=e.multiply(3),c=y.multiply(-3),l=r.add(a.add(c.add(n))),h=new Vector2D(l.x,l.y),r=t.multiply(3),a=e.multiply(-6),c=y.multiply(3),l=r.add(a.add(c)),p=new Vector2D(l.x,l.y),r=t.multiply(-3),a=e.multiply(3),c=r.add(a),d=new Vector2D(c.x,c.y),u=new Vector2D(t.x,t.y),r=i.multiply(-1),a=x.multiply(3),c=s.multiply(-3),l=r.add(a.add(c.add(o))),f=new Vector2D(l.x,l.y),r=i.multiply(3),a=x.multiply(-6),c=s.multiply(3),l=r.add(a.add(c)),m=new Vector2D(l.x,l.y),r=i.multiply(-3),a=x.multiply(3),c=r.add(a),g=new Vector2D(c.x,c.y),w=new Vector2D(i.x,i.y);for(var v=u.x*u.x,P=u.x*u.x*u.x,L=u.y*u.y,S=u.y*u.y*u.y,k=d.x*d.x,b=d.x*d.x*d.x,C=d.y*d.y,D=d.y*d.y*d.y,R=p.x*p.x,$=p.x*p.x*p.x,B=p.y*p.y,M=p.y*p.y*p.y,z=h.x*h.x,A=h.x*h.x*h.x,V=h.y*h.y,E=h.y*h.y*h.y,_=w.x*w.x,F=w.x*w.x*w.x,N=w.y*w.y,H=w.y*w.y*w.y,T=g.x*g.x,j=g.x*g.x*g.x,O=g.y*g.y,U=m.x*m.x,W=m.x*m.x*m.x,G=m.y*m.y,q=f.x*f.x,Z=f.x*f.x*f.x,J=f.y*f.y,K=f.y*f.y*f.y,Q=new Polynomial(-A*K+E*Z-3*h.x*V*q*f.y+3*z*h.y*f.x*J,-6*h.x*m.x*V*f.x*f.y+6*z*h.y*m.y*f.x*f.y+3*m.x*E*q-3*A*m.y*J-3*h.x*V*m.y*q+3*z*m.x*h.y*J,-6*g.x*h.x*V*f.x*f.y-6*h.x*m.x*V*m.y*f.x+6*z*m.x*h.y*m.y*f.y+3*g.x*E*q+3*U*E*f.x+3*g.x*z*h.y*J-3*h.x*g.y*V*q-3*h.x*U*V*f.y+z*h.y*f.x*(6*g.y*f.y+3*G)+A*(-g.y*J-2*G*f.y-f.y*(2*g.y*f.y+G)),d.x*p.y*h.x*h.y*f.x*f.y-d.y*p.x*h.x*h.y*f.x*f.y+6*g.x*m.x*E*f.x+3*d.x*p.x*h.x*h.y*J+6*u.x*h.x*V*f.x*f.y-3*d.x*p.x*V*f.x*f.y-3*d.y*p.y*h.x*h.y*q-6*u.y*z*h.y*f.x*f.y-6*w.x*h.x*V*f.x*f.y+3*d.y*p.y*z*f.x*f.y-2*p.x*B*h.x*f.x*f.y-6*g.x*h.x*m.x*V*f.y-6*g.x*h.x*V*m.y*f.x-6*h.x*g.y*m.x*V*f.x+6*g.x*z*h.y*m.y*f.y+2*R*p.y*h.y*f.x*f.y+W*E-3*u.x*E*q+3*u.y*A*J+3*w.x*E*q+M*h.x*q-$*h.y*J-3*u.x*z*h.y*J+3*u.y*h.x*V*q-2*d.x*p.y*z*J+d.x*p.y*V*q-d.y*p.x*z*J+2*d.y*p.x*V*q+3*w.x*z*h.y*J-p.x*B*h.y*q-3*w.y*h.x*V*q+R*p.y*h.x*J-3*h.x*U*V*m.y+z*h.y*f.x*(6*w.y*f.y+6*g.y*m.y)+z*m.x*h.y*(6*g.y*f.y+3*G)+A*(-2*g.y*m.y*f.y-w.y*J-m.y*(2*g.y*f.y+G)-f.y*(2*w.y*f.y+2*g.y*m.y)),6*d.x*p.x*h.x*h.y*m.y*f.y+d.x*p.y*h.x*m.x*h.y*f.y+d.x*p.y*h.x*h.y*m.y*f.x-d.y*p.x*h.x*m.x*h.y*f.y-d.y*p.x*h.x*h.y*m.y*f.x-6*d.y*p.y*h.x*m.x*h.y*f.x-6*u.x*m.x*E*f.x+6*w.x*m.x*E*f.x+6*u.y*A*m.y*f.y+2*M*h.x*m.x*f.x-2*$*h.y*m.y*f.y+6*u.x*h.x*m.x*V*f.y+6*u.x*h.x*V*m.y*f.x+6*u.y*h.x*m.x*V*f.x-3*d.x*p.x*m.x*V*f.y-3*d.x*p.x*V*m.y*f.x+2*d.x*p.y*m.x*V*f.x+4*d.y*p.x*m.x*V*f.x-6*u.x*z*h.y*m.y*f.y-6*u.y*z*m.x*h.y*f.y-6*u.y*z*h.y*m.y*f.x-4*d.x*p.y*z*m.y*f.y-6*w.x*h.x*m.x*V*f.y-6*w.x*h.x*V*m.y*f.x-2*d.y*p.x*z*m.y*f.y+3*d.y*p.y*z*m.x*f.y+3*d.y*p.y*z*m.y*f.x-2*p.x*B*h.x*m.x*f.y-2*p.x*B*h.x*m.y*f.x-2*p.x*B*m.x*h.y*f.x-6*w.y*h.x*m.x*V*f.x-6*g.x*h.x*g.y*V*f.x-6*g.x*h.x*m.x*V*m.y+6*w.x*z*h.y*m.y*f.y+2*R*p.y*h.x*m.y*f.y+2*R*p.y*m.x*h.y*f.y+2*R*p.y*h.y*m.y*f.x+3*g.x*U*E+3*T*E*f.x-3*h.x*g.y*U*V-3*T*h.x*V*f.y+z*m.x*h.y*(6*w.y*f.y+6*g.y*m.y)+z*h.y*f.x*(6*w.y*m.y+3*O)+g.x*z*h.y*(6*g.y*f.y+3*G)+A*(-2*w.y*m.y*f.y-f.y*(2*w.y*m.y+O)-g.y*(2*g.y*f.y+G)-m.y*(2*w.y*f.y+2*g.y*m.y)),d.x*g.x*p.y*h.x*h.y*f.y+d.x*p.y*h.x*g.y*h.y*f.x+d.x*p.y*h.x*m.x*h.y*m.y-d.y*p.x*g.x*h.x*h.y*f.y-d.y*p.x*h.x*g.y*h.y*f.x-d.y*p.x*h.x*m.x*h.y*m.y-6*d.y*g.x*p.y*h.x*h.y*f.x-6*u.x*g.x*E*f.x+6*w.x*g.x*E*f.x+2*g.x*M*h.x*f.x+6*u.x*g.x*h.x*V*f.y+6*u.x*h.x*g.y*V*f.x+6*u.x*h.x*m.x*V*m.y+6*u.y*g.x*h.x*V*f.x-3*d.x*p.x*g.x*V*f.y-3*d.x*p.x*g.y*V*f.x-3*d.x*p.x*m.x*V*m.y+2*d.x*g.x*p.y*V*f.x+4*d.y*p.x*g.x*V*f.x-6*u.y*g.x*z*h.y*f.y-6*u.y*z*g.y*h.y*f.x-6*u.y*z*m.x*h.y*m.y-6*w.x*g.x*h.x*V*f.y-6*w.x*h.x*g.y*V*f.x-6*w.x*h.x*m.x*V*m.y+3*d.y*g.x*p.y*z*f.y-3*d.y*p.y*h.x*U*h.y+3*d.y*p.y*z*g.y*f.x+3*d.y*p.y*z*m.x*m.y-2*p.x*g.x*B*h.x*f.y-2*p.x*g.x*B*h.y*f.x-2*p.x*B*h.x*g.y*f.x-2*p.x*B*h.x*m.x*m.y-6*w.y*g.x*h.x*V*f.x-6*g.x*h.x*g.y*m.x*V+6*w.y*z*g.y*h.y*f.x+2*R*g.x*p.y*h.y*f.y+2*R*p.y*g.y*h.y*f.x+2*R*p.y*m.x*h.y*m.y-3*u.x*U*E+3*w.x*U*E+3*T*m.x*E+M*h.x*U+3*u.y*h.x*U*V+d.x*p.y*U*V+2*d.y*p.x*U*V-p.x*B*U*h.y-3*w.y*h.x*U*V-3*T*h.x*V*m.y+R*p.y*h.x*(2*g.y*f.y+G)+d.x*p.x*h.x*h.y*(6*g.y*f.y+3*G)+g.x*z*h.y*(6*w.y*f.y+6*g.y*m.y)+$*h.y*(-2*g.y*f.y-G)+u.y*A*(6*g.y*f.y+3*G)+d.y*p.x*z*(-2*g.y*f.y-G)+d.x*p.y*z*(-4*g.y*f.y-2*G)+u.x*z*h.y*(-6*g.y*f.y-3*G)+z*m.x*h.y*(6*w.y*m.y+3*O)+w.x*z*h.y*(6*g.y*f.y+3*G)+A*(-2*w.y*g.y*f.y-m.y*(2*w.y*m.y+O)-w.y*(2*g.y*f.y+G)-g.y*(2*w.y*f.y+2*g.y*m.y)),-u.x*d.x*p.y*h.x*h.y*f.y+u.x*d.y*p.x*h.x*h.y*f.y+6*u.x*d.y*p.y*h.x*h.y*f.x-6*u.y*d.x*p.x*h.x*h.y*f.y-u.y*d.x*p.y*h.x*h.y*f.x+u.y*d.y*p.x*h.x*h.y*f.x+d.x*d.y*p.x*p.y*h.x*f.y-d.x*d.y*p.x*p.y*h.y*f.x+d.x*w.x*p.y*h.x*h.y*f.y+d.x*w.y*p.y*h.x*h.y*f.x+d.x*g.x*p.y*h.x*h.y*m.y+d.x*p.y*h.x*g.y*m.x*h.y-w.x*d.y*p.x*h.x*h.y*f.y-6*w.x*d.y*p.y*h.x*h.y*f.x-d.y*p.x*w.y*h.x*h.y*f.x-d.y*p.x*g.x*h.x*h.y*m.y-d.y*p.x*h.x*g.y*m.x*h.y-6*d.y*g.x*p.y*h.x*m.x*h.y-6*u.x*w.x*E*f.x-6*u.x*g.x*m.x*E-2*u.x*M*h.x*f.x+6*w.x*g.x*m.x*E+2*w.x*M*h.x*f.x+2*g.x*M*h.x*m.x+2*u.y*$*h.y*f.y-6*u.x*u.y*h.x*V*f.x+3*u.x*d.x*p.x*V*f.y-2*u.x*d.x*p.y*V*f.x-4*u.x*d.y*p.x*V*f.x+3*u.y*d.x*p.x*V*f.x+6*u.x*u.y*z*h.y*f.y+6*u.x*w.x*h.x*V*f.y-3*u.x*d.y*p.y*z*f.y+2*u.x*p.x*B*h.x*f.y+2*u.x*p.x*B*h.y*f.x+6*u.x*w.y*h.x*V*f.x+6*u.x*g.x*h.x*V*m.y+6*u.x*h.x*g.y*m.x*V+4*u.y*d.x*p.y*z*f.y+6*u.y*w.x*h.x*V*f.x+2*u.y*d.y*p.x*z*f.y-3*u.y*d.y*p.y*z*f.x+2*u.y*p.x*B*h.x*f.x+6*u.y*g.x*h.x*m.x*V-3*d.x*w.x*p.x*V*f.y+2*d.x*w.x*p.y*V*f.x+d.x*d.y*B*h.x*f.x-3*d.x*p.x*w.y*V*f.x-3*d.x*p.x*g.x*V*m.y-3*d.x*p.x*g.y*m.x*V+2*d.x*g.x*p.y*m.x*V+4*w.x*d.y*p.x*V*f.x+4*d.y*p.x*g.x*m.x*V-2*u.x*R*p.y*h.y*f.y-6*u.y*w.x*z*h.y*f.y-6*u.y*w.y*z*h.y*f.x-6*u.y*g.x*z*h.y*m.y-2*u.y*R*p.y*h.x*f.y-2*u.y*R*p.y*h.y*f.x-6*u.y*z*g.y*m.x*h.y-d.x*d.y*R*h.y*f.y-2*d.x*C*h.x*h.y*f.x+3*w.x*d.y*p.y*z*f.y-2*w.x*p.x*B*h.x*f.y-2*w.x*p.x*B*h.y*f.x-6*w.x*w.y*h.x*V*f.x-6*w.x*g.x*h.x*V*m.y-6*w.x*h.x*g.y*m.x*V+3*d.y*w.y*p.y*z*f.x+3*d.y*g.x*p.y*z*m.y+3*d.y*p.y*z*g.y*m.x-2*p.x*w.y*B*h.x*f.x-2*p.x*g.x*B*h.x*m.y-2*p.x*g.x*B*m.x*h.y-2*p.x*B*h.x*g.y*m.x-6*w.y*g.x*h.x*m.x*V-C*p.x*p.y*h.x*f.x+2*w.x*R*p.y*h.y*f.y+6*w.y*z*g.y*m.x*h.y+2*k*d.y*h.x*h.y*f.y+k*p.x*p.y*h.y*f.y+2*R*w.y*p.y*h.y*f.x+2*R*g.x*p.y*h.y*m.y+2*R*p.y*g.y*m.x*h.y+j*E+3*v*E*f.x-3*L*A*f.y+3*_*E*f.x+D*z*f.x-b*V*f.y-d.x*C*z*f.y+k*d.y*V*f.x-3*v*h.x*V*f.y+3*L*z*h.y*f.x-k*B*h.x*f.y+C*R*h.y*f.x-3*T*h.x*g.y*V-3*_*h.x*V*f.y+3*N*z*h.y*f.x+d.x*p.x*h.x*h.y*(6*w.y*f.y+6*g.y*m.y)+$*h.y*(-2*w.y*f.y-2*g.y*m.y)+u.y*A*(6*w.y*f.y+6*g.y*m.y)+d.y*p.x*z*(-2*w.y*f.y-2*g.y*m.y)+R*p.y*h.x*(2*w.y*f.y+2*g.y*m.y)+d.x*p.y*z*(-4*w.y*f.y-4*g.y*m.y)+u.x*z*h.y*(-6*w.y*f.y-6*g.y*m.y)+w.x*z*h.y*(6*w.y*f.y+6*g.y*m.y)+g.x*z*h.y*(6*w.y*m.y+3*O)+A*(-2*w.y*g.y*m.y-N*f.y-g.y*(2*w.y*m.y+O)-w.y*(2*w.y*f.y+2*g.y*m.y)),-u.x*d.x*p.y*h.x*h.y*m.y+u.x*d.y*p.x*h.x*h.y*m.y+6*u.x*d.y*p.y*h.x*m.x*h.y-6*u.y*d.x*p.x*h.x*h.y*m.y-u.y*d.x*p.y*h.x*m.x*h.y+u.y*d.y*p.x*h.x*m.x*h.y+d.x*d.y*p.x*p.y*h.x*m.y-d.x*d.y*p.x*p.y*m.x*h.y+d.x*w.x*p.y*h.x*h.y*m.y+d.x*w.y*p.y*h.x*m.x*h.y+d.x*g.x*p.y*h.x*g.y*h.y-w.x*d.y*p.x*h.x*h.y*m.y-6*w.x*d.y*p.y*h.x*m.x*h.y-d.y*p.x*w.y*h.x*m.x*h.y-d.y*p.x*g.x*h.x*g.y*h.y-6*u.x*w.x*m.x*E-2*u.x*M*h.x*m.x+2*w.x*M*h.x*m.x+2*u.y*$*h.y*m.y-6*u.x*u.y*h.x*m.x*V+3*u.x*d.x*p.x*V*m.y-2*u.x*d.x*p.y*m.x*V-4*u.x*d.y*p.x*m.x*V+3*u.y*d.x*p.x*m.x*V+6*u.x*u.y*z*h.y*m.y+6*u.x*w.x*h.x*V*m.y-3*u.x*d.y*p.y*z*m.y+2*u.x*p.x*B*h.x*m.y+2*u.x*p.x*B*m.x*h.y+6*u.x*w.y*h.x*m.x*V+6*u.x*g.x*h.x*g.y*V+4*u.y*d.x*p.y*z*m.y+6*u.y*w.x*h.x*m.x*V+2*u.y*d.y*p.x*z*m.y-3*u.y*d.y*p.y*z*m.x+2*u.y*p.x*B*h.x*m.x-3*d.x*w.x*p.x*V*m.y+2*d.x*w.x*p.y*m.x*V+d.x*d.y*B*h.x*m.x-3*d.x*p.x*w.y*m.x*V-3*d.x*p.x*g.x*g.y*V+4*w.x*d.y*p.x*m.x*V-2*u.x*R*p.y*h.y*m.y-6*u.y*w.x*z*h.y*m.y-6*u.y*w.y*z*m.x*h.y-6*u.y*g.x*z*g.y*h.y-2*u.y*R*p.y*h.x*m.y-2*u.y*R*p.y*m.x*h.y-d.x*d.y*R*h.y*m.y-2*d.x*C*h.x*m.x*h.y+3*w.x*d.y*p.y*z*m.y-2*w.x*p.x*B*h.x*m.y-2*w.x*p.x*B*m.x*h.y-6*w.x*w.y*h.x*m.x*V-6*w.x*g.x*h.x*g.y*V+3*d.y*w.y*p.y*z*m.x+3*d.y*g.x*p.y*z*g.y-2*p.x*w.y*B*h.x*m.x-2*p.x*g.x*B*h.x*g.y-C*p.x*p.y*h.x*m.x+2*w.x*R*p.y*h.y*m.y-3*d.y*T*p.y*h.x*h.y+6*w.y*g.x*z*g.y*h.y+2*k*d.y*h.x*h.y*m.y+k*p.x*p.y*h.y*m.y+2*R*w.y*p.y*m.x*h.y+2*R*g.x*p.y*g.y*h.y-3*u.x*T*E+3*w.x*T*E+3*v*m.x*E-3*L*A*m.y+3*_*m.x*E+T*M*h.x+D*z*m.x-b*V*m.y+3*u.y*T*h.x*V-d.x*C*z*m.y+d.x*T*p.y*V+2*d.y*p.x*T*V+k*d.y*m.x*V-p.x*T*B*h.y-3*w.y*T*h.x*V-3*v*h.x*V*m.y+3*L*z*m.x*h.y-k*B*h.x*m.y+C*R*m.x*h.y-3*_*h.x*V*m.y+3*N*z*m.x*h.y+R*p.y*h.x*(2*w.y*m.y+O)+d.x*p.x*h.x*h.y*(6*w.y*m.y+3*O)+$*h.y*(-2*w.y*m.y-O)+u.y*A*(6*w.y*m.y+3*O)+d.y*p.x*z*(-2*w.y*m.y-O)+d.x*p.y*z*(-4*w.y*m.y-2*O)+u.x*z*h.y*(-6*w.y*m.y-3*O)+w.x*z*h.y*(6*w.y*m.y+3*O)+A*(-2*w.y*O-N*m.y-w.y*(2*w.y*m.y+O)),-u.x*d.x*p.y*h.x*g.y*h.y+u.x*d.y*p.x*h.x*g.y*h.y+6*u.x*d.y*g.x*p.y*h.x*h.y-6*u.y*d.x*p.x*h.x*g.y*h.y-u.y*d.x*g.x*p.y*h.x*h.y+u.y*d.y*p.x*g.x*h.x*h.y-d.x*d.y*p.x*g.x*p.y*h.y+d.x*d.y*p.x*p.y*h.x*g.y+d.x*w.x*p.y*h.x*g.y*h.y+6*d.x*p.x*w.y*h.x*g.y*h.y+d.x*w.y*g.x*p.y*h.x*h.y-w.x*d.y*p.x*h.x*g.y*h.y-6*w.x*d.y*g.x*p.y*h.x*h.y-d.y*p.x*w.y*g.x*h.x*h.y-6*u.x*w.x*g.x*E-2*u.x*g.x*M*h.x+6*u.y*w.y*A*g.y+2*w.x*g.x*M*h.x+2*u.y*$*g.y*h.y-2*$*w.y*g.y*h.y-6*u.x*u.y*g.x*h.x*V+3*u.x*d.x*p.x*g.y*V-2*u.x*d.x*g.x*p.y*V-4*u.x*d.y*p.x*g.x*V+3*u.y*d.x*p.x*g.x*V+6*u.x*u.y*z*g.y*h.y+6*u.x*w.x*h.x*g.y*V-3*u.x*d.y*p.y*z*g.y+2*u.x*p.x*g.x*B*h.y+2*u.x*p.x*B*h.x*g.y+6*u.x*w.y*g.x*h.x*V+4*u.y*d.x*p.y*z*g.y+6*u.y*w.x*g.x*h.x*V+2*u.y*d.y*p.x*z*g.y-3*u.y*d.y*g.x*p.y*z+2*u.y*p.x*g.x*B*h.x-3*d.x*w.x*p.x*g.y*V+2*d.x*w.x*g.x*p.y*V+d.x*d.y*g.x*B*h.x-3*d.x*p.x*w.y*g.x*V+4*w.x*d.y*p.x*g.x*V-6*u.x*w.y*z*g.y*h.y-2*u.x*R*p.y*g.y*h.y-6*u.y*w.x*z*g.y*h.y-6*u.y*w.y*g.x*z*h.y-2*u.y*R*g.x*p.y*h.y-2*u.y*R*p.y*h.x*g.y-d.x*d.y*R*g.y*h.y-4*d.x*w.y*p.y*z*g.y-2*d.x*C*g.x*h.x*h.y+3*w.x*d.y*p.y*z*g.y-2*w.x*p.x*g.x*B*h.y-2*w.x*p.x*B*h.x*g.y-6*w.x*w.y*g.x*h.x*V-2*d.y*p.x*w.y*z*g.y+3*d.y*w.y*g.x*p.y*z-2*p.x*w.y*g.x*B*h.x-C*p.x*g.x*p.y*h.x+6*w.x*w.y*z*g.y*h.y+2*w.x*R*p.y*g.y*h.y+2*k*d.y*h.x*g.y*h.y+k*p.x*p.y*g.y*h.y+2*R*w.y*g.x*p.y*h.y+2*R*w.y*p.y*h.x*g.y+3*v*g.x*E-3*L*A*g.y+3*_*g.x*E+D*g.x*z-b*g.y*V-3*N*A*g.y-d.x*C*z*g.y+k*d.y*g.x*V-3*v*h.x*g.y*V+3*L*g.x*z*h.y-k*B*h.x*g.y+C*R*g.x*h.y-3*_*h.x*g.y*V+3*N*g.x*z*h.y,u.x*u.y*d.x*p.y*h.x*h.y-u.x*u.y*d.y*p.x*h.x*h.y+u.x*d.x*d.y*p.x*p.y*h.y-u.y*d.x*d.y*p.x*p.y*h.x-u.x*d.x*w.y*p.y*h.x*h.y+6*u.x*w.x*d.y*p.y*h.x*h.y+u.x*d.y*p.x*w.y*h.x*h.y-u.y*d.x*w.x*p.y*h.x*h.y-6*u.y*d.x*p.x*w.y*h.x*h.y+u.y*w.x*d.y*p.x*h.x*h.y-d.x*w.x*d.y*p.x*p.y*h.y+d.x*d.y*p.x*w.y*p.y*h.x+d.x*w.x*w.y*p.y*h.x*h.y-w.x*d.y*p.x*w.y*h.x*h.y-2*u.x*w.x*M*h.x+2*u.y*$*w.y*h.y-3*u.x*u.y*d.x*p.x*V-6*u.x*u.y*w.x*h.x*V+3*u.x*u.y*d.y*p.y*z-2*u.x*u.y*p.x*B*h.x-2*u.x*d.x*w.x*p.y*V-u.x*d.x*d.y*B*h.x+3*u.x*d.x*p.x*w.y*V-4*u.x*w.x*d.y*p.x*V+3*u.y*d.x*w.x*p.x*V+6*u.x*u.y*w.y*z*h.y+2*u.x*u.y*R*p.y*h.y+2*u.x*d.x*C*h.x*h.y+2*u.x*w.x*p.x*B*h.y+6*u.x*w.x*w.y*h.x*V-3*u.x*d.y*w.y*p.y*z+2*u.x*p.x*w.y*B*h.x+u.x*C*p.x*p.y*h.x+u.y*d.x*d.y*R*h.y+4*u.y*d.x*w.y*p.y*z-3*u.y*w.x*d.y*p.y*z+2*u.y*w.x*p.x*B*h.x+2*u.y*d.y*p.x*w.y*z+d.x*w.x*d.y*B*h.x-3*d.x*w.x*p.x*w.y*V-2*u.x*R*w.y*p.y*h.y-6*u.y*w.x*w.y*z*h.y-2*u.y*w.x*R*p.y*h.y-2*u.y*k*d.y*h.x*h.y-u.y*k*p.x*p.y*h.y-2*u.y*R*w.y*p.y*h.x-2*d.x*w.x*C*h.x*h.y-d.x*d.y*R*w.y*h.y+3*w.x*d.y*w.y*p.y*z-2*w.x*p.x*w.y*B*h.x-w.x*C*p.x*p.y*h.x+3*L*d.x*p.x*h.x*h.y+3*d.x*p.x*N*h.x*h.y+2*w.x*R*w.y*p.y*h.y-3*v*d.y*p.y*h.x*h.y+2*k*d.y*w.y*h.x*h.y+k*p.x*w.y*p.y*h.y-3*_*d.y*p.y*h.x*h.y-P*E+S*A+F*E-H*A-3*u.x*_*E-u.x*D*z+3*v*w.x*E+u.y*b*V+3*u.y*N*A+w.x*D*z+v*M*h.x-3*L*w.y*A-L*$*h.y+_*M*h.x-b*w.y*V-$*N*h.y-u.x*k*d.y*V+u.y*d.x*C*z-3*u.x*L*z*h.y-u.x*C*R*h.y+u.y*k*B*h.x-d.x*C*w.y*z+3*v*u.y*h.x*V+v*d.x*p.y*V+2*v*d.y*p.x*V-2*L*d.x*p.y*z-L*d.y*p.x*z+k*w.x*d.y*V-3*u.x*N*z*h.y+3*u.y*_*h.x*V+d.x*_*p.y*V-2*d.x*N*p.y*z+w.x*C*R*h.y-d.y*p.x*N*z-v*p.x*B*h.y-3*v*w.y*h.x*V+3*L*w.x*z*h.y+L*R*p.y*h.x-k*w.y*B*h.x+2*_*d.y*p.x*V+3*w.x*N*z*h.y-_*p.x*B*h.y-3*_*w.y*h.x*V+R*N*p.y*h.x).getRootsInInterval(0,1),X=0;X<Q.length;X++){var Y=Q[X],tt=new Polynomial(h.x,p.x,d.x,u.x-w.x-Y*g.x-Y*Y*m.x-Y*Y*Y*f.x).getRoots(),et=new Polynomial(h.y,p.y,d.y,u.y-w.y-Y*g.y-Y*Y*m.y-Y*Y*Y*f.y).getRoots();if(tt.length>0&&et.length>0){t:for(var yt=0;yt<tt.length;yt++){var nt=tt[yt];if(0<=nt&&nt<=1)for(var it=0;it<et.length;it++)if(Math.abs(nt-et[it])<1e-4){I.points.push(f.multiply(Y*Y*Y).add(m.multiply(Y*Y).add(g.multiply(Y).add(w))));break t}}}}return I.points.length>0&&(I.status="Intersection"),I},Intersection.intersectBezier3Circle=function(t,e,y,n,i,x){return Intersection.intersectBezier3Ellipse(t,e,y,n,i,x,x)},Intersection.intersectBezier3Ellipse=function(t,e,y,n,i,x,s){var o,r,a,c,l,h,p,d,u=new Intersection("No Intersection");o=t.multiply(-1),r=e.multiply(3),a=y.multiply(-3),c=o.add(r.add(a.add(n))),l=new Vector2D(c.x,c.y),o=t.multiply(3),r=e.multiply(-6),a=y.multiply(3),c=o.add(r.add(a)),h=new Vector2D(c.x,c.y),o=t.multiply(-3),r=e.multiply(3),a=o.add(r),p=new Vector2D(a.x,a.y),d=new Vector2D(t.x,t.y);for(var f=x*x,m=s*s,g=new Polynomial(l.x*l.x*m+l.y*l.y*f,2*(l.x*h.x*m+l.y*h.y*f),2*(l.x*p.x*m+l.y*p.y*f)+h.x*h.x*m+h.y*h.y*f,2*l.x*m*(d.x-i.x)+2*l.y*f*(d.y-i.y)+2*(h.x*p.x*m+h.y*p.y*f),2*h.x*m*(d.x-i.x)+2*h.y*f*(d.y-i.y)+p.x*p.x*m+p.y*p.y*f,2*p.x*m*(d.x-i.x)+2*p.y*f*(d.y-i.y),d.x*d.x*m-2*d.y*i.y*f-2*d.x*i.x*m+d.y*d.y*f+i.x*i.x*m+i.y*i.y*f-f*m).getRootsInInterval(0,1),w=0;w<g.length;w++){var I=g[w];u.points.push(l.multiply(I*I*I).add(h.multiply(I*I).add(p.multiply(I).add(d))))}return u.points.length>0&&(u.status="Intersection"),u},Intersection.intersectBezier3Line=function(t,e,y,n,i,x){var s,o,r,a,c,l,h,p,d,u,f=i.min(x),m=i.max(x),g=new Intersection("No Intersection");s=t.multiply(-1),o=e.multiply(3),r=y.multiply(-3),a=s.add(o.add(r.add(n))),c=new Vector2D(a.x,a.y),s=t.multiply(3),o=e.multiply(-6),r=y.multiply(3),a=s.add(o.add(r)),l=new Vector2D(a.x,a.y),s=t.multiply(-3),o=e.multiply(3),r=s.add(o),h=new Vector2D(r.x,r.y),p=new Vector2D(t.x,t.y),u=new Vector2D(i.y-x.y,x.x-i.x),d=i.x*x.y-x.x*i.y,roots=new Polynomial(u.dot(c),u.dot(l),u.dot(h),u.dot(p)+d).getRoots();for(var w=0;w<roots.length;w++){var I=roots[w];if(0<=I&&I<=1){var v=t.lerp(e,I),P=e.lerp(y,I),L=y.lerp(n,I),S=v.lerp(P,I),k=P.lerp(L,I),b=S.lerp(k,I);i.x==x.x?f.y<=b.y&&b.y<=m.y&&(g.status="Intersection",g.appendPoint(b)):i.y==x.y?f.x<=b.x&&b.x<=m.x&&(g.status="Intersection",g.appendPoint(b)):b.gte(f)&&b.lte(m)&&(g.status="Intersection",g.appendPoint(b))}}return g},Intersection.intersectBezier3Polygon=function(t,e,y,n,i){for(var x=new Intersection("No Intersection"),s=i.length,o=0;o<s;o++){var r=i[o],a=i[(o+1)%s],c=Intersection.intersectBezier3Line(t,e,y,n,r,a);x.appendPoints(c.points)}return x.points.length>0&&(x.status="Intersection"),x},Intersection.intersectBezier3Rectangle=function(t,e,y,n,i,x){var s=i.min(x),o=i.max(x),r=new Point2D(o.x,s.y),a=new Point2D(s.x,o.y),c=Intersection.intersectBezier3Line(t,e,y,n,s,r),l=Intersection.intersectBezier3Line(t,e,y,n,r,o),h=Intersection.intersectBezier3Line(t,e,y,n,o,a),p=Intersection.intersectBezier3Line(t,e,y,n,a,s),d=new Intersection("No Intersection");return d.appendPoints(c.points),d.appendPoints(l.points),d.appendPoints(h.points),d.appendPoints(p.points),d.points.length>0&&(d.status="Intersection"),d},Intersection.intersectCircleCircle=function(t,e,y,n){var i,x=e+n,s=Math.abs(e-n),o=t.distanceFrom(y);if(o>x)i=new Intersection("Outside");else if(o<s)i=new Intersection("Inside");else{i=new Intersection("Intersection");var r=(e*e-n*n+o*o)/(2*o),a=Math.sqrt(e*e-r*r),c=t.lerp(y,r/o),l=a/o;i.points.push(new Point2D(c.x-l*(y.y-t.y),c.y+l*(y.x-t.x))),i.points.push(new Point2D(c.x+l*(y.y-t.y),c.y-l*(y.x-t.x)))}return i},Intersection.intersectCircleEllipse=function(t,e,y,n,i){return Intersection.intersectEllipseEllipse(t,e,e,y,n,i)},Intersection.intersectCircleLine=function(t,e,y,n){var i,x=(n.x-y.x)*(n.x-y.x)+(n.y-y.y)*(n.y-y.y),s=2*((n.x-y.x)*(y.x-t.x)+(n.y-y.y)*(y.y-t.y)),o=s*s-4*x*(t.x*t.x+t.y*t.y+y.x*y.x+y.y*y.y-2*(t.x*y.x+t.y*y.y)-e*e);if(o<0)i=new Intersection("Outside");else if(0==o)i=new Intersection("Tangent");else{var r=Math.sqrt(o),a=(-s+r)/(2*x),c=(-s-r)/(2*x);(a<0||a>1)&&(c<0||c>1)?i=new Intersection(a<0&&c<0||a>1&&c>1?"Outside":"Inside"):(i=new Intersection("Intersection"),0<=a&&a<=1&&i.points.push(y.lerp(n,a)),0<=c&&c<=1&&i.points.push(y.lerp(n,c)))}return i},Intersection.intersectCirclePolygon=function(t,e,y){for(var n,i=new Intersection("No Intersection"),x=y.length,s=0;s<x;s++){var o=y[s],r=y[(s+1)%x];n=Intersection.intersectCircleLine(t,e,o,r),i.appendPoints(n.points)}return i.points.length>0?i.status="Intersection":i.status=n.status,i},Intersection.intersectCircleRectangle=function(t,e,y,n){var i=y.min(n),x=y.max(n),s=new Point2D(x.x,i.y),o=new Point2D(i.x,x.y),r=Intersection.intersectCircleLine(t,e,i,s),a=Intersection.intersectCircleLine(t,e,s,x),c=Intersection.intersectCircleLine(t,e,x,o),l=Intersection.intersectCircleLine(t,e,o,i),h=new Intersection("No Intersection");return h.appendPoints(r.points),h.appendPoints(a.points),h.appendPoints(c.points),h.appendPoints(l.points),h.points.length>0?h.status="Intersection":h.status=r.status,h},Intersection.intersectEllipseEllipse=function(t,e,y,n,i,x){for(var s=[y*y,0,e*e,-2*y*y*t.x,-2*e*e*t.y,y*y*t.x*t.x+e*e*t.y*t.y-e*e*y*y],o=[x*x,0,i*i,-2*x*x*n.x,-2*i*i*n.y,x*x*n.x*n.x+i*i*n.y*n.y-i*i*x*x],r=Intersection.bezout(s,o).getRoots(),a=.001*(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2]),c=.001*(o[0]*o[0]+2*o[1]*o[1]+o[2]*o[2]),l=new Intersection("No Intersection"),h=0;h<r.length;h++)for(var p=new Polynomial(s[0],s[3]+r[h]*s[1],s[5]+r[h]*(s[4]+r[h]*s[2])).getRoots(),d=0;d<p.length;d++){var u=(s[0]*p[d]+s[1]*r[h]+s[3])*p[d]+(s[2]*r[h]+s[4])*r[h]+s[5];Math.abs(u)<a&&(u=(o[0]*p[d]+o[1]*r[h]+o[3])*p[d]+(o[2]*r[h]+o[4])*r[h]+o[5],Math.abs(u)<c&&l.appendPoint(new Point2D(p[d],r[h])))}return l.points.length>0&&(l.status="Intersection"),l},Intersection.intersectEllipseLine=function(t,e,y,n,i){var x,s=new Vector2D(n.x,n.y),o=Vector2D.fromPoints(n,i),r=new Vector2D(t.x,t.y),a=s.subtract(r),c=new Vector2D(o.x/(e*e),o.y/(y*y)),l=new Vector2D(a.x/(e*e),a.y/(y*y)),h=o.dot(c),p=o.dot(l),d=p*p-h*(t=a.dot(l)-1);if(d<0)x=new Intersection("Outside");else if(d>0){var u=Math.sqrt(d),f=(-p-u)/h,m=(-p+u)/h;(f<0||1<f)&&(m<0||1<m)?x=new Intersection(f<0&&m<0||f>1&&m>1?"Outside":"Inside"):(x=new Intersection("Intersection"),0<=f&&f<=1&&x.appendPoint(n.lerp(i,f)),0<=m&&m<=1&&x.appendPoint(n.lerp(i,m)))}else{var g=-p/h;0<=g&&g<=1?(x=new Intersection("Intersection")).appendPoint(n.lerp(i,g)):x=new Intersection("Outside")}return x},Intersection.intersectEllipsePolygon=function(t,e,y,n){for(var i=new Intersection("No Intersection"),x=n.length,s=0;s<x;s++){var o=n[s],r=n[(s+1)%x],a=Intersection.intersectEllipseLine(t,e,y,o,r);i.appendPoints(a.points)}return i.points.length>0&&(i.status="Intersection"),i},Intersection.intersectEllipseRectangle=function(t,e,y,n,i){var x=n.min(i),s=n.max(i),o=new Point2D(s.x,x.y),r=new Point2D(x.x,s.y),a=Intersection.intersectEllipseLine(t,e,y,x,o),c=Intersection.intersectEllipseLine(t,e,y,o,s),l=Intersection.intersectEllipseLine(t,e,y,s,r),h=Intersection.intersectEllipseLine(t,e,y,r,x),p=new Intersection("No Intersection");return p.appendPoints(a.points),p.appendPoints(c.points),p.appendPoints(l.points),p.appendPoints(h.points),p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectLineLine=function(t,e,y,n){var i,x=(n.x-y.x)*(t.y-y.y)-(n.y-y.y)*(t.x-y.x),s=(e.x-t.x)*(t.y-y.y)-(e.y-t.y)*(t.x-y.x),o=(n.y-y.y)*(e.x-t.x)-(n.x-y.x)*(e.y-t.y);if(0!=o){var r=x/o,a=s/o;0<=r&&r<=1&&0<=a&&a<=1?(i=new Intersection("Intersection")).points.push(new Point2D(t.x+r*(e.x-t.x),t.y+r*(e.y-t.y))):i=new Intersection("No Intersection")}else i=new Intersection(0==x||0==s?"Coincident":"Parallel");return i},Intersection.intersectLinePolygon=function(t,e,y){for(var n=new Intersection("No Intersection"),i=y.length,x=0;x<i;x++){var s=y[x],o=y[(x+1)%i],r=Intersection.intersectLineLine(t,e,s,o);n.appendPoints(r.points)}return n.points.length>0&&(n.status="Intersection"),n},Intersection.intersectLineRectangle=function(t,e,y,n){var i=y.min(n),x=y.max(n),s=new Point2D(x.x,i.y),o=new Point2D(i.x,x.y),r=Intersection.intersectLineLine(i,s,t,e),a=Intersection.intersectLineLine(s,x,t,e),c=Intersection.intersectLineLine(x,o,t,e),l=Intersection.intersectLineLine(o,i,t,e),h=new Intersection("No Intersection");return h.appendPoints(r.points),h.appendPoints(a.points),h.appendPoints(c.points),h.appendPoints(l.points),h.points.length>0&&(h.status="Intersection"),h},Intersection.intersectPolygonPolygon=function(t,e){for(var y=new Intersection("No Intersection"),n=t.length,i=0;i<n;i++){var x=t[i],s=t[(i+1)%n],o=Intersection.intersectLinePolygon(x,s,e);y.appendPoints(o.points)}return y.points.length>0&&(y.status="Intersection"),y},Intersection.intersectPolygonRectangle=function(t,e,y){var n=e.min(y),i=e.max(y),x=new Point2D(i.x,n.y),s=new Point2D(n.x,i.y),o=Intersection.intersectLinePolygon(n,x,t),r=Intersection.intersectLinePolygon(x,i,t),a=Intersection.intersectLinePolygon(i,s,t),c=Intersection.intersectLinePolygon(s,n,t),l=new Intersection("No Intersection");return l.appendPoints(o.points),l.appendPoints(r.points),l.appendPoints(a.points),l.appendPoints(c.points),l.points.length>0&&(l.status="Intersection"),l},Intersection.intersectRayRay=function(t,e,y,n){var i,x=(n.x-y.x)*(t.y-y.y)-(n.y-y.y)*(t.x-y.x),s=(e.x-t.x)*(t.y-y.y)-(e.y-t.y)*(t.x-y.x),o=(n.y-y.y)*(e.x-t.x)-(n.x-y.x)*(e.y-t.y);if(0!=o){var r=x/o;(i=new Intersection("Intersection")).points.push(new Point2D(t.x+r*(e.x-t.x),t.y+r*(e.y-t.y)))}else i=new Intersection(0==x||0==s?"Coincident":"Parallel");return i},Intersection.intersectRectangleRectangle=function(t,e,y,n){var i=t.min(e),x=t.max(e),s=new Point2D(x.x,i.y),o=new Point2D(i.x,x.y),r=Intersection.intersectLineRectangle(i,s,y,n),a=Intersection.intersectLineRectangle(s,x,y,n),c=Intersection.intersectLineRectangle(x,o,y,n),l=Intersection.intersectLineRectangle(o,i,y,n),h=new Intersection("No Intersection");return h.appendPoints(r.points),h.appendPoints(a.points),h.appendPoints(c.points),h.appendPoints(l.points),h.points.length>0&&(h.status="Intersection"),h},Intersection.bezout=function(t,e){var y=t[0]*e[1]-e[0]*t[1],n=t[0]*e[2]-e[0]*t[2],i=t[0]*e[3]-e[0]*t[3],x=t[0]*e[4]-e[0]*t[4],s=t[0]*e[5]-e[0]*t[5],o=t[1]*e[2]-e[1]*t[2],r=t[1]*e[4]-e[1]*t[4],a=t[1]*e[5]-e[1]*t[5],c=t[2]*e[3]-e[2]*t[3],l=t[3]*e[4]-e[3]*t[4],h=t[3]*e[5]-e[3]*t[5],p=a+l,d=r-c;return new Polynomial(y*o-n*n,y*d+i*o-2*n*x,y*p+i*d-x*x-2*n*s,y*h+i*p-2*x*s,i*h-s*s)},$(window).resize(function(){xLimit=resetWindowLimit("x"),yLimit=resetWindowLimit("y")}),lifeCnt>0&&(document.onkeydown=function(t){switch($("#spaceship").css("opacity","1"),t.keyCode){case 68:turn=2;break;case 65:turn=-2;break;case 87:thrust=1;break;case 83:thrust=-1;break;case 32:pewpew(),resetGun=!1;break;case 13:hyperspace();break;case 8:case 46:boom()}},document.onkeyup=function(t){switch(t.keyCode){case 65:case 68:turn=0;break;case 87:case 83:thrust=0;break;case 32:resetGun=!0}},$(document).on("touchstart"," .gameBtn",function(t){$("#spaceship").css("opacity","1");var e=t.target.id;switch(console.log(e),e){case"btnLeft":turn=-1;break;case"btnRight":turn=1;break;case"btnUp":thrust=1;break;case"btnDown":thrust=-1;break;case"btnShoot":pewpew();break;case"btnHS":hyperspace()}}),$(document).on("touchend",".gameBtn",function(t){switch(t.target.id){case"btnLeft":case"btnRight":turn=0;break;case"btnUp":case"btnDown":thrust=0;break;case"glyphLeft":turn=0;break;case"btnShoot":resetGun=!0}}));