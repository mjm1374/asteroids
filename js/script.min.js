var asteroids=[],shots=[],shotCnt=0,spaceship=new Spaceship(xLimit/2,yLimit/2,0,0,0,0,0,0),colors=["#edc951","#eb6841","#cc2a36","#4f372d","#00a0b0"],rocksLrg=["26.087899,1.0434852 49.503787,26.009091 74.220561,2.6541843 96.335572,25.203747 85.278067,50.974686 98.286898,75.940275 62.512619,99.295186 26.087905,100.10053 0.7206885,77.55096 1.3711312,27.619771","27.46638,2.6445482 66.467442,0.98983643 99.048213,24.999426 V 35.822504 L 65.202598,51.325844 98.421452,73.55696 76.484471,97.835645 H 72.723845 L 60.501821,85.842551 27.596351,98.713169 0.95859607,63.02645 1.8987487,25.29194 H 36.997914","14.670645,48.844427 1.9670478,25.614646 27.37424,2.3848478 48.335078,12.875719 73.107033,1.6354928 97.878992,24.865291 75.012591,39.102909 97.878992,60.834007 75.012591,97.552066 39.442599,87.061197 26.739004,99.050766 1.3318868,75.820971"],xLimit=resetWindowLimit("x")-1,yLimit=resetWindowLimit("y")-1,lifeCnt=3,jumpCnt=3,score=0,newLifeTarget=1e4,newLife=newLifeTarget,resetGun=!0,inPlay=!1,mode="asteroids",rockCnt=10,delta_time=20,turn=0,thrust=0,turn_per_milli=.1,thrust_per_milli=15e-5,key_delay=50,del_v=0,del_vx=0,del_vy=0;function animateScreen(t,y){for(var e in $("#scoreCnt span").html(score),$("#lifeCnt span").html(lifeCnt),asteroids){if(asteroids.hasOwnProperty(e))asteroids[e].changePosition(asteroids[e].x+asteroids[e].xv,asteroids[e].y+asteroids[e].yv),"asteroids"==mode&&((asteroids[e].x<=0-asteroids[e].width||asteroids[e].x>=xLimit+asteroids[e].width)&&(asteroids[e].x>=xLimit+asteroids[e].width?asteroids[e].x=-Math.abs(0-asteroids[e].width):asteroids[e].x=xLimit+asteroids[e].width),(asteroids[e].y<=0-asteroids[e].width||asteroids[e].y>=yLimit+asteroids[e].height)&&(asteroids[e].y>=yLimit+asteroids[e].height?asteroids[e].y=-Math.abs(0-asteroids[e].height):asteroids[e].y=yLimit+asteroids[e].height)),1==inPlay&&inCollision(asteroids[e])&&boom();$("#rockAnim"+asteroids[e].id).css("left",asteroids[e].x).css("top",asteroids[e].y)}for(var x in y){var n=10*Math.cos(y[x].theta*Math.PI/180)+y[x].x,i=10*Math.sin(y[x].theta*Math.PI/180)+y[x].y,s=y[x].life-5;y[x].changeLife(s),y[x].life<0?clearBullet(x):(y[x].changePosition(n,i),$("#shot"+y[x].id).css("left",y[x].x).css("top",y[x].y),isHit(y[x])&&clearBullet(x))}moveSpaceship(delta_time),updateSpaceship(delta_time)}function inCollision(t){var y=spaceship,e=t;return!(y.y+y.height<e.y||y.y>e.y+e.height||y.x+y.width<e.x||y.x>e.x+e.width)}function isHit(t){var y=asteroids,e=t;for(i=0;i<y.length;i++)if(0==(y[i].y+y[i].height<e.y||y[i].y>e.y+e.height||y[i].x+y[i].width<e.x||y[i].x>e.x+e.width))return blowupAsteroid(y[i],i),!0}function blowupAsteroid(t,y){$("#sndAstroBoom").get(0).pause(),$("#sndAstroBoom").get(0).currentTime=0,$("#sndAstroBoom").get(0).play();var e=t;pointCnt(t.points),$("#rockAnim"+e.id).remove(),asteroids.splice(y,1),0==asteroids.length&&regenerateAsteroids()}function pointCnt(t){score+=t,(newLife-=t)<0&&(lifeCnt++,newLife=newLifeTarget+newLife)}function checkPathTouch(t){var y=spaceship,e=t,x=[],n=[];for(i=0;i<y.getTotalLength();i+=1)x.push(y.getPointAtLength(i));for(i=0;i<e.getTotalLength();i+=1)n.push(e.getPointAtLength(i));for(i=0;i<x.length;i++){var s=Math.floor(x[i].x),o=Math.floor(x[i].y);for(j=0;j<n.length;j++)if(s==Math.floor(n[j].x)&&o==Math.floor(n[j].y)){console.log(Math.floor(n[j].x)+"- "+Math.floor(n[j].y)),boom();break}}}function boom(){$("#spaceship").hide(),inPlay=!1,$("#sndBoom").get(0).play(),lifeCnt>0&&(lifeCnt--,$("#lifeCnt span").html(lifeCnt),jumpCnt=3,$("#HSCnt span").html(jumpCnt),setTimeout(function(){resetSpaceship()},3e3))}function resetSpaceship(){lifeCnt>0?($("#spaceship").show(),spaceship=new Spaceship(xLimit/2,yLimit/2,0,0,0,0,0,0),inPlay=!0):(inPlay=!1,$("#spaceship").hide(),$("#gameOverBoard").css("display","block"),checkHighScoreCookie())}function makeShot(){shotCnt++,shots.push(new Shot(shotCnt,spaceship.x,spaceship.y,spaceship.vx,spaceship.vy,spaceship.theta,spaceship.yaw,1800,0,0)),$("body").append("<svg id='shot"+shotCnt+"' data-id='"+shotCnt+"' class='shot' height='6' width='6'><circle cx='3' cy='3' r='3' stroke='white' stroke-width='2' fill='red' /></svg>")}function pewpew(){lifeCnt>0&&1==resetGun&&($("#sndLaser").get(0).play(),makeShot(),resetGun=!1)}function endpew(){$("#sndLaser").get(0).pause(),$("#sndLaser").get(0).currentTime=0}function resetgame(){$("#gameOverBoard").hide(),$(".asteroid").remove(),lifeCnt=3,jumpCnt=3,score=0,asteroids=[],regenerateAsteroids(),$("body").append("<svg id='spaceship' class=''><path cx='5' cy='5' r='10' stroke='#ffffff' stroke-width='2' d='M "+spaceship.shape+" Z'  id='outerShip' /></svg>"),$("#lifeCnt span").html(lifeCnt),$("#HSCnt span").html(jumpCnt),resetSpaceship()}function regenerateAsteroids(){for(i=0;i<rockCnt;i++)thisRockSize=Math.floor(getRandomFloat(50,100)),thisRockSize=100,asteroids.push(new Asteroid(i,"test",thisRockSize,thisRockSize,getRandomFloat(0,xLimit-150),getRandomFloat(0,yLimit-150),getRandomFloat(-3,3),getRandomFloat(-3,3),colors[Math.floor(getRandomFloat(0,5))],"generic",!1,20,!0));for(var t in asteroids)asteroids.hasOwnProperty(t)&&($("body").append("<svg id='rockAnim"+asteroids[t].id+"' data-id='"+asteroids[t].id+"' class='asteroid'><path cx='"+asteroids[t].width+"' cy='"+asteroids[t].height+"' r='"+(asteroids[t].width/2-5)+"' stroke='"+asteroids[t].color+"' stroke-width='2' d='M "+rocksLrg[Math.floor(getRandomFloat(0,3))]+" Z'  id='astroPath"+asteroids[t].id+"' /><text x='20' y='55' fill='"+asteroids[t].color+"'>"+asteroids[t].id+"</text></svg>"),$("#rockAnim"+asteroids[t].id).css("color",asteroids[t].color).css("border-color",asteroids[t].color).css("width",asteroids[t].width).css("height",asteroids[t].height).addClass("rockAnim"))}function Intersection(t){arguments.length>0&&this.init(t)}function Asteroid(t,y,e,x,n,i,s,o,r,a,c,p,l){this.id=t,this.title=y,this.width=e,this.height=x,this.x=n,this.y=i,this.xv=s,this.yv=o,this.color=r,this.type=a,this.oob=c,this.points=p,this.gravity=.1,this.gravitySpeed=0,this.bounce=.4,this.exists=!0,this.resetGravity=function(){},this.newPos=function(){this.gravitySpeed+=this.gravity,this.x+=this.xvel;var t=this.yv;this.yv<0&&(t=0),t=0,this.y+=t+this.gravitySpeed,this.hitBottom()},this.hitBottom=function(){var t=window.innerHeight-this.height;this.y>t&&(this.x=t,this.gravitySpeed=-this.gravitySpeed*this.bounce),this.x>window.innerWidth+this.width&&(this.x=0-this.width),this.x<0-this.width&&(this.x=window.innerWidth+this.width)},this.changeColor=function(t){this.color=t},this.oob=function(t){this.oob=t},this.changeVelocity=function(t,y){"x"==t&&(this.xv=y),"y"==t&&(this.yv=y)},this.changePosition=function(t,y){this.x=t,this.y=y},this.getVelocity=function(t){return this.direction},this.changeExistance=function(t){this.exists=t}}function Spaceship(t,y,e,x,n,i,s,o){this.x=t,this.y=y,this.vx=e,this.vy=x,this.theta=n,this.width=20,this.height=15,this.yaw=i,this.x_points=s,this.y_points=o,this.shape="14.383032,5.9181762 0.35137621,0.04626516 2.7568063,5.9181762 0.35137621,11.338401"}function Shot(t,y,e,x,n,i,s,o,r,a){this.id=t,this.x=y,this.y=e,this.vx=x,this.vy=n,this.theta=i,this.width=6,this.height=6,this.yaw=s,this.life=o,this.x_points=r,this.y_points=a,this.changePosition=function(t,y){this.x=t,this.y=y},this.changeLife=function(t){this.life=t}}function resetWindowLimit(t){var y,e,x;if(e=window.innerHeight,x=window.innerHeight,"x"==t)for(y=window.innerWidth,i=0;i<asteroids.length;i++)asteroids[i].x>=e-asteroids[i].width&&asteroids[i].changePosition(e-asteroids[i].width,x-asteroids[i].height);else for(y=window.innerHeight,i=0;i<asteroids.length;i++)asteroids[i].y>=x-asteroids[i].height&&asteroids[i].changePosition(e-asteroids[i].width,y-asteroids[i].height);return y}function getRandomFloat(t,y){return Math.random()*(y-t)+t}function clearBullet(t){$("#shot"+shots[t].id).remove(),shots.splice(t,1)}function moveSpaceship(t){var y=Math.PI/180;0!=turn&&void 0!=turn?(spaceship.theta=spaceship.theta+turn*turn_per_milli*t,lifeCnt>0&&$("#sndTurn").get(0).play()):($("#sndTurn").get(0).pause(),$("#sndTurn").get(0).currentTime=0),0!=thrust&&void 0!=thrust?(del_vx=(del_v=thrust*thrust_per_milli*t)*Math.cos(spaceship.theta*y),del_vy=del_v*Math.sin(spaceship.theta*y),lifeCnt>0&&$("#sndPlayer").get(0).play()):(del_vx=0,del_vy=0,$("#sndPlayer").get(0).pause(),$("#sndPlayer").get(0).currentTime=0),spaceship.vx=spaceship.vx+del_vx,spaceship.vy=spaceship.vy+del_vy}function updateSpaceship(t){spaceship.x>=xLimit&&(spaceship.x=0),spaceship.x<0&&(spaceship.x=xLimit),spaceship.y>=yLimit&&(spaceship.y=0),spaceship.y<0&&(spaceship.y=yLimit),spaceship.theta+=spaceship.yaw*t,spaceship.x+=spaceship.vx*t,spaceship.y+=spaceship.vy*t,$("#spaceship").css("left",spaceship.x).css("top",spaceship.y).css({transform:"rotate("+spaceship.theta+"deg)"})}function hyperspace(){lifeCnt>0&&(jumpCnt>0?($("#sndHyperspace").get(0).currentTime=0,$("#sndHyperspace").get(0).play(),spaceship.x=getRandomFloat(1,xLimit-5),spaceship.y=getRandomFloat(1,yLimit-5),jumpCnt--,$("#HSCnt span").html(jumpCnt)):$("#sndHyperspaceFail").get(0).play())}function isPointInPoly(t,y){for(var e=!1,x=-1,n=t.length,i=n-1;++x<n;i=x)(t[x].y<=y.y&&y.y<t[i].y||t[i].y<=y.y&&y.y<t[x].y)&&y.x<(t[i].x-t[x].x)*(y.y-t[x].y)/(t[i].y-t[x].y)+t[x].x&&(e=!e);return e}function setCookie(t,y,e){var x=new Date;x.setTime(x.getTime()+24*e*60*60*1e3);var n="expires="+x.toUTCString();document.cookie=t+"="+y+";"+n+";path=/"}function getCookie(t){for(var y=t+"=",e=document.cookie.split(";"),x=0;x<e.length;x++){for(var n=e[x];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(y))return n.substring(y.length,n.length)}return""}function checkHighScoreCookie(){var t=getCookie("highScore");""!=t?setCookie("highScore",score,1e3):t<=score&&setCookie("highScore",score,1e3)}$(document).ready(function(){resetgame(),xLimit>768&&(inPlay=!1,$("#welcomeModel").modal("show"),$("#welcomeModel").on("hidden.bs.modal",function(t){inPlay=!0}));setInterval(function(){animateScreen(asteroids,shots)},delta_time)}),Intersection.prototype.init=function(t){this.status=t,this.points=new Array},Intersection.prototype.appendPoint=function(t){this.points.push(t)},Intersection.prototype.appendPoints=function(t){this.points=this.points.concat(t)},Intersection.intersectShapes=function(t,y){var e,x=t.getIntersectionParams(),n=y.getIntersectionParams();if(null!=x&&null!=n)if("Path"==x.name)e=Intersection.intersectPathShape(t,y);else if("Path"==n.name)e=Intersection.intersectPathShape(y,t);else{var i,s;if(x.name<n.name?(i="intersect"+x.name+n.name,s=x.params.concat(n.params)):(i="intersect"+n.name+x.name,s=n.params.concat(x.params)),!(i in Intersection))throw new Error("Intersection not available: "+i);e=Intersection[i].apply(null,s)}else e=new Intersection("No Intersection");return e},Intersection.intersectPathShape=function(t,y){return t.intersectShape(y)},Intersection.intersectBezier2Bezier2=function(t,y,e,x,n,i){var s,o,r,a,c,p,l,h,d,u=new Intersection("No Intersection");if(s=y.multiply(-2),r=t.add(s.add(e)),s=t.multiply(-2),o=y.multiply(2),a=s.add(o),c=new Point2D(t.x,t.y),s=n.multiply(-2),p=x.add(s.add(i)),s=x.multiply(-2),o=n.multiply(2),l=s.add(o),h=new Point2D(x.x,x.y),0==r.y){var m=(f=r.x*(c.y-h.y))+(w=f-a.x*a.y),g=a.y*a.y;d=new Polynomial(r.x*p.y*p.y,2*r.x*l.y*p.y,r.x*l.y*l.y-p.x*g-p.y*f-p.y*w,-l.x*g-l.y*f-l.y*w,(c.x-h.x)*g+(c.y-h.y)*w)}else{var f=r.x*p.y-r.y*p.x,w=r.x*l.y-l.x*r.y,I=(m=a.x*r.y-a.y*r.x,g=c.y-h.y,r.y*(c.x-h.x)-r.x*g),v=-a.y*m+r.y*I,P=m*m;d=new Polynomial(f*f,2*f*w,(-p.y*P+r.y*w*w+r.y*f*I+f*v)/r.y,(-l.y*P+r.y*w*I+w*v)/r.y,(g*P+I*v)/r.y)}for(var L=d.getRoots(),C=0;C<L.length;C++){var b=L[C];if(0<=b&&b<=1){var k=new Polynomial(r.x,a.x,c.x-h.x-b*l.x-b*b*p.x).getRoots(),D=new Polynomial(r.y,a.y,c.y-h.y-b*l.y-b*b*p.y).getRoots();if(k.length>0&&D.length>0){t:for(var $=0;$<k.length;$++){var R=k[$];if(0<=R&&R<=1)for(var S=0;S<D.length;S++)if(Math.abs(R-D[S])<1e-4){u.points.push(p.multiply(b*b).add(l.multiply(b).add(h)));break t}}}}}return u.points.length>0&&(u.status="Intersection"),u},Intersection.intersectBezier2Bezier3=function(t,y,e,x,n,i,s){var o,r,a,c,p,l,h,d,u,m,g,f=new Intersection("No Intersection");o=y.multiply(-2),p=t.add(o.add(e)),o=t.multiply(-2),r=y.multiply(2),l=o.add(r),h=new Point2D(t.x,t.y),o=x.multiply(-1),r=n.multiply(3),a=i.multiply(-3),c=o.add(r.add(a.add(s))),d=new Vector2D(c.x,c.y),o=x.multiply(3),r=n.multiply(-6),a=i.multiply(3),c=o.add(r.add(a)),u=new Vector2D(c.x,c.y),o=x.multiply(-3),r=n.multiply(3),a=o.add(r),m=new Vector2D(a.x,a.y),g=new Vector2D(x.x,x.y);for(var w=h.x*h.x,I=h.y*h.y,v=l.x*l.x,P=l.y*l.y,L=p.x*p.x,C=p.y*p.y,b=g.x*g.x,k=g.y*g.y,D=m.x*m.x,$=m.y*m.y,R=u.x*u.x,S=u.y*u.y,B=d.x*d.x,z=d.y*d.y,M=new Polynomial(-2*p.x*p.y*d.x*d.y+L*z+C*B,-2*p.x*p.y*u.x*d.y-2*p.x*p.y*u.y*d.x+2*C*u.x*d.x+2*L*u.y*d.y,-2*p.x*m.x*p.y*d.y-2*p.x*p.y*m.y*d.x-2*p.x*p.y*u.x*u.y+2*m.x*C*d.x+C*R+L*(2*m.y*d.y+S),2*h.x*p.x*p.y*d.y+2*h.y*p.x*p.y*d.x+l.x*l.y*p.x*d.y+l.x*l.y*p.y*d.x-2*g.x*p.x*p.y*d.y-2*p.x*g.y*p.y*d.x-2*p.x*m.x*p.y*u.y-2*p.x*p.y*m.y*u.x-2*h.x*C*d.x-2*h.y*L*d.y+2*g.x*C*d.x+2*m.x*C*u.x-P*p.x*d.x-v*p.y*d.y+L*(2*g.y*d.y+2*m.y*u.y),2*h.x*p.x*p.y*u.y+2*h.y*p.x*p.y*u.x+l.x*l.y*p.x*u.y+l.x*l.y*p.y*u.x-2*g.x*p.x*p.y*u.y-2*p.x*g.y*p.y*u.x-2*p.x*m.x*p.y*m.y-2*h.x*C*u.x-2*h.y*L*u.y+2*g.x*C*u.x-P*p.x*u.x-v*p.y*u.y+D*C+L*(2*g.y*u.y+$),2*h.x*p.x*p.y*m.y+2*h.y*p.x*m.x*p.y+l.x*l.y*p.x*m.y+l.x*l.y*m.x*p.y-2*g.x*p.x*p.y*m.y-2*p.x*g.y*m.x*p.y-2*h.x*m.x*C-2*h.y*L*m.y+2*g.x*m.x*C-P*p.x*m.x-v*p.y*m.y+2*L*g.y*m.y,-2*h.x*h.y*p.x*p.y-h.x*l.x*l.y*p.y-h.y*l.x*l.y*p.x+2*h.x*p.x*g.y*p.y+2*h.y*g.x*p.x*p.y+l.x*g.x*l.y*p.y+l.x*l.y*p.x*g.y-2*g.x*p.x*g.y*p.y-2*h.x*g.x*C+h.x*P*p.x+h.y*v*p.y-2*h.y*L*g.y-g.x*P*p.x-v*g.y*p.y+w*C+I*L+b*C+L*k).getRootsInInterval(0,1),V=0;V<M.length;V++){var _=M[V],N=new Polynomial(p.x,l.x,h.x-g.x-_*m.x-_*_*u.x-_*_*_*d.x).getRoots(),A=new Polynomial(p.y,l.y,h.y-g.y-_*m.y-_*_*u.y-_*_*_*d.y).getRoots();if(N.length>0&&A.length>0){t:for(var E=0;E<N.length;E++){var T=N[E];if(0<=T&&T<=1)for(var H=0;H<A.length;H++)if(Math.abs(T-A[H])<1e-4){f.points.push(d.multiply(_*_*_).add(u.multiply(_*_).add(m.multiply(_).add(g))));break t}}}}return f.points.length>0&&(f.status="Intersection"),f},Intersection.intersectBezier2Circle=function(t,y,e,x,n){return Intersection.intersectBezier2Ellipse(t,y,e,x,n,n)},Intersection.intersectBezier2Ellipse=function(t,y,e,x,n,i){var s,o,r,a,c,p=new Intersection("No Intersection");s=y.multiply(-2),r=t.add(s.add(e)),s=t.multiply(-2),o=y.multiply(2),a=s.add(o),c=new Point2D(t.x,t.y);for(var l=n*n,h=i*i,d=new Polynomial(h*r.x*r.x+l*r.y*r.y,2*(h*r.x*a.x+l*r.y*a.y),h*(2*r.x*c.x+a.x*a.x)+l*(2*r.y*c.y+a.y*a.y)-2*(h*x.x*r.x+l*x.y*r.y),2*(h*a.x*(c.x-x.x)+l*a.y*(c.y-x.y)),h*(c.x*c.x+x.x*x.x)+l*(c.y*c.y+x.y*x.y)-2*(h*x.x*c.x+l*x.y*c.y)-l*h).getRoots(),u=0;u<d.length;u++){var m=d[u];0<=m&&m<=1&&p.points.push(r.multiply(m*m).add(a.multiply(m).add(c)))}return p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectBezier2Line=function(t,y,e,x,n){var i,s,o,r,a,c,p,l=x.min(n),h=x.max(n),d=new Intersection("No Intersection");i=y.multiply(-2),o=t.add(i.add(e)),i=t.multiply(-2),s=y.multiply(2),r=i.add(s),a=new Point2D(t.x,t.y),p=new Vector2D(x.y-n.y,n.x-x.x),c=x.x*n.y-n.x*x.y,roots=new Polynomial(p.dot(o),p.dot(r),p.dot(a)+c).getRoots();for(var u=0;u<roots.length;u++){var m=roots[u];if(0<=m&&m<=1){var g=t.lerp(y,m),f=y.lerp(e,m),w=g.lerp(f,m);x.x==n.x?l.y<=w.y&&w.y<=h.y&&(d.status="Intersection",d.appendPoint(w)):x.y==n.y?l.x<=w.x&&w.x<=h.x&&(d.status="Intersection",d.appendPoint(w)):w.gte(l)&&w.lte(h)&&(d.status="Intersection",d.appendPoint(w))}}return d},Intersection.intersectBezier2Polygon=function(t,y,e,x){for(var n=new Intersection("No Intersection"),i=x.length,s=0;s<i;s++){var o=x[s],r=x[(s+1)%i],a=Intersection.intersectBezier2Line(t,y,e,o,r);n.appendPoints(a.points)}return n.points.length>0&&(n.status="Intersection"),n},Intersection.intersectBezier2Rectangle=function(t,y,e,x,n){var i=x.min(n),s=x.max(n),o=new Point2D(s.x,i.y),r=new Point2D(i.x,s.y),a=Intersection.intersectBezier2Line(t,y,e,i,o),c=Intersection.intersectBezier2Line(t,y,e,o,s),p=Intersection.intersectBezier2Line(t,y,e,s,r),l=Intersection.intersectBezier2Line(t,y,e,r,i),h=new Intersection("No Intersection");return h.appendPoints(a.points),h.appendPoints(c.points),h.appendPoints(p.points),h.appendPoints(l.points),h.points.length>0&&(h.status="Intersection"),h},Intersection.intersectBezier3Bezier3=function(t,y,e,x,n,i,s,o){var r,a,c,p,l,h,d,u,m,g,f,w,I=new Intersection("No Intersection");r=t.multiply(-1),a=y.multiply(3),c=e.multiply(-3),p=r.add(a.add(c.add(x))),l=new Vector2D(p.x,p.y),r=t.multiply(3),a=y.multiply(-6),c=e.multiply(3),p=r.add(a.add(c)),h=new Vector2D(p.x,p.y),r=t.multiply(-3),a=y.multiply(3),c=r.add(a),d=new Vector2D(c.x,c.y),u=new Vector2D(t.x,t.y),r=n.multiply(-1),a=i.multiply(3),c=s.multiply(-3),p=r.add(a.add(c.add(o))),m=new Vector2D(p.x,p.y),r=n.multiply(3),a=i.multiply(-6),c=s.multiply(3),p=r.add(a.add(c)),g=new Vector2D(p.x,p.y),r=n.multiply(-3),a=i.multiply(3),c=r.add(a),f=new Vector2D(c.x,c.y),w=new Vector2D(n.x,n.y);for(var v=u.x*u.x,P=u.x*u.x*u.x,L=u.y*u.y,C=u.y*u.y*u.y,b=d.x*d.x,k=d.x*d.x*d.x,D=d.y*d.y,$=d.y*d.y*d.y,R=h.x*h.x,S=h.x*h.x*h.x,B=h.y*h.y,z=h.y*h.y*h.y,M=l.x*l.x,V=l.x*l.x*l.x,_=l.y*l.y,N=l.y*l.y*l.y,A=w.x*w.x,E=w.x*w.x*w.x,T=w.y*w.y,H=w.y*w.y*w.y,j=f.x*f.x,F=f.x*f.x*f.x,O=f.y*f.y,W=g.x*g.x,G=g.x*g.x*g.x,q=g.y*g.y,U=m.x*m.x,Z=m.x*m.x*m.x,J=m.y*m.y,K=m.y*m.y*m.y,Q=new Polynomial(-V*K+N*Z-3*l.x*_*U*m.y+3*M*l.y*m.x*J,-6*l.x*g.x*_*m.x*m.y+6*M*l.y*g.y*m.x*m.y+3*g.x*N*U-3*V*g.y*J-3*l.x*_*g.y*U+3*M*g.x*l.y*J,-6*f.x*l.x*_*m.x*m.y-6*l.x*g.x*_*g.y*m.x+6*M*g.x*l.y*g.y*m.y+3*f.x*N*U+3*W*N*m.x+3*f.x*M*l.y*J-3*l.x*f.y*_*U-3*l.x*W*_*m.y+M*l.y*m.x*(6*f.y*m.y+3*q)+V*(-f.y*J-2*q*m.y-m.y*(2*f.y*m.y+q)),d.x*h.y*l.x*l.y*m.x*m.y-d.y*h.x*l.x*l.y*m.x*m.y+6*f.x*g.x*N*m.x+3*d.x*h.x*l.x*l.y*J+6*u.x*l.x*_*m.x*m.y-3*d.x*h.x*_*m.x*m.y-3*d.y*h.y*l.x*l.y*U-6*u.y*M*l.y*m.x*m.y-6*w.x*l.x*_*m.x*m.y+3*d.y*h.y*M*m.x*m.y-2*h.x*B*l.x*m.x*m.y-6*f.x*l.x*g.x*_*m.y-6*f.x*l.x*_*g.y*m.x-6*l.x*f.y*g.x*_*m.x+6*f.x*M*l.y*g.y*m.y+2*R*h.y*l.y*m.x*m.y+G*N-3*u.x*N*U+3*u.y*V*J+3*w.x*N*U+z*l.x*U-S*l.y*J-3*u.x*M*l.y*J+3*u.y*l.x*_*U-2*d.x*h.y*M*J+d.x*h.y*_*U-d.y*h.x*M*J+2*d.y*h.x*_*U+3*w.x*M*l.y*J-h.x*B*l.y*U-3*w.y*l.x*_*U+R*h.y*l.x*J-3*l.x*W*_*g.y+M*l.y*m.x*(6*w.y*m.y+6*f.y*g.y)+M*g.x*l.y*(6*f.y*m.y+3*q)+V*(-2*f.y*g.y*m.y-w.y*J-g.y*(2*f.y*m.y+q)-m.y*(2*w.y*m.y+2*f.y*g.y)),6*d.x*h.x*l.x*l.y*g.y*m.y+d.x*h.y*l.x*g.x*l.y*m.y+d.x*h.y*l.x*l.y*g.y*m.x-d.y*h.x*l.x*g.x*l.y*m.y-d.y*h.x*l.x*l.y*g.y*m.x-6*d.y*h.y*l.x*g.x*l.y*m.x-6*u.x*g.x*N*m.x+6*w.x*g.x*N*m.x+6*u.y*V*g.y*m.y+2*z*l.x*g.x*m.x-2*S*l.y*g.y*m.y+6*u.x*l.x*g.x*_*m.y+6*u.x*l.x*_*g.y*m.x+6*u.y*l.x*g.x*_*m.x-3*d.x*h.x*g.x*_*m.y-3*d.x*h.x*_*g.y*m.x+2*d.x*h.y*g.x*_*m.x+4*d.y*h.x*g.x*_*m.x-6*u.x*M*l.y*g.y*m.y-6*u.y*M*g.x*l.y*m.y-6*u.y*M*l.y*g.y*m.x-4*d.x*h.y*M*g.y*m.y-6*w.x*l.x*g.x*_*m.y-6*w.x*l.x*_*g.y*m.x-2*d.y*h.x*M*g.y*m.y+3*d.y*h.y*M*g.x*m.y+3*d.y*h.y*M*g.y*m.x-2*h.x*B*l.x*g.x*m.y-2*h.x*B*l.x*g.y*m.x-2*h.x*B*g.x*l.y*m.x-6*w.y*l.x*g.x*_*m.x-6*f.x*l.x*f.y*_*m.x-6*f.x*l.x*g.x*_*g.y+6*w.x*M*l.y*g.y*m.y+2*R*h.y*l.x*g.y*m.y+2*R*h.y*g.x*l.y*m.y+2*R*h.y*l.y*g.y*m.x+3*f.x*W*N+3*j*N*m.x-3*l.x*f.y*W*_-3*j*l.x*_*m.y+M*g.x*l.y*(6*w.y*m.y+6*f.y*g.y)+M*l.y*m.x*(6*w.y*g.y+3*O)+f.x*M*l.y*(6*f.y*m.y+3*q)+V*(-2*w.y*g.y*m.y-m.y*(2*w.y*g.y+O)-f.y*(2*f.y*m.y+q)-g.y*(2*w.y*m.y+2*f.y*g.y)),d.x*f.x*h.y*l.x*l.y*m.y+d.x*h.y*l.x*f.y*l.y*m.x+d.x*h.y*l.x*g.x*l.y*g.y-d.y*h.x*f.x*l.x*l.y*m.y-d.y*h.x*l.x*f.y*l.y*m.x-d.y*h.x*l.x*g.x*l.y*g.y-6*d.y*f.x*h.y*l.x*l.y*m.x-6*u.x*f.x*N*m.x+6*w.x*f.x*N*m.x+2*f.x*z*l.x*m.x+6*u.x*f.x*l.x*_*m.y+6*u.x*l.x*f.y*_*m.x+6*u.x*l.x*g.x*_*g.y+6*u.y*f.x*l.x*_*m.x-3*d.x*h.x*f.x*_*m.y-3*d.x*h.x*f.y*_*m.x-3*d.x*h.x*g.x*_*g.y+2*d.x*f.x*h.y*_*m.x+4*d.y*h.x*f.x*_*m.x-6*u.y*f.x*M*l.y*m.y-6*u.y*M*f.y*l.y*m.x-6*u.y*M*g.x*l.y*g.y-6*w.x*f.x*l.x*_*m.y-6*w.x*l.x*f.y*_*m.x-6*w.x*l.x*g.x*_*g.y+3*d.y*f.x*h.y*M*m.y-3*d.y*h.y*l.x*W*l.y+3*d.y*h.y*M*f.y*m.x+3*d.y*h.y*M*g.x*g.y-2*h.x*f.x*B*l.x*m.y-2*h.x*f.x*B*l.y*m.x-2*h.x*B*l.x*f.y*m.x-2*h.x*B*l.x*g.x*g.y-6*w.y*f.x*l.x*_*m.x-6*f.x*l.x*f.y*g.x*_+6*w.y*M*f.y*l.y*m.x+2*R*f.x*h.y*l.y*m.y+2*R*h.y*f.y*l.y*m.x+2*R*h.y*g.x*l.y*g.y-3*u.x*W*N+3*w.x*W*N+3*j*g.x*N+z*l.x*W+3*u.y*l.x*W*_+d.x*h.y*W*_+2*d.y*h.x*W*_-h.x*B*W*l.y-3*w.y*l.x*W*_-3*j*l.x*_*g.y+R*h.y*l.x*(2*f.y*m.y+q)+d.x*h.x*l.x*l.y*(6*f.y*m.y+3*q)+f.x*M*l.y*(6*w.y*m.y+6*f.y*g.y)+S*l.y*(-2*f.y*m.y-q)+u.y*V*(6*f.y*m.y+3*q)+d.y*h.x*M*(-2*f.y*m.y-q)+d.x*h.y*M*(-4*f.y*m.y-2*q)+u.x*M*l.y*(-6*f.y*m.y-3*q)+M*g.x*l.y*(6*w.y*g.y+3*O)+w.x*M*l.y*(6*f.y*m.y+3*q)+V*(-2*w.y*f.y*m.y-g.y*(2*w.y*g.y+O)-w.y*(2*f.y*m.y+q)-f.y*(2*w.y*m.y+2*f.y*g.y)),-u.x*d.x*h.y*l.x*l.y*m.y+u.x*d.y*h.x*l.x*l.y*m.y+6*u.x*d.y*h.y*l.x*l.y*m.x-6*u.y*d.x*h.x*l.x*l.y*m.y-u.y*d.x*h.y*l.x*l.y*m.x+u.y*d.y*h.x*l.x*l.y*m.x+d.x*d.y*h.x*h.y*l.x*m.y-d.x*d.y*h.x*h.y*l.y*m.x+d.x*w.x*h.y*l.x*l.y*m.y+d.x*w.y*h.y*l.x*l.y*m.x+d.x*f.x*h.y*l.x*l.y*g.y+d.x*h.y*l.x*f.y*g.x*l.y-w.x*d.y*h.x*l.x*l.y*m.y-6*w.x*d.y*h.y*l.x*l.y*m.x-d.y*h.x*w.y*l.x*l.y*m.x-d.y*h.x*f.x*l.x*l.y*g.y-d.y*h.x*l.x*f.y*g.x*l.y-6*d.y*f.x*h.y*l.x*g.x*l.y-6*u.x*w.x*N*m.x-6*u.x*f.x*g.x*N-2*u.x*z*l.x*m.x+6*w.x*f.x*g.x*N+2*w.x*z*l.x*m.x+2*f.x*z*l.x*g.x+2*u.y*S*l.y*m.y-6*u.x*u.y*l.x*_*m.x+3*u.x*d.x*h.x*_*m.y-2*u.x*d.x*h.y*_*m.x-4*u.x*d.y*h.x*_*m.x+3*u.y*d.x*h.x*_*m.x+6*u.x*u.y*M*l.y*m.y+6*u.x*w.x*l.x*_*m.y-3*u.x*d.y*h.y*M*m.y+2*u.x*h.x*B*l.x*m.y+2*u.x*h.x*B*l.y*m.x+6*u.x*w.y*l.x*_*m.x+6*u.x*f.x*l.x*_*g.y+6*u.x*l.x*f.y*g.x*_+4*u.y*d.x*h.y*M*m.y+6*u.y*w.x*l.x*_*m.x+2*u.y*d.y*h.x*M*m.y-3*u.y*d.y*h.y*M*m.x+2*u.y*h.x*B*l.x*m.x+6*u.y*f.x*l.x*g.x*_-3*d.x*w.x*h.x*_*m.y+2*d.x*w.x*h.y*_*m.x+d.x*d.y*B*l.x*m.x-3*d.x*h.x*w.y*_*m.x-3*d.x*h.x*f.x*_*g.y-3*d.x*h.x*f.y*g.x*_+2*d.x*f.x*h.y*g.x*_+4*w.x*d.y*h.x*_*m.x+4*d.y*h.x*f.x*g.x*_-2*u.x*R*h.y*l.y*m.y-6*u.y*w.x*M*l.y*m.y-6*u.y*w.y*M*l.y*m.x-6*u.y*f.x*M*l.y*g.y-2*u.y*R*h.y*l.x*m.y-2*u.y*R*h.y*l.y*m.x-6*u.y*M*f.y*g.x*l.y-d.x*d.y*R*l.y*m.y-2*d.x*D*l.x*l.y*m.x+3*w.x*d.y*h.y*M*m.y-2*w.x*h.x*B*l.x*m.y-2*w.x*h.x*B*l.y*m.x-6*w.x*w.y*l.x*_*m.x-6*w.x*f.x*l.x*_*g.y-6*w.x*l.x*f.y*g.x*_+3*d.y*w.y*h.y*M*m.x+3*d.y*f.x*h.y*M*g.y+3*d.y*h.y*M*f.y*g.x-2*h.x*w.y*B*l.x*m.x-2*h.x*f.x*B*l.x*g.y-2*h.x*f.x*B*g.x*l.y-2*h.x*B*l.x*f.y*g.x-6*w.y*f.x*l.x*g.x*_-D*h.x*h.y*l.x*m.x+2*w.x*R*h.y*l.y*m.y+6*w.y*M*f.y*g.x*l.y+2*b*d.y*l.x*l.y*m.y+b*h.x*h.y*l.y*m.y+2*R*w.y*h.y*l.y*m.x+2*R*f.x*h.y*l.y*g.y+2*R*h.y*f.y*g.x*l.y+F*N+3*v*N*m.x-3*L*V*m.y+3*A*N*m.x+$*M*m.x-k*_*m.y-d.x*D*M*m.y+b*d.y*_*m.x-3*v*l.x*_*m.y+3*L*M*l.y*m.x-b*B*l.x*m.y+D*R*l.y*m.x-3*j*l.x*f.y*_-3*A*l.x*_*m.y+3*T*M*l.y*m.x+d.x*h.x*l.x*l.y*(6*w.y*m.y+6*f.y*g.y)+S*l.y*(-2*w.y*m.y-2*f.y*g.y)+u.y*V*(6*w.y*m.y+6*f.y*g.y)+d.y*h.x*M*(-2*w.y*m.y-2*f.y*g.y)+R*h.y*l.x*(2*w.y*m.y+2*f.y*g.y)+d.x*h.y*M*(-4*w.y*m.y-4*f.y*g.y)+u.x*M*l.y*(-6*w.y*m.y-6*f.y*g.y)+w.x*M*l.y*(6*w.y*m.y+6*f.y*g.y)+f.x*M*l.y*(6*w.y*g.y+3*O)+V*(-2*w.y*f.y*g.y-T*m.y-f.y*(2*w.y*g.y+O)-w.y*(2*w.y*m.y+2*f.y*g.y)),-u.x*d.x*h.y*l.x*l.y*g.y+u.x*d.y*h.x*l.x*l.y*g.y+6*u.x*d.y*h.y*l.x*g.x*l.y-6*u.y*d.x*h.x*l.x*l.y*g.y-u.y*d.x*h.y*l.x*g.x*l.y+u.y*d.y*h.x*l.x*g.x*l.y+d.x*d.y*h.x*h.y*l.x*g.y-d.x*d.y*h.x*h.y*g.x*l.y+d.x*w.x*h.y*l.x*l.y*g.y+d.x*w.y*h.y*l.x*g.x*l.y+d.x*f.x*h.y*l.x*f.y*l.y-w.x*d.y*h.x*l.x*l.y*g.y-6*w.x*d.y*h.y*l.x*g.x*l.y-d.y*h.x*w.y*l.x*g.x*l.y-d.y*h.x*f.x*l.x*f.y*l.y-6*u.x*w.x*g.x*N-2*u.x*z*l.x*g.x+2*w.x*z*l.x*g.x+2*u.y*S*l.y*g.y-6*u.x*u.y*l.x*g.x*_+3*u.x*d.x*h.x*_*g.y-2*u.x*d.x*h.y*g.x*_-4*u.x*d.y*h.x*g.x*_+3*u.y*d.x*h.x*g.x*_+6*u.x*u.y*M*l.y*g.y+6*u.x*w.x*l.x*_*g.y-3*u.x*d.y*h.y*M*g.y+2*u.x*h.x*B*l.x*g.y+2*u.x*h.x*B*g.x*l.y+6*u.x*w.y*l.x*g.x*_+6*u.x*f.x*l.x*f.y*_+4*u.y*d.x*h.y*M*g.y+6*u.y*w.x*l.x*g.x*_+2*u.y*d.y*h.x*M*g.y-3*u.y*d.y*h.y*M*g.x+2*u.y*h.x*B*l.x*g.x-3*d.x*w.x*h.x*_*g.y+2*d.x*w.x*h.y*g.x*_+d.x*d.y*B*l.x*g.x-3*d.x*h.x*w.y*g.x*_-3*d.x*h.x*f.x*f.y*_+4*w.x*d.y*h.x*g.x*_-2*u.x*R*h.y*l.y*g.y-6*u.y*w.x*M*l.y*g.y-6*u.y*w.y*M*g.x*l.y-6*u.y*f.x*M*f.y*l.y-2*u.y*R*h.y*l.x*g.y-2*u.y*R*h.y*g.x*l.y-d.x*d.y*R*l.y*g.y-2*d.x*D*l.x*g.x*l.y+3*w.x*d.y*h.y*M*g.y-2*w.x*h.x*B*l.x*g.y-2*w.x*h.x*B*g.x*l.y-6*w.x*w.y*l.x*g.x*_-6*w.x*f.x*l.x*f.y*_+3*d.y*w.y*h.y*M*g.x+3*d.y*f.x*h.y*M*f.y-2*h.x*w.y*B*l.x*g.x-2*h.x*f.x*B*l.x*f.y-D*h.x*h.y*l.x*g.x+2*w.x*R*h.y*l.y*g.y-3*d.y*j*h.y*l.x*l.y+6*w.y*f.x*M*f.y*l.y+2*b*d.y*l.x*l.y*g.y+b*h.x*h.y*l.y*g.y+2*R*w.y*h.y*g.x*l.y+2*R*f.x*h.y*f.y*l.y-3*u.x*j*N+3*w.x*j*N+3*v*g.x*N-3*L*V*g.y+3*A*g.x*N+j*z*l.x+$*M*g.x-k*_*g.y+3*u.y*j*l.x*_-d.x*D*M*g.y+d.x*j*h.y*_+2*d.y*h.x*j*_+b*d.y*g.x*_-h.x*j*B*l.y-3*w.y*j*l.x*_-3*v*l.x*_*g.y+3*L*M*g.x*l.y-b*B*l.x*g.y+D*R*g.x*l.y-3*A*l.x*_*g.y+3*T*M*g.x*l.y+R*h.y*l.x*(2*w.y*g.y+O)+d.x*h.x*l.x*l.y*(6*w.y*g.y+3*O)+S*l.y*(-2*w.y*g.y-O)+u.y*V*(6*w.y*g.y+3*O)+d.y*h.x*M*(-2*w.y*g.y-O)+d.x*h.y*M*(-4*w.y*g.y-2*O)+u.x*M*l.y*(-6*w.y*g.y-3*O)+w.x*M*l.y*(6*w.y*g.y+3*O)+V*(-2*w.y*O-T*g.y-w.y*(2*w.y*g.y+O)),-u.x*d.x*h.y*l.x*f.y*l.y+u.x*d.y*h.x*l.x*f.y*l.y+6*u.x*d.y*f.x*h.y*l.x*l.y-6*u.y*d.x*h.x*l.x*f.y*l.y-u.y*d.x*f.x*h.y*l.x*l.y+u.y*d.y*h.x*f.x*l.x*l.y-d.x*d.y*h.x*f.x*h.y*l.y+d.x*d.y*h.x*h.y*l.x*f.y+d.x*w.x*h.y*l.x*f.y*l.y+6*d.x*h.x*w.y*l.x*f.y*l.y+d.x*w.y*f.x*h.y*l.x*l.y-w.x*d.y*h.x*l.x*f.y*l.y-6*w.x*d.y*f.x*h.y*l.x*l.y-d.y*h.x*w.y*f.x*l.x*l.y-6*u.x*w.x*f.x*N-2*u.x*f.x*z*l.x+6*u.y*w.y*V*f.y+2*w.x*f.x*z*l.x+2*u.y*S*f.y*l.y-2*S*w.y*f.y*l.y-6*u.x*u.y*f.x*l.x*_+3*u.x*d.x*h.x*f.y*_-2*u.x*d.x*f.x*h.y*_-4*u.x*d.y*h.x*f.x*_+3*u.y*d.x*h.x*f.x*_+6*u.x*u.y*M*f.y*l.y+6*u.x*w.x*l.x*f.y*_-3*u.x*d.y*h.y*M*f.y+2*u.x*h.x*f.x*B*l.y+2*u.x*h.x*B*l.x*f.y+6*u.x*w.y*f.x*l.x*_+4*u.y*d.x*h.y*M*f.y+6*u.y*w.x*f.x*l.x*_+2*u.y*d.y*h.x*M*f.y-3*u.y*d.y*f.x*h.y*M+2*u.y*h.x*f.x*B*l.x-3*d.x*w.x*h.x*f.y*_+2*d.x*w.x*f.x*h.y*_+d.x*d.y*f.x*B*l.x-3*d.x*h.x*w.y*f.x*_+4*w.x*d.y*h.x*f.x*_-6*u.x*w.y*M*f.y*l.y-2*u.x*R*h.y*f.y*l.y-6*u.y*w.x*M*f.y*l.y-6*u.y*w.y*f.x*M*l.y-2*u.y*R*f.x*h.y*l.y-2*u.y*R*h.y*l.x*f.y-d.x*d.y*R*f.y*l.y-4*d.x*w.y*h.y*M*f.y-2*d.x*D*f.x*l.x*l.y+3*w.x*d.y*h.y*M*f.y-2*w.x*h.x*f.x*B*l.y-2*w.x*h.x*B*l.x*f.y-6*w.x*w.y*f.x*l.x*_-2*d.y*h.x*w.y*M*f.y+3*d.y*w.y*f.x*h.y*M-2*h.x*w.y*f.x*B*l.x-D*h.x*f.x*h.y*l.x+6*w.x*w.y*M*f.y*l.y+2*w.x*R*h.y*f.y*l.y+2*b*d.y*l.x*f.y*l.y+b*h.x*h.y*f.y*l.y+2*R*w.y*f.x*h.y*l.y+2*R*w.y*h.y*l.x*f.y+3*v*f.x*N-3*L*V*f.y+3*A*f.x*N+$*f.x*M-k*f.y*_-3*T*V*f.y-d.x*D*M*f.y+b*d.y*f.x*_-3*v*l.x*f.y*_+3*L*f.x*M*l.y-b*B*l.x*f.y+D*R*f.x*l.y-3*A*l.x*f.y*_+3*T*f.x*M*l.y,u.x*u.y*d.x*h.y*l.x*l.y-u.x*u.y*d.y*h.x*l.x*l.y+u.x*d.x*d.y*h.x*h.y*l.y-u.y*d.x*d.y*h.x*h.y*l.x-u.x*d.x*w.y*h.y*l.x*l.y+6*u.x*w.x*d.y*h.y*l.x*l.y+u.x*d.y*h.x*w.y*l.x*l.y-u.y*d.x*w.x*h.y*l.x*l.y-6*u.y*d.x*h.x*w.y*l.x*l.y+u.y*w.x*d.y*h.x*l.x*l.y-d.x*w.x*d.y*h.x*h.y*l.y+d.x*d.y*h.x*w.y*h.y*l.x+d.x*w.x*w.y*h.y*l.x*l.y-w.x*d.y*h.x*w.y*l.x*l.y-2*u.x*w.x*z*l.x+2*u.y*S*w.y*l.y-3*u.x*u.y*d.x*h.x*_-6*u.x*u.y*w.x*l.x*_+3*u.x*u.y*d.y*h.y*M-2*u.x*u.y*h.x*B*l.x-2*u.x*d.x*w.x*h.y*_-u.x*d.x*d.y*B*l.x+3*u.x*d.x*h.x*w.y*_-4*u.x*w.x*d.y*h.x*_+3*u.y*d.x*w.x*h.x*_+6*u.x*u.y*w.y*M*l.y+2*u.x*u.y*R*h.y*l.y+2*u.x*d.x*D*l.x*l.y+2*u.x*w.x*h.x*B*l.y+6*u.x*w.x*w.y*l.x*_-3*u.x*d.y*w.y*h.y*M+2*u.x*h.x*w.y*B*l.x+u.x*D*h.x*h.y*l.x+u.y*d.x*d.y*R*l.y+4*u.y*d.x*w.y*h.y*M-3*u.y*w.x*d.y*h.y*M+2*u.y*w.x*h.x*B*l.x+2*u.y*d.y*h.x*w.y*M+d.x*w.x*d.y*B*l.x-3*d.x*w.x*h.x*w.y*_-2*u.x*R*w.y*h.y*l.y-6*u.y*w.x*w.y*M*l.y-2*u.y*w.x*R*h.y*l.y-2*u.y*b*d.y*l.x*l.y-u.y*b*h.x*h.y*l.y-2*u.y*R*w.y*h.y*l.x-2*d.x*w.x*D*l.x*l.y-d.x*d.y*R*w.y*l.y+3*w.x*d.y*w.y*h.y*M-2*w.x*h.x*w.y*B*l.x-w.x*D*h.x*h.y*l.x+3*L*d.x*h.x*l.x*l.y+3*d.x*h.x*T*l.x*l.y+2*w.x*R*w.y*h.y*l.y-3*v*d.y*h.y*l.x*l.y+2*b*d.y*w.y*l.x*l.y+b*h.x*w.y*h.y*l.y-3*A*d.y*h.y*l.x*l.y-P*N+C*V+E*N-H*V-3*u.x*A*N-u.x*$*M+3*v*w.x*N+u.y*k*_+3*u.y*T*V+w.x*$*M+v*z*l.x-3*L*w.y*V-L*S*l.y+A*z*l.x-k*w.y*_-S*T*l.y-u.x*b*d.y*_+u.y*d.x*D*M-3*u.x*L*M*l.y-u.x*D*R*l.y+u.y*b*B*l.x-d.x*D*w.y*M+3*v*u.y*l.x*_+v*d.x*h.y*_+2*v*d.y*h.x*_-2*L*d.x*h.y*M-L*d.y*h.x*M+b*w.x*d.y*_-3*u.x*T*M*l.y+3*u.y*A*l.x*_+d.x*A*h.y*_-2*d.x*T*h.y*M+w.x*D*R*l.y-d.y*h.x*T*M-v*h.x*B*l.y-3*v*w.y*l.x*_+3*L*w.x*M*l.y+L*R*h.y*l.x-b*w.y*B*l.x+2*A*d.y*h.x*_+3*w.x*T*M*l.y-A*h.x*B*l.y-3*A*w.y*l.x*_+R*T*h.y*l.x).getRootsInInterval(0,1),X=0;X<Q.length;X++){var Y=Q[X],tt=new Polynomial(l.x,h.x,d.x,u.x-w.x-Y*f.x-Y*Y*g.x-Y*Y*Y*m.x).getRoots(),yt=new Polynomial(l.y,h.y,d.y,u.y-w.y-Y*f.y-Y*Y*g.y-Y*Y*Y*m.y).getRoots();if(tt.length>0&&yt.length>0){t:for(var et=0;et<tt.length;et++){var xt=tt[et];if(0<=xt&&xt<=1)for(var nt=0;nt<yt.length;nt++)if(Math.abs(xt-yt[nt])<1e-4){I.points.push(m.multiply(Y*Y*Y).add(g.multiply(Y*Y).add(f.multiply(Y).add(w))));break t}}}}return I.points.length>0&&(I.status="Intersection"),I},Intersection.intersectBezier3Circle=function(t,y,e,x,n,i){return Intersection.intersectBezier3Ellipse(t,y,e,x,n,i,i)},Intersection.intersectBezier3Ellipse=function(t,y,e,x,n,i,s){var o,r,a,c,p,l,h,d,u=new Intersection("No Intersection");o=t.multiply(-1),r=y.multiply(3),a=e.multiply(-3),c=o.add(r.add(a.add(x))),p=new Vector2D(c.x,c.y),o=t.multiply(3),r=y.multiply(-6),a=e.multiply(3),c=o.add(r.add(a)),l=new Vector2D(c.x,c.y),o=t.multiply(-3),r=y.multiply(3),a=o.add(r),h=new Vector2D(a.x,a.y),d=new Vector2D(t.x,t.y);for(var m=i*i,g=s*s,f=new Polynomial(p.x*p.x*g+p.y*p.y*m,2*(p.x*l.x*g+p.y*l.y*m),2*(p.x*h.x*g+p.y*h.y*m)+l.x*l.x*g+l.y*l.y*m,2*p.x*g*(d.x-n.x)+2*p.y*m*(d.y-n.y)+2*(l.x*h.x*g+l.y*h.y*m),2*l.x*g*(d.x-n.x)+2*l.y*m*(d.y-n.y)+h.x*h.x*g+h.y*h.y*m,2*h.x*g*(d.x-n.x)+2*h.y*m*(d.y-n.y),d.x*d.x*g-2*d.y*n.y*m-2*d.x*n.x*g+d.y*d.y*m+n.x*n.x*g+n.y*n.y*m-m*g).getRootsInInterval(0,1),w=0;w<f.length;w++){var I=f[w];u.points.push(p.multiply(I*I*I).add(l.multiply(I*I).add(h.multiply(I).add(d))))}return u.points.length>0&&(u.status="Intersection"),u},Intersection.intersectBezier3Line=function(t,y,e,x,n,i){var s,o,r,a,c,p,l,h,d,u,m=n.min(i),g=n.max(i),f=new Intersection("No Intersection");s=t.multiply(-1),o=y.multiply(3),r=e.multiply(-3),a=s.add(o.add(r.add(x))),c=new Vector2D(a.x,a.y),s=t.multiply(3),o=y.multiply(-6),r=e.multiply(3),a=s.add(o.add(r)),p=new Vector2D(a.x,a.y),s=t.multiply(-3),o=y.multiply(3),r=s.add(o),l=new Vector2D(r.x,r.y),h=new Vector2D(t.x,t.y),u=new Vector2D(n.y-i.y,i.x-n.x),d=n.x*i.y-i.x*n.y,roots=new Polynomial(u.dot(c),u.dot(p),u.dot(l),u.dot(h)+d).getRoots();for(var w=0;w<roots.length;w++){var I=roots[w];if(0<=I&&I<=1){var v=t.lerp(y,I),P=y.lerp(e,I),L=e.lerp(x,I),C=v.lerp(P,I),b=P.lerp(L,I),k=C.lerp(b,I);n.x==i.x?m.y<=k.y&&k.y<=g.y&&(f.status="Intersection",f.appendPoint(k)):n.y==i.y?m.x<=k.x&&k.x<=g.x&&(f.status="Intersection",f.appendPoint(k)):k.gte(m)&&k.lte(g)&&(f.status="Intersection",f.appendPoint(k))}}return f},Intersection.intersectBezier3Polygon=function(t,y,e,x,n){for(var i=new Intersection("No Intersection"),s=n.length,o=0;o<s;o++){var r=n[o],a=n[(o+1)%s],c=Intersection.intersectBezier3Line(t,y,e,x,r,a);i.appendPoints(c.points)}return i.points.length>0&&(i.status="Intersection"),i},Intersection.intersectBezier3Rectangle=function(t,y,e,x,n,i){var s=n.min(i),o=n.max(i),r=new Point2D(o.x,s.y),a=new Point2D(s.x,o.y),c=Intersection.intersectBezier3Line(t,y,e,x,s,r),p=Intersection.intersectBezier3Line(t,y,e,x,r,o),l=Intersection.intersectBezier3Line(t,y,e,x,o,a),h=Intersection.intersectBezier3Line(t,y,e,x,a,s),d=new Intersection("No Intersection");return d.appendPoints(c.points),d.appendPoints(p.points),d.appendPoints(l.points),d.appendPoints(h.points),d.points.length>0&&(d.status="Intersection"),d},Intersection.intersectCircleCircle=function(t,y,e,x){var n,i=y+x,s=Math.abs(y-x),o=t.distanceFrom(e);if(o>i)n=new Intersection("Outside");else if(o<s)n=new Intersection("Inside");else{n=new Intersection("Intersection");var r=(y*y-x*x+o*o)/(2*o),a=Math.sqrt(y*y-r*r),c=t.lerp(e,r/o),p=a/o;n.points.push(new Point2D(c.x-p*(e.y-t.y),c.y+p*(e.x-t.x))),n.points.push(new Point2D(c.x+p*(e.y-t.y),c.y-p*(e.x-t.x)))}return n},Intersection.intersectCircleEllipse=function(t,y,e,x,n){return Intersection.intersectEllipseEllipse(t,y,y,e,x,n)},Intersection.intersectCircleLine=function(t,y,e,x){var n,i=(x.x-e.x)*(x.x-e.x)+(x.y-e.y)*(x.y-e.y),s=2*((x.x-e.x)*(e.x-t.x)+(x.y-e.y)*(e.y-t.y)),o=s*s-4*i*(t.x*t.x+t.y*t.y+e.x*e.x+e.y*e.y-2*(t.x*e.x+t.y*e.y)-y*y);if(o<0)n=new Intersection("Outside");else if(0==o)n=new Intersection("Tangent");else{var r=Math.sqrt(o),a=(-s+r)/(2*i),c=(-s-r)/(2*i);(a<0||a>1)&&(c<0||c>1)?n=new Intersection(a<0&&c<0||a>1&&c>1?"Outside":"Inside"):(n=new Intersection("Intersection"),0<=a&&a<=1&&n.points.push(e.lerp(x,a)),0<=c&&c<=1&&n.points.push(e.lerp(x,c)))}return n},Intersection.intersectCirclePolygon=function(t,y,e){for(var x,n=new Intersection("No Intersection"),i=e.length,s=0;s<i;s++){var o=e[s],r=e[(s+1)%i];x=Intersection.intersectCircleLine(t,y,o,r),n.appendPoints(x.points)}return n.points.length>0?n.status="Intersection":n.status=x.status,n},Intersection.intersectCircleRectangle=function(t,y,e,x){var n=e.min(x),i=e.max(x),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectCircleLine(t,y,n,s),a=Intersection.intersectCircleLine(t,y,s,i),c=Intersection.intersectCircleLine(t,y,i,o),p=Intersection.intersectCircleLine(t,y,o,n),l=new Intersection("No Intersection");return l.appendPoints(r.points),l.appendPoints(a.points),l.appendPoints(c.points),l.appendPoints(p.points),l.points.length>0?l.status="Intersection":l.status=r.status,l},Intersection.intersectEllipseEllipse=function(t,y,e,x,n,i){for(var s=[e*e,0,y*y,-2*e*e*t.x,-2*y*y*t.y,e*e*t.x*t.x+y*y*t.y*t.y-y*y*e*e],o=[i*i,0,n*n,-2*i*i*x.x,-2*n*n*x.y,i*i*x.x*x.x+n*n*x.y*x.y-n*n*i*i],r=Intersection.bezout(s,o).getRoots(),a=.001*(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2]),c=.001*(o[0]*o[0]+2*o[1]*o[1]+o[2]*o[2]),p=new Intersection("No Intersection"),l=0;l<r.length;l++)for(var h=new Polynomial(s[0],s[3]+r[l]*s[1],s[5]+r[l]*(s[4]+r[l]*s[2])).getRoots(),d=0;d<h.length;d++){var u=(s[0]*h[d]+s[1]*r[l]+s[3])*h[d]+(s[2]*r[l]+s[4])*r[l]+s[5];Math.abs(u)<a&&(u=(o[0]*h[d]+o[1]*r[l]+o[3])*h[d]+(o[2]*r[l]+o[4])*r[l]+o[5],Math.abs(u)<c&&p.appendPoint(new Point2D(h[d],r[l])))}return p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectEllipseLine=function(t,y,e,x,n){var i,s=new Vector2D(x.x,x.y),o=Vector2D.fromPoints(x,n),r=new Vector2D(t.x,t.y),a=s.subtract(r),c=new Vector2D(o.x/(y*y),o.y/(e*e)),p=new Vector2D(a.x/(y*y),a.y/(e*e)),l=o.dot(c),h=o.dot(p),d=h*h-l*(t=a.dot(p)-1);if(d<0)i=new Intersection("Outside");else if(d>0){var u=Math.sqrt(d),m=(-h-u)/l,g=(-h+u)/l;(m<0||1<m)&&(g<0||1<g)?i=new Intersection(m<0&&g<0||m>1&&g>1?"Outside":"Inside"):(i=new Intersection("Intersection"),0<=m&&m<=1&&i.appendPoint(x.lerp(n,m)),0<=g&&g<=1&&i.appendPoint(x.lerp(n,g)))}else{var f=-h/l;0<=f&&f<=1?(i=new Intersection("Intersection")).appendPoint(x.lerp(n,f)):i=new Intersection("Outside")}return i},Intersection.intersectEllipsePolygon=function(t,y,e,x){for(var n=new Intersection("No Intersection"),i=x.length,s=0;s<i;s++){var o=x[s],r=x[(s+1)%i],a=Intersection.intersectEllipseLine(t,y,e,o,r);n.appendPoints(a.points)}return n.points.length>0&&(n.status="Intersection"),n},Intersection.intersectEllipseRectangle=function(t,y,e,x,n){var i=x.min(n),s=x.max(n),o=new Point2D(s.x,i.y),r=new Point2D(i.x,s.y),a=Intersection.intersectEllipseLine(t,y,e,i,o),c=Intersection.intersectEllipseLine(t,y,e,o,s),p=Intersection.intersectEllipseLine(t,y,e,s,r),l=Intersection.intersectEllipseLine(t,y,e,r,i),h=new Intersection("No Intersection");return h.appendPoints(a.points),h.appendPoints(c.points),h.appendPoints(p.points),h.appendPoints(l.points),h.points.length>0&&(h.status="Intersection"),h},Intersection.intersectLineLine=function(t,y,e,x){var n,i=(x.x-e.x)*(t.y-e.y)-(x.y-e.y)*(t.x-e.x),s=(y.x-t.x)*(t.y-e.y)-(y.y-t.y)*(t.x-e.x),o=(x.y-e.y)*(y.x-t.x)-(x.x-e.x)*(y.y-t.y);if(0!=o){var r=i/o,a=s/o;0<=r&&r<=1&&0<=a&&a<=1?(n=new Intersection("Intersection")).points.push(new Point2D(t.x+r*(y.x-t.x),t.y+r*(y.y-t.y))):n=new Intersection("No Intersection")}else n=new Intersection(0==i||0==s?"Coincident":"Parallel");return n},Intersection.intersectLinePolygon=function(t,y,e){for(var x=new Intersection("No Intersection"),n=e.length,i=0;i<n;i++){var s=e[i],o=e[(i+1)%n],r=Intersection.intersectLineLine(t,y,s,o);x.appendPoints(r.points)}return x.points.length>0&&(x.status="Intersection"),x},Intersection.intersectLineRectangle=function(t,y,e,x){var n=e.min(x),i=e.max(x),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectLineLine(n,s,t,y),a=Intersection.intersectLineLine(s,i,t,y),c=Intersection.intersectLineLine(i,o,t,y),p=Intersection.intersectLineLine(o,n,t,y),l=new Intersection("No Intersection");return l.appendPoints(r.points),l.appendPoints(a.points),l.appendPoints(c.points),l.appendPoints(p.points),l.points.length>0&&(l.status="Intersection"),l},Intersection.intersectPolygonPolygon=function(t,y){for(var e=new Intersection("No Intersection"),x=t.length,n=0;n<x;n++){var i=t[n],s=t[(n+1)%x],o=Intersection.intersectLinePolygon(i,s,y);e.appendPoints(o.points)}return e.points.length>0&&(e.status="Intersection"),e},Intersection.intersectPolygonRectangle=function(t,y,e){var x=y.min(e),n=y.max(e),i=new Point2D(n.x,x.y),s=new Point2D(x.x,n.y),o=Intersection.intersectLinePolygon(x,i,t),r=Intersection.intersectLinePolygon(i,n,t),a=Intersection.intersectLinePolygon(n,s,t),c=Intersection.intersectLinePolygon(s,x,t),p=new Intersection("No Intersection");return p.appendPoints(o.points),p.appendPoints(r.points),p.appendPoints(a.points),p.appendPoints(c.points),p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectRayRay=function(t,y,e,x){var n,i=(x.x-e.x)*(t.y-e.y)-(x.y-e.y)*(t.x-e.x),s=(y.x-t.x)*(t.y-e.y)-(y.y-t.y)*(t.x-e.x),o=(x.y-e.y)*(y.x-t.x)-(x.x-e.x)*(y.y-t.y);if(0!=o){var r=i/o;(n=new Intersection("Intersection")).points.push(new Point2D(t.x+r*(y.x-t.x),t.y+r*(y.y-t.y)))}else n=new Intersection(0==i||0==s?"Coincident":"Parallel");return n},Intersection.intersectRectangleRectangle=function(t,y,e,x){var n=t.min(y),i=t.max(y),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectLineRectangle(n,s,e,x),a=Intersection.intersectLineRectangle(s,i,e,x),c=Intersection.intersectLineRectangle(i,o,e,x),p=Intersection.intersectLineRectangle(o,n,e,x),l=new Intersection("No Intersection");return l.appendPoints(r.points),l.appendPoints(a.points),l.appendPoints(c.points),l.appendPoints(p.points),l.points.length>0&&(l.status="Intersection"),l},Intersection.bezout=function(t,y){var e=t[0]*y[1]-y[0]*t[1],x=t[0]*y[2]-y[0]*t[2],n=t[0]*y[3]-y[0]*t[3],i=t[0]*y[4]-y[0]*t[4],s=t[0]*y[5]-y[0]*t[5],o=t[1]*y[2]-y[1]*t[2],r=t[1]*y[4]-y[1]*t[4],a=t[1]*y[5]-y[1]*t[5],c=t[2]*y[3]-y[2]*t[3],p=t[3]*y[4]-y[3]*t[4],l=t[3]*y[5]-y[3]*t[5],h=a+p,d=r-c;return new Polynomial(e*o-x*x,e*d+n*o-2*x*i,e*h+n*d-i*i-2*x*s,e*l+n*h-2*i*s,n*l-s*s)},$(window).resize(function(){xLimit=resetWindowLimit("x"),yLimit=resetWindowLimit("y")}),lifeCnt>0&&(document.onkeydown=function(t){switch($("#spaceship").css("opacity","1"),t.keyCode){case 68:turn=1;break;case 65:turn=-1;break;case 87:thrust=1;break;case 83:thrust=-1;break;case 32:pewpew(),resetGun=!1;break;case 13:hyperspace();break;case 8:case 46:boom()}},document.onkeyup=function(t){switch(t.keyCode){case 65:case 68:turn=0;break;case 87:case 83:thrust=0;break;case 32:endpew(),resetGun=!0}},$(document).on("touchstart"," .gameBtn",function(t){$("#spaceship").css("opacity","1");var y=t.target.id;switch(console.log(y),y){case"btnLeft":turn=-1;break;case"btnRight":turn=1;break;case"btnUp":thrust=1;break;case"btnDown":thrust=-1;break;case"btnShoot":case"glyphShoot":pewpew();break;case"btnHS":hyperspace()}}),$(document).on("touchend",".gameBtn",function(t){switch(t.target.id){case"btnLeft":case"btnRight":turn=0;break;case"btnUp":case"btnDown":thrust=0;break;case"glyphLeft":turn=0;break;case"btnShoot":endpew(),resetGun=!0}}));