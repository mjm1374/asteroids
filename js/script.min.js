var asteroids=[],shots=[],shotCnt=0,spaceship=new Spaceship(xLimit/2,yLimit/2,0,0,0,0,0,0),colors=["#edc951","#eb6841","#cc2a36","#4f372d","#00a0b0"],rocksLrg=["26.087899,1.0434852 49.503787,26.009091 74.220561,2.6541843 96.335572,25.203747 85.278067,50.974686 98.286898,75.940275 62.512619,99.295186 26.087905,100.10053 0.7206885,77.55096 1.3711312,27.619771","27.46638,2.6445482 66.467442,0.98983643 99.048213,24.999426 V 35.822504 L 65.202598,51.325844 98.421452,73.55696 76.484471,97.835645 H 72.723845 L 60.501821,85.842551 27.596351,98.713169 0.95859607,63.02645 1.8987487,25.29194 H 36.997914","14.670645,48.844427 1.9670478,25.614646 27.37424,2.3848478 48.335078,12.875719 73.107033,1.6354928 97.878992,24.865291 75.012591,39.102909 97.878992,60.834007 75.012591,97.552066 39.442599,87.061197 26.739004,99.050766 1.3318868,75.820971"],xLimit=resetWindowLimit("x")-1,yLimit=resetWindowLimit("y")-1,lifeCnt=3,jumpCnt=3,score=0,newLifeTarget=1e4,newLife=newLifeTarget,resetGun=!0,inPlay=!1,mode="asteroids",rockCnt=10,scale=1,rockID=0;function animateScreen(t,e){for(var y in $("#scoreCnt span").html(score),$("#lifeCnt span").html(lifeCnt),asteroids){if(asteroids.hasOwnProperty(y))asteroids[y].changePosition(asteroids[y].x+asteroids[y].xv,asteroids[y].y+asteroids[y].yv),"asteroids"==mode&&((asteroids[y].x<=0-asteroids[y].width||asteroids[y].x>=xLimit+asteroids[y].width)&&(asteroids[y].x>=xLimit+asteroids[y].width?asteroids[y].x=-Math.abs(0-asteroids[y].width):asteroids[y].x=xLimit+asteroids[y].width),(asteroids[y].y<=0-asteroids[y].width||asteroids[y].y>=yLimit+asteroids[y].height)&&(asteroids[y].y>=yLimit+asteroids[y].height?asteroids[y].y=-Math.abs(0-asteroids[y].height):asteroids[y].y=yLimit+asteroids[y].height)),1==inPlay&&inCollision(asteroids[y])&&boom();$("#rockAnim"+asteroids[y].id).css("left",asteroids[y].x).css("top",asteroids[y].y)}for(var x in e){var n=10*Math.cos(e[x].theta*Math.PI/180)+e[x].x,i=10*Math.sin(e[x].theta*Math.PI/180)+e[x].y,s=e[x].life-5;e[x].changeLife(s),e[x].life<0?clearBullet(x):(e[x].changePosition(n,i),$("#shot"+e[x].id).css("left",e[x].x).css("top",e[x].y),isHit(e[x])&&clearBullet(x))}moveSpaceship(delta_time),updateSpaceship(delta_time)}function inCollision(t){var e=spaceship,y=t;return!(e.y+e.height<y.y||e.y>y.y+y.height||e.x+e.width<y.x||e.x>y.x+y.width)}function isHit(t){var e=asteroids,y=t;for(i=0;i<e.length;i++)if(0==(e[i].y+e[i].height<y.y||e[i].y>y.y+y.height||e[i].x+e[i].width<y.x||e[i].x>y.x+y.width))return blowupAsteroid(e[i],i),!0}function blowupAsteroid(t,e){$("#sndAstroBoom").get(0).pause(),$("#sndAstroBoom").get(0).currentTime=0,$("#sndAstroBoom").get(0).play();var y=t;pointCnt(t.points),y.height>25&&makeAsteroidPieces(y.x,y.y,y.height/2,2),$("#rockAnim"+y.id).remove(),asteroids.splice(e,1),0==asteroids.length&&regenerateAsteroids()}function makeAsteroidPieces(t,e,y,x){for(i=0;i<x;i++){switch(rockID++,thisRockSize=y,y){case 100:scale="1";break;case 50:scale=".5";break;case 25:scale=".25"}asteroids.push(new Asteroid(rockID,"test",thisRockSize,thisRockSize,t,e,getRandomFloat(-3,3),getRandomFloat(-3,3),colors[Math.floor(getRandomFloat(0,5))],"generic",!1,20,!0)),$("body").append("<svg id='rockAnim"+asteroids[asteroids.length-1].id+"' data-id='"+asteroids[asteroids.length-1].id+"' class='asteroid rocksize"+y+"'><path cx='"+asteroids[asteroids.length-1].width+"' cy='"+asteroids[asteroids.length-1].height+"' r='"+(asteroids[asteroids.length-1].width/2-5)+"' stroke='"+asteroids[asteroids.length-1].color+"' stroke-width='2' d='M "+rocksLrg[Math.floor(getRandomFloat(0,3))]+" Z'  id='astroPath"+asteroids[asteroids.length-1].id+"' transform='scale("+scale+", "+scale+")' /><text x='20' y='55' fill='"+asteroids[asteroids.length-1].color+"' transform='scale("+scale+", "+scale+")>"+asteroids[asteroids.length-1].id+"</text></svg>"),$("#rockAnim"+asteroids[asteroids.length-1].id).css("color",asteroids[asteroids.length-1].color).css("border-color",asteroids[asteroids.length-1].color).css("width",asteroids[asteroids.length-1].width).css("height",asteroids[asteroids.length-1].height).addClass("rockAnim")}}function pointCnt(t){score+=t,(newLife-=t)<0&&(lifeCnt++,newLife=newLifeTarget+newLife)}function checkPathTouch(t){var e=spaceship,y=t,x=[],n=[];for(i=0;i<e.getTotalLength();i+=1)x.push(e.getPointAtLength(i));for(i=0;i<y.getTotalLength();i+=1)n.push(y.getPointAtLength(i));for(i=0;i<x.length;i++){var s=Math.floor(x[i].x),o=Math.floor(x[i].y);for(j=0;j<n.length;j++)if(s==Math.floor(n[j].x)&&o==Math.floor(n[j].y)){console.log(Math.floor(n[j].x)+"- "+Math.floor(n[j].y)),boom();break}}}function boom(){$("#spaceship").hide(),inPlay=!1,$("#sndBoom").get(0).play(),lifeCnt>0&&(lifeCnt--,$("#lifeCnt span").html(lifeCnt),jumpCnt=3,$("#HSCnt span").html(jumpCnt),setTimeout(function(){resetSpaceship()},3e3))}function resetSpaceship(){lifeCnt>0?($("#spaceship").show(),spaceship=new Spaceship(xLimit/2,yLimit/2,0,0,-90,0,0,0),inPlay=!0):(inPlay=!1,$("#spaceship").hide(),$("#gameOverBoard").css("display","block"),checkHighScoreCookie())}function makeShot(){shotCnt++,shots.push(new Shot(shotCnt,spaceship.x,spaceship.y,spaceship.vx,spaceship.vy,spaceship.theta,spaceship.yaw,1800,0,0)),$("body").append("<svg id='shot"+shotCnt+"' data-id='"+shotCnt+"' class='shot' height='6' width='6'><circle cx='3' cy='3' r='3' stroke='white' stroke-width='2' fill='red' /></svg>")}function pewpew(){lifeCnt>0&&1==resetGun&&($("#sndLaser").get(0).play(),makeShot(),resetGun=!1)}function endpew(){$("#sndLaser").get(0).pause(),$("#sndLaser").get(0).currentTime=0}function resetgame(){$("#gameOverBoard").hide(),$(".asteroid").remove(),lifeCnt=3,jumpCnt=3,score=0,asteroids=[],regenerateAsteroids(),$("body").append("<svg id='spaceship' class=''><path cx='5' cy='5' r='10' stroke='#ffffff' stroke-width='2' d='M "+spaceship.shape+" Z'  id='outerShip' /></svg>"),$("#lifeCnt span").html(lifeCnt),$("#HSCnt span").html(jumpCnt),resetSpaceship()}function regenerateAsteroids(){for(i=0;i<rockCnt;i++)rockID++,thisRockSize=Math.floor(getRandomFloat(50,100)),thisRockSize=100,asteroids.push(new Asteroid(rockID,"test",thisRockSize,thisRockSize,getRandomFloat(0,xLimit-150),getRandomFloat(0,yLimit-150),getRandomFloat(-3,3),getRandomFloat(-3,3),colors[Math.floor(getRandomFloat(0,5))],"generic",!1,20,!0));for(var t in asteroids)asteroids.hasOwnProperty(t)&&($("body").append("<svg id='rockAnim"+asteroids[t].id+"' data-id='"+asteroids[t].id+"' class='asteroid rocksize100'><path cx='"+asteroids[t].width+"' cy='"+asteroids[t].height+"' r='"+(asteroids[t].width/2-5)+"' stroke='"+asteroids[t].color+"' stroke-width='2' d='M "+rocksLrg[Math.floor(getRandomFloat(0,3))]+" Z'  id='astroPath"+asteroids[t].id+"' /><text x='20' y='55' fill='"+asteroids[t].color+"'>"+asteroids[t].id+"</text></svg>"),$("#rockAnim"+asteroids[t].id).css("color",asteroids[t].color).css("border-color",asteroids[t].color).css("width",asteroids[t].width).css("height",asteroids[t].height).addClass("rockAnim"))}function Intersection(t){arguments.length>0&&this.init(t)}function Asteroid(t,e,y,x,n,i,s,o,r,a,c,l,p){this.id=t,this.title=e,this.width=y,this.height=x,this.x=n,this.y=i,this.xv=s,this.yv=o,this.color=r,this.type=a,this.oob=c,this.points=l,this.gravity=.1,this.gravitySpeed=0,this.bounce=.4,this.exists=!0,this.resetGravity=function(){},this.newPos=function(){this.gravitySpeed+=this.gravity,this.x+=this.xvel;var t=this.yv;this.yv<0&&(t=0),t=0,this.y+=t+this.gravitySpeed,this.hitBottom()},this.hitBottom=function(){var t=window.innerHeight-this.height;this.y>t&&(this.x=t,this.gravitySpeed=-this.gravitySpeed*this.bounce),this.x>window.innerWidth+this.width&&(this.x=0-this.width),this.x<0-this.width&&(this.x=window.innerWidth+this.width)},this.changeColor=function(t){this.color=t},this.oob=function(t){this.oob=t},this.changeVelocity=function(t,e){"x"==t&&(this.xv=e),"y"==t&&(this.yv=e)},this.changePosition=function(t,e){this.x=t,this.y=e},this.getVelocity=function(t){return this.direction},this.changeExistance=function(t){this.exists=t}}function Spaceship(t,e,y,x,n,i,s,o){this.x=t,this.y=e,this.vx=y,this.vy=x,this.theta=n,this.width=20,this.height=15,this.yaw=i,this.x_points=s,this.y_points=o,this.shape="14.383032,5.9181762 0.35137621,0.04626516 2.7568063,5.9181762 0.35137621,11.338401"}function Shot(t,e,y,x,n,i,s,o,r,a){this.id=t,this.x=e,this.y=y,this.vx=x,this.vy=n,this.theta=i,this.width=6,this.height=6,this.yaw=s,this.life=o,this.x_points=r,this.y_points=a,this.changePosition=function(t,e){this.x=t,this.y=e},this.changeLife=function(t){this.life=t}}function resetWindowLimit(t){var e,y,x;if(y=window.innerHeight,x=window.innerHeight,"x"==t)for(e=window.innerWidth,i=0;i<asteroids.length;i++)asteroids[i].x>=y-asteroids[i].width&&asteroids[i].changePosition(y-asteroids[i].width,x-asteroids[i].height);else for(e=window.innerHeight,i=0;i<asteroids.length;i++)asteroids[i].y>=x-asteroids[i].height&&asteroids[i].changePosition(y-asteroids[i].width,e-asteroids[i].height);return e}function getRandomFloat(t,e){return Math.random()*(e-t)+t}function clearBullet(t){$("#shot"+shots[t].id).remove(),shots.splice(t,1)}function moveSpaceship(t){var e=Math.PI/180;0!=turn&&void 0!=turn?(spaceship.theta=spaceship.theta+turn*turn_per_milli*t,lifeCnt>0&&$("#sndTurn").get(0).play()):($("#sndTurn").get(0).pause(),$("#sndTurn").get(0).currentTime=0),0!=thrust&&void 0!=thrust?(del_v=thrust*thrust_per_milli*t,del_vx=del_v*Math.cos(spaceship.theta*e),del_vy=del_v*Math.sin(spaceship.theta*e),lifeCnt>0&&$("#sndPlayer").get(0).play()):(del_vx=0,del_vy=0,$("#sndPlayer").get(0).pause(),$("#sndPlayer").get(0).currentTime=0),spaceship.vx=spaceship.vx+del_vx,spaceship.vy=spaceship.vy+del_vy}function updateSpaceship(t){spaceship.x>=xLimit&&(spaceship.x=0),spaceship.x<0&&(spaceship.x=xLimit),spaceship.y>=yLimit&&(spaceship.y=0),spaceship.y<0&&(spaceship.y=yLimit),spaceship.theta+=spaceship.yaw*t,spaceship.x+=spaceship.vx*t,spaceship.y+=spaceship.vy*t,$("#spaceship").css("left",spaceship.x).css("top",spaceship.y).css({transform:"rotate("+spaceship.theta+"deg)"})}function hyperspace(){lifeCnt>0&&(jumpCnt>0?($("#sndHyperspace").get(0).currentTime=0,$("#sndHyperspace").get(0).play(),spaceship.x=getRandomFloat(1,xLimit-5),spaceship.y=getRandomFloat(1,yLimit-5),jumpCnt--,$("#HSCnt span").html(jumpCnt)):$("#sndHyperspaceFail").get(0).play())}function isPointInPoly(t,e){for(var y=!1,x=-1,n=t.length,i=n-1;++x<n;i=x)(t[x].y<=e.y&&e.y<t[i].y||t[i].y<=e.y&&e.y<t[x].y)&&e.x<(t[i].x-t[x].x)*(e.y-t[x].y)/(t[i].y-t[x].y)+t[x].x&&(y=!y);return y}function setCookie(t,e,y){var x=new Date;x.setTime(x.getTime()+24*y*60*60*1e3);var n="expires="+x.toUTCString();document.cookie=t+"="+e+";"+n+";path=/"}function getCookie(t){for(var e=t+"=",y=document.cookie.split(";"),x=0;x<y.length;x++){for(var n=y[x];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""}function checkHighScoreCookie(){var t=getCookie("highScore");""!=t?setCookie("highScore",score,1e3):t<=score&&setCookie("highScore",score,1e3)}delta_time=20,turn=0,thrust=0,turn_per_milli=.1,thrust_per_milli=15e-5,key_delay=50,del_v=0,del_vx=0,del_vy=0,$(document).ready(function(){resetgame(),xLimit>768&&(inPlay=!1,$("#welcomeModel").modal("show"),$("#welcomeModel").on("hidden.bs.modal",function(t){inPlay=!0}));setInterval(function(){animateScreen(asteroids,shots)},delta_time)}),Intersection.prototype.init=function(t){this.status=t,this.points=new Array},Intersection.prototype.appendPoint=function(t){this.points.push(t)},Intersection.prototype.appendPoints=function(t){this.points=this.points.concat(t)},Intersection.intersectShapes=function(t,e){var y,x=t.getIntersectionParams(),n=e.getIntersectionParams();if(null!=x&&null!=n)if("Path"==x.name)y=Intersection.intersectPathShape(t,e);else if("Path"==n.name)y=Intersection.intersectPathShape(e,t);else{var i,s;if(x.name<n.name?(i="intersect"+x.name+n.name,s=x.params.concat(n.params)):(i="intersect"+n.name+x.name,s=n.params.concat(x.params)),!(i in Intersection))throw new Error("Intersection not available: "+i);y=Intersection[i].apply(null,s)}else y=new Intersection("No Intersection");return y},Intersection.intersectPathShape=function(t,e){return t.intersectShape(e)},Intersection.intersectBezier2Bezier2=function(t,e,y,x,n,i){var s,o,r,a,c,l,p,d,h,u=new Intersection("No Intersection");if(s=e.multiply(-2),r=t.add(s.add(y)),s=t.multiply(-2),o=e.multiply(2),a=s.add(o),c=new Point2D(t.x,t.y),s=n.multiply(-2),l=x.add(s.add(i)),s=x.multiply(-2),o=n.multiply(2),p=s.add(o),d=new Point2D(x.x,x.y),0==r.y){var g=(f=r.x*(c.y-d.y))+(w=f-a.x*a.y),m=a.y*a.y;h=new Polynomial(r.x*l.y*l.y,2*r.x*p.y*l.y,r.x*p.y*p.y-l.x*m-l.y*f-l.y*w,-p.x*m-p.y*f-p.y*w,(c.x-d.x)*m+(c.y-d.y)*w)}else{var f=r.x*l.y-r.y*l.x,w=r.x*p.y-p.x*r.y,I=(g=a.x*r.y-a.y*r.x,m=c.y-d.y,r.y*(c.x-d.x)-r.x*m),v=-a.y*g+r.y*I,P=g*g;h=new Polynomial(f*f,2*f*w,(-l.y*P+r.y*w*w+r.y*f*I+f*v)/r.y,(-p.y*P+r.y*w*I+w*v)/r.y,(m*P+I*v)/r.y)}for(var L=h.getRoots(),k=0;k<L.length;k++){var b=L[k];if(0<=b&&b<=1){var C=new Polynomial(r.x,a.x,c.x-d.x-b*p.x-b*b*l.x).getRoots(),D=new Polynomial(r.y,a.y,c.y-d.y-b*p.y-b*b*l.y).getRoots();if(C.length>0&&D.length>0){t:for(var R=0;R<C.length;R++){var $=C[R];if(0<=$&&$<=1)for(var S=0;S<D.length;S++)if(Math.abs($-D[S])<1e-4){u.points.push(l.multiply(b*b).add(p.multiply(b).add(d)));break t}}}}}return u.points.length>0&&(u.status="Intersection"),u},Intersection.intersectBezier2Bezier3=function(t,e,y,x,n,i,s){var o,r,a,c,l,p,d,h,u,g,m,f=new Intersection("No Intersection");o=e.multiply(-2),l=t.add(o.add(y)),o=t.multiply(-2),r=e.multiply(2),p=o.add(r),d=new Point2D(t.x,t.y),o=x.multiply(-1),r=n.multiply(3),a=i.multiply(-3),c=o.add(r.add(a.add(s))),h=new Vector2D(c.x,c.y),o=x.multiply(3),r=n.multiply(-6),a=i.multiply(3),c=o.add(r.add(a)),u=new Vector2D(c.x,c.y),o=x.multiply(-3),r=n.multiply(3),a=o.add(r),g=new Vector2D(a.x,a.y),m=new Vector2D(x.x,x.y);for(var w=d.x*d.x,I=d.y*d.y,v=p.x*p.x,P=p.y*p.y,L=l.x*l.x,k=l.y*l.y,b=m.x*m.x,C=m.y*m.y,D=g.x*g.x,R=g.y*g.y,$=u.x*u.x,S=u.y*u.y,B=h.x*h.x,z=h.y*h.y,M=new Polynomial(-2*l.x*l.y*h.x*h.y+L*z+k*B,-2*l.x*l.y*u.x*h.y-2*l.x*l.y*u.y*h.x+2*k*u.x*h.x+2*L*u.y*h.y,-2*l.x*g.x*l.y*h.y-2*l.x*l.y*g.y*h.x-2*l.x*l.y*u.x*u.y+2*g.x*k*h.x+k*$+L*(2*g.y*h.y+S),2*d.x*l.x*l.y*h.y+2*d.y*l.x*l.y*h.x+p.x*p.y*l.x*h.y+p.x*p.y*l.y*h.x-2*m.x*l.x*l.y*h.y-2*l.x*m.y*l.y*h.x-2*l.x*g.x*l.y*u.y-2*l.x*l.y*g.y*u.x-2*d.x*k*h.x-2*d.y*L*h.y+2*m.x*k*h.x+2*g.x*k*u.x-P*l.x*h.x-v*l.y*h.y+L*(2*m.y*h.y+2*g.y*u.y),2*d.x*l.x*l.y*u.y+2*d.y*l.x*l.y*u.x+p.x*p.y*l.x*u.y+p.x*p.y*l.y*u.x-2*m.x*l.x*l.y*u.y-2*l.x*m.y*l.y*u.x-2*l.x*g.x*l.y*g.y-2*d.x*k*u.x-2*d.y*L*u.y+2*m.x*k*u.x-P*l.x*u.x-v*l.y*u.y+D*k+L*(2*m.y*u.y+R),2*d.x*l.x*l.y*g.y+2*d.y*l.x*g.x*l.y+p.x*p.y*l.x*g.y+p.x*p.y*g.x*l.y-2*m.x*l.x*l.y*g.y-2*l.x*m.y*g.x*l.y-2*d.x*g.x*k-2*d.y*L*g.y+2*m.x*g.x*k-P*l.x*g.x-v*l.y*g.y+2*L*m.y*g.y,-2*d.x*d.y*l.x*l.y-d.x*p.x*p.y*l.y-d.y*p.x*p.y*l.x+2*d.x*l.x*m.y*l.y+2*d.y*m.x*l.x*l.y+p.x*m.x*p.y*l.y+p.x*p.y*l.x*m.y-2*m.x*l.x*m.y*l.y-2*d.x*m.x*k+d.x*P*l.x+d.y*v*l.y-2*d.y*L*m.y-m.x*P*l.x-v*m.y*l.y+w*k+I*L+b*k+L*C).getRootsInInterval(0,1),V=0;V<M.length;V++){var _=M[V],A=new Polynomial(l.x,p.x,d.x-m.x-_*g.x-_*_*u.x-_*_*_*h.x).getRoots(),N=new Polynomial(l.y,p.y,d.y-m.y-_*g.y-_*_*u.y-_*_*_*h.y).getRoots();if(A.length>0&&N.length>0){t:for(var E=0;E<A.length;E++){var T=A[E];if(0<=T&&T<=1)for(var H=0;H<N.length;H++)if(Math.abs(T-N[H])<1e-4){f.points.push(h.multiply(_*_*_).add(u.multiply(_*_).add(g.multiply(_).add(m))));break t}}}}return f.points.length>0&&(f.status="Intersection"),f},Intersection.intersectBezier2Circle=function(t,e,y,x,n){return Intersection.intersectBezier2Ellipse(t,e,y,x,n,n)},Intersection.intersectBezier2Ellipse=function(t,e,y,x,n,i){var s,o,r,a,c,l=new Intersection("No Intersection");s=e.multiply(-2),r=t.add(s.add(y)),s=t.multiply(-2),o=e.multiply(2),a=s.add(o),c=new Point2D(t.x,t.y);for(var p=n*n,d=i*i,h=new Polynomial(d*r.x*r.x+p*r.y*r.y,2*(d*r.x*a.x+p*r.y*a.y),d*(2*r.x*c.x+a.x*a.x)+p*(2*r.y*c.y+a.y*a.y)-2*(d*x.x*r.x+p*x.y*r.y),2*(d*a.x*(c.x-x.x)+p*a.y*(c.y-x.y)),d*(c.x*c.x+x.x*x.x)+p*(c.y*c.y+x.y*x.y)-2*(d*x.x*c.x+p*x.y*c.y)-p*d).getRoots(),u=0;u<h.length;u++){var g=h[u];0<=g&&g<=1&&l.points.push(r.multiply(g*g).add(a.multiply(g).add(c)))}return l.points.length>0&&(l.status="Intersection"),l},Intersection.intersectBezier2Line=function(t,e,y,x,n){var i,s,o,r,a,c,l,p=x.min(n),d=x.max(n),h=new Intersection("No Intersection");i=e.multiply(-2),o=t.add(i.add(y)),i=t.multiply(-2),s=e.multiply(2),r=i.add(s),a=new Point2D(t.x,t.y),l=new Vector2D(x.y-n.y,n.x-x.x),c=x.x*n.y-n.x*x.y,roots=new Polynomial(l.dot(o),l.dot(r),l.dot(a)+c).getRoots();for(var u=0;u<roots.length;u++){var g=roots[u];if(0<=g&&g<=1){var m=t.lerp(e,g),f=e.lerp(y,g),w=m.lerp(f,g);x.x==n.x?p.y<=w.y&&w.y<=d.y&&(h.status="Intersection",h.appendPoint(w)):x.y==n.y?p.x<=w.x&&w.x<=d.x&&(h.status="Intersection",h.appendPoint(w)):w.gte(p)&&w.lte(d)&&(h.status="Intersection",h.appendPoint(w))}}return h},Intersection.intersectBezier2Polygon=function(t,e,y,x){for(var n=new Intersection("No Intersection"),i=x.length,s=0;s<i;s++){var o=x[s],r=x[(s+1)%i],a=Intersection.intersectBezier2Line(t,e,y,o,r);n.appendPoints(a.points)}return n.points.length>0&&(n.status="Intersection"),n},Intersection.intersectBezier2Rectangle=function(t,e,y,x,n){var i=x.min(n),s=x.max(n),o=new Point2D(s.x,i.y),r=new Point2D(i.x,s.y),a=Intersection.intersectBezier2Line(t,e,y,i,o),c=Intersection.intersectBezier2Line(t,e,y,o,s),l=Intersection.intersectBezier2Line(t,e,y,s,r),p=Intersection.intersectBezier2Line(t,e,y,r,i),d=new Intersection("No Intersection");return d.appendPoints(a.points),d.appendPoints(c.points),d.appendPoints(l.points),d.appendPoints(p.points),d.points.length>0&&(d.status="Intersection"),d},Intersection.intersectBezier3Bezier3=function(t,e,y,x,n,i,s,o){var r,a,c,l,p,d,h,u,g,m,f,w,I=new Intersection("No Intersection");r=t.multiply(-1),a=e.multiply(3),c=y.multiply(-3),l=r.add(a.add(c.add(x))),p=new Vector2D(l.x,l.y),r=t.multiply(3),a=e.multiply(-6),c=y.multiply(3),l=r.add(a.add(c)),d=new Vector2D(l.x,l.y),r=t.multiply(-3),a=e.multiply(3),c=r.add(a),h=new Vector2D(c.x,c.y),u=new Vector2D(t.x,t.y),r=n.multiply(-1),a=i.multiply(3),c=s.multiply(-3),l=r.add(a.add(c.add(o))),g=new Vector2D(l.x,l.y),r=n.multiply(3),a=i.multiply(-6),c=s.multiply(3),l=r.add(a.add(c)),m=new Vector2D(l.x,l.y),r=n.multiply(-3),a=i.multiply(3),c=r.add(a),f=new Vector2D(c.x,c.y),w=new Vector2D(n.x,n.y);for(var v=u.x*u.x,P=u.x*u.x*u.x,L=u.y*u.y,k=u.y*u.y*u.y,b=h.x*h.x,C=h.x*h.x*h.x,D=h.y*h.y,R=h.y*h.y*h.y,$=d.x*d.x,S=d.x*d.x*d.x,B=d.y*d.y,z=d.y*d.y*d.y,M=p.x*p.x,V=p.x*p.x*p.x,_=p.y*p.y,A=p.y*p.y*p.y,N=w.x*w.x,E=w.x*w.x*w.x,T=w.y*w.y,H=w.y*w.y*w.y,F=f.x*f.x,j=f.x*f.x*f.x,O=f.y*f.y,W=m.x*m.x,G=m.x*m.x*m.x,q=m.y*m.y,U=g.x*g.x,Z=g.x*g.x*g.x,J=g.y*g.y,K=g.y*g.y*g.y,Q=new Polynomial(-V*K+A*Z-3*p.x*_*U*g.y+3*M*p.y*g.x*J,-6*p.x*m.x*_*g.x*g.y+6*M*p.y*m.y*g.x*g.y+3*m.x*A*U-3*V*m.y*J-3*p.x*_*m.y*U+3*M*m.x*p.y*J,-6*f.x*p.x*_*g.x*g.y-6*p.x*m.x*_*m.y*g.x+6*M*m.x*p.y*m.y*g.y+3*f.x*A*U+3*W*A*g.x+3*f.x*M*p.y*J-3*p.x*f.y*_*U-3*p.x*W*_*g.y+M*p.y*g.x*(6*f.y*g.y+3*q)+V*(-f.y*J-2*q*g.y-g.y*(2*f.y*g.y+q)),h.x*d.y*p.x*p.y*g.x*g.y-h.y*d.x*p.x*p.y*g.x*g.y+6*f.x*m.x*A*g.x+3*h.x*d.x*p.x*p.y*J+6*u.x*p.x*_*g.x*g.y-3*h.x*d.x*_*g.x*g.y-3*h.y*d.y*p.x*p.y*U-6*u.y*M*p.y*g.x*g.y-6*w.x*p.x*_*g.x*g.y+3*h.y*d.y*M*g.x*g.y-2*d.x*B*p.x*g.x*g.y-6*f.x*p.x*m.x*_*g.y-6*f.x*p.x*_*m.y*g.x-6*p.x*f.y*m.x*_*g.x+6*f.x*M*p.y*m.y*g.y+2*$*d.y*p.y*g.x*g.y+G*A-3*u.x*A*U+3*u.y*V*J+3*w.x*A*U+z*p.x*U-S*p.y*J-3*u.x*M*p.y*J+3*u.y*p.x*_*U-2*h.x*d.y*M*J+h.x*d.y*_*U-h.y*d.x*M*J+2*h.y*d.x*_*U+3*w.x*M*p.y*J-d.x*B*p.y*U-3*w.y*p.x*_*U+$*d.y*p.x*J-3*p.x*W*_*m.y+M*p.y*g.x*(6*w.y*g.y+6*f.y*m.y)+M*m.x*p.y*(6*f.y*g.y+3*q)+V*(-2*f.y*m.y*g.y-w.y*J-m.y*(2*f.y*g.y+q)-g.y*(2*w.y*g.y+2*f.y*m.y)),6*h.x*d.x*p.x*p.y*m.y*g.y+h.x*d.y*p.x*m.x*p.y*g.y+h.x*d.y*p.x*p.y*m.y*g.x-h.y*d.x*p.x*m.x*p.y*g.y-h.y*d.x*p.x*p.y*m.y*g.x-6*h.y*d.y*p.x*m.x*p.y*g.x-6*u.x*m.x*A*g.x+6*w.x*m.x*A*g.x+6*u.y*V*m.y*g.y+2*z*p.x*m.x*g.x-2*S*p.y*m.y*g.y+6*u.x*p.x*m.x*_*g.y+6*u.x*p.x*_*m.y*g.x+6*u.y*p.x*m.x*_*g.x-3*h.x*d.x*m.x*_*g.y-3*h.x*d.x*_*m.y*g.x+2*h.x*d.y*m.x*_*g.x+4*h.y*d.x*m.x*_*g.x-6*u.x*M*p.y*m.y*g.y-6*u.y*M*m.x*p.y*g.y-6*u.y*M*p.y*m.y*g.x-4*h.x*d.y*M*m.y*g.y-6*w.x*p.x*m.x*_*g.y-6*w.x*p.x*_*m.y*g.x-2*h.y*d.x*M*m.y*g.y+3*h.y*d.y*M*m.x*g.y+3*h.y*d.y*M*m.y*g.x-2*d.x*B*p.x*m.x*g.y-2*d.x*B*p.x*m.y*g.x-2*d.x*B*m.x*p.y*g.x-6*w.y*p.x*m.x*_*g.x-6*f.x*p.x*f.y*_*g.x-6*f.x*p.x*m.x*_*m.y+6*w.x*M*p.y*m.y*g.y+2*$*d.y*p.x*m.y*g.y+2*$*d.y*m.x*p.y*g.y+2*$*d.y*p.y*m.y*g.x+3*f.x*W*A+3*F*A*g.x-3*p.x*f.y*W*_-3*F*p.x*_*g.y+M*m.x*p.y*(6*w.y*g.y+6*f.y*m.y)+M*p.y*g.x*(6*w.y*m.y+3*O)+f.x*M*p.y*(6*f.y*g.y+3*q)+V*(-2*w.y*m.y*g.y-g.y*(2*w.y*m.y+O)-f.y*(2*f.y*g.y+q)-m.y*(2*w.y*g.y+2*f.y*m.y)),h.x*f.x*d.y*p.x*p.y*g.y+h.x*d.y*p.x*f.y*p.y*g.x+h.x*d.y*p.x*m.x*p.y*m.y-h.y*d.x*f.x*p.x*p.y*g.y-h.y*d.x*p.x*f.y*p.y*g.x-h.y*d.x*p.x*m.x*p.y*m.y-6*h.y*f.x*d.y*p.x*p.y*g.x-6*u.x*f.x*A*g.x+6*w.x*f.x*A*g.x+2*f.x*z*p.x*g.x+6*u.x*f.x*p.x*_*g.y+6*u.x*p.x*f.y*_*g.x+6*u.x*p.x*m.x*_*m.y+6*u.y*f.x*p.x*_*g.x-3*h.x*d.x*f.x*_*g.y-3*h.x*d.x*f.y*_*g.x-3*h.x*d.x*m.x*_*m.y+2*h.x*f.x*d.y*_*g.x+4*h.y*d.x*f.x*_*g.x-6*u.y*f.x*M*p.y*g.y-6*u.y*M*f.y*p.y*g.x-6*u.y*M*m.x*p.y*m.y-6*w.x*f.x*p.x*_*g.y-6*w.x*p.x*f.y*_*g.x-6*w.x*p.x*m.x*_*m.y+3*h.y*f.x*d.y*M*g.y-3*h.y*d.y*p.x*W*p.y+3*h.y*d.y*M*f.y*g.x+3*h.y*d.y*M*m.x*m.y-2*d.x*f.x*B*p.x*g.y-2*d.x*f.x*B*p.y*g.x-2*d.x*B*p.x*f.y*g.x-2*d.x*B*p.x*m.x*m.y-6*w.y*f.x*p.x*_*g.x-6*f.x*p.x*f.y*m.x*_+6*w.y*M*f.y*p.y*g.x+2*$*f.x*d.y*p.y*g.y+2*$*d.y*f.y*p.y*g.x+2*$*d.y*m.x*p.y*m.y-3*u.x*W*A+3*w.x*W*A+3*F*m.x*A+z*p.x*W+3*u.y*p.x*W*_+h.x*d.y*W*_+2*h.y*d.x*W*_-d.x*B*W*p.y-3*w.y*p.x*W*_-3*F*p.x*_*m.y+$*d.y*p.x*(2*f.y*g.y+q)+h.x*d.x*p.x*p.y*(6*f.y*g.y+3*q)+f.x*M*p.y*(6*w.y*g.y+6*f.y*m.y)+S*p.y*(-2*f.y*g.y-q)+u.y*V*(6*f.y*g.y+3*q)+h.y*d.x*M*(-2*f.y*g.y-q)+h.x*d.y*M*(-4*f.y*g.y-2*q)+u.x*M*p.y*(-6*f.y*g.y-3*q)+M*m.x*p.y*(6*w.y*m.y+3*O)+w.x*M*p.y*(6*f.y*g.y+3*q)+V*(-2*w.y*f.y*g.y-m.y*(2*w.y*m.y+O)-w.y*(2*f.y*g.y+q)-f.y*(2*w.y*g.y+2*f.y*m.y)),-u.x*h.x*d.y*p.x*p.y*g.y+u.x*h.y*d.x*p.x*p.y*g.y+6*u.x*h.y*d.y*p.x*p.y*g.x-6*u.y*h.x*d.x*p.x*p.y*g.y-u.y*h.x*d.y*p.x*p.y*g.x+u.y*h.y*d.x*p.x*p.y*g.x+h.x*h.y*d.x*d.y*p.x*g.y-h.x*h.y*d.x*d.y*p.y*g.x+h.x*w.x*d.y*p.x*p.y*g.y+h.x*w.y*d.y*p.x*p.y*g.x+h.x*f.x*d.y*p.x*p.y*m.y+h.x*d.y*p.x*f.y*m.x*p.y-w.x*h.y*d.x*p.x*p.y*g.y-6*w.x*h.y*d.y*p.x*p.y*g.x-h.y*d.x*w.y*p.x*p.y*g.x-h.y*d.x*f.x*p.x*p.y*m.y-h.y*d.x*p.x*f.y*m.x*p.y-6*h.y*f.x*d.y*p.x*m.x*p.y-6*u.x*w.x*A*g.x-6*u.x*f.x*m.x*A-2*u.x*z*p.x*g.x+6*w.x*f.x*m.x*A+2*w.x*z*p.x*g.x+2*f.x*z*p.x*m.x+2*u.y*S*p.y*g.y-6*u.x*u.y*p.x*_*g.x+3*u.x*h.x*d.x*_*g.y-2*u.x*h.x*d.y*_*g.x-4*u.x*h.y*d.x*_*g.x+3*u.y*h.x*d.x*_*g.x+6*u.x*u.y*M*p.y*g.y+6*u.x*w.x*p.x*_*g.y-3*u.x*h.y*d.y*M*g.y+2*u.x*d.x*B*p.x*g.y+2*u.x*d.x*B*p.y*g.x+6*u.x*w.y*p.x*_*g.x+6*u.x*f.x*p.x*_*m.y+6*u.x*p.x*f.y*m.x*_+4*u.y*h.x*d.y*M*g.y+6*u.y*w.x*p.x*_*g.x+2*u.y*h.y*d.x*M*g.y-3*u.y*h.y*d.y*M*g.x+2*u.y*d.x*B*p.x*g.x+6*u.y*f.x*p.x*m.x*_-3*h.x*w.x*d.x*_*g.y+2*h.x*w.x*d.y*_*g.x+h.x*h.y*B*p.x*g.x-3*h.x*d.x*w.y*_*g.x-3*h.x*d.x*f.x*_*m.y-3*h.x*d.x*f.y*m.x*_+2*h.x*f.x*d.y*m.x*_+4*w.x*h.y*d.x*_*g.x+4*h.y*d.x*f.x*m.x*_-2*u.x*$*d.y*p.y*g.y-6*u.y*w.x*M*p.y*g.y-6*u.y*w.y*M*p.y*g.x-6*u.y*f.x*M*p.y*m.y-2*u.y*$*d.y*p.x*g.y-2*u.y*$*d.y*p.y*g.x-6*u.y*M*f.y*m.x*p.y-h.x*h.y*$*p.y*g.y-2*h.x*D*p.x*p.y*g.x+3*w.x*h.y*d.y*M*g.y-2*w.x*d.x*B*p.x*g.y-2*w.x*d.x*B*p.y*g.x-6*w.x*w.y*p.x*_*g.x-6*w.x*f.x*p.x*_*m.y-6*w.x*p.x*f.y*m.x*_+3*h.y*w.y*d.y*M*g.x+3*h.y*f.x*d.y*M*m.y+3*h.y*d.y*M*f.y*m.x-2*d.x*w.y*B*p.x*g.x-2*d.x*f.x*B*p.x*m.y-2*d.x*f.x*B*m.x*p.y-2*d.x*B*p.x*f.y*m.x-6*w.y*f.x*p.x*m.x*_-D*d.x*d.y*p.x*g.x+2*w.x*$*d.y*p.y*g.y+6*w.y*M*f.y*m.x*p.y+2*b*h.y*p.x*p.y*g.y+b*d.x*d.y*p.y*g.y+2*$*w.y*d.y*p.y*g.x+2*$*f.x*d.y*p.y*m.y+2*$*d.y*f.y*m.x*p.y+j*A+3*v*A*g.x-3*L*V*g.y+3*N*A*g.x+R*M*g.x-C*_*g.y-h.x*D*M*g.y+b*h.y*_*g.x-3*v*p.x*_*g.y+3*L*M*p.y*g.x-b*B*p.x*g.y+D*$*p.y*g.x-3*F*p.x*f.y*_-3*N*p.x*_*g.y+3*T*M*p.y*g.x+h.x*d.x*p.x*p.y*(6*w.y*g.y+6*f.y*m.y)+S*p.y*(-2*w.y*g.y-2*f.y*m.y)+u.y*V*(6*w.y*g.y+6*f.y*m.y)+h.y*d.x*M*(-2*w.y*g.y-2*f.y*m.y)+$*d.y*p.x*(2*w.y*g.y+2*f.y*m.y)+h.x*d.y*M*(-4*w.y*g.y-4*f.y*m.y)+u.x*M*p.y*(-6*w.y*g.y-6*f.y*m.y)+w.x*M*p.y*(6*w.y*g.y+6*f.y*m.y)+f.x*M*p.y*(6*w.y*m.y+3*O)+V*(-2*w.y*f.y*m.y-T*g.y-f.y*(2*w.y*m.y+O)-w.y*(2*w.y*g.y+2*f.y*m.y)),-u.x*h.x*d.y*p.x*p.y*m.y+u.x*h.y*d.x*p.x*p.y*m.y+6*u.x*h.y*d.y*p.x*m.x*p.y-6*u.y*h.x*d.x*p.x*p.y*m.y-u.y*h.x*d.y*p.x*m.x*p.y+u.y*h.y*d.x*p.x*m.x*p.y+h.x*h.y*d.x*d.y*p.x*m.y-h.x*h.y*d.x*d.y*m.x*p.y+h.x*w.x*d.y*p.x*p.y*m.y+h.x*w.y*d.y*p.x*m.x*p.y+h.x*f.x*d.y*p.x*f.y*p.y-w.x*h.y*d.x*p.x*p.y*m.y-6*w.x*h.y*d.y*p.x*m.x*p.y-h.y*d.x*w.y*p.x*m.x*p.y-h.y*d.x*f.x*p.x*f.y*p.y-6*u.x*w.x*m.x*A-2*u.x*z*p.x*m.x+2*w.x*z*p.x*m.x+2*u.y*S*p.y*m.y-6*u.x*u.y*p.x*m.x*_+3*u.x*h.x*d.x*_*m.y-2*u.x*h.x*d.y*m.x*_-4*u.x*h.y*d.x*m.x*_+3*u.y*h.x*d.x*m.x*_+6*u.x*u.y*M*p.y*m.y+6*u.x*w.x*p.x*_*m.y-3*u.x*h.y*d.y*M*m.y+2*u.x*d.x*B*p.x*m.y+2*u.x*d.x*B*m.x*p.y+6*u.x*w.y*p.x*m.x*_+6*u.x*f.x*p.x*f.y*_+4*u.y*h.x*d.y*M*m.y+6*u.y*w.x*p.x*m.x*_+2*u.y*h.y*d.x*M*m.y-3*u.y*h.y*d.y*M*m.x+2*u.y*d.x*B*p.x*m.x-3*h.x*w.x*d.x*_*m.y+2*h.x*w.x*d.y*m.x*_+h.x*h.y*B*p.x*m.x-3*h.x*d.x*w.y*m.x*_-3*h.x*d.x*f.x*f.y*_+4*w.x*h.y*d.x*m.x*_-2*u.x*$*d.y*p.y*m.y-6*u.y*w.x*M*p.y*m.y-6*u.y*w.y*M*m.x*p.y-6*u.y*f.x*M*f.y*p.y-2*u.y*$*d.y*p.x*m.y-2*u.y*$*d.y*m.x*p.y-h.x*h.y*$*p.y*m.y-2*h.x*D*p.x*m.x*p.y+3*w.x*h.y*d.y*M*m.y-2*w.x*d.x*B*p.x*m.y-2*w.x*d.x*B*m.x*p.y-6*w.x*w.y*p.x*m.x*_-6*w.x*f.x*p.x*f.y*_+3*h.y*w.y*d.y*M*m.x+3*h.y*f.x*d.y*M*f.y-2*d.x*w.y*B*p.x*m.x-2*d.x*f.x*B*p.x*f.y-D*d.x*d.y*p.x*m.x+2*w.x*$*d.y*p.y*m.y-3*h.y*F*d.y*p.x*p.y+6*w.y*f.x*M*f.y*p.y+2*b*h.y*p.x*p.y*m.y+b*d.x*d.y*p.y*m.y+2*$*w.y*d.y*m.x*p.y+2*$*f.x*d.y*f.y*p.y-3*u.x*F*A+3*w.x*F*A+3*v*m.x*A-3*L*V*m.y+3*N*m.x*A+F*z*p.x+R*M*m.x-C*_*m.y+3*u.y*F*p.x*_-h.x*D*M*m.y+h.x*F*d.y*_+2*h.y*d.x*F*_+b*h.y*m.x*_-d.x*F*B*p.y-3*w.y*F*p.x*_-3*v*p.x*_*m.y+3*L*M*m.x*p.y-b*B*p.x*m.y+D*$*m.x*p.y-3*N*p.x*_*m.y+3*T*M*m.x*p.y+$*d.y*p.x*(2*w.y*m.y+O)+h.x*d.x*p.x*p.y*(6*w.y*m.y+3*O)+S*p.y*(-2*w.y*m.y-O)+u.y*V*(6*w.y*m.y+3*O)+h.y*d.x*M*(-2*w.y*m.y-O)+h.x*d.y*M*(-4*w.y*m.y-2*O)+u.x*M*p.y*(-6*w.y*m.y-3*O)+w.x*M*p.y*(6*w.y*m.y+3*O)+V*(-2*w.y*O-T*m.y-w.y*(2*w.y*m.y+O)),-u.x*h.x*d.y*p.x*f.y*p.y+u.x*h.y*d.x*p.x*f.y*p.y+6*u.x*h.y*f.x*d.y*p.x*p.y-6*u.y*h.x*d.x*p.x*f.y*p.y-u.y*h.x*f.x*d.y*p.x*p.y+u.y*h.y*d.x*f.x*p.x*p.y-h.x*h.y*d.x*f.x*d.y*p.y+h.x*h.y*d.x*d.y*p.x*f.y+h.x*w.x*d.y*p.x*f.y*p.y+6*h.x*d.x*w.y*p.x*f.y*p.y+h.x*w.y*f.x*d.y*p.x*p.y-w.x*h.y*d.x*p.x*f.y*p.y-6*w.x*h.y*f.x*d.y*p.x*p.y-h.y*d.x*w.y*f.x*p.x*p.y-6*u.x*w.x*f.x*A-2*u.x*f.x*z*p.x+6*u.y*w.y*V*f.y+2*w.x*f.x*z*p.x+2*u.y*S*f.y*p.y-2*S*w.y*f.y*p.y-6*u.x*u.y*f.x*p.x*_+3*u.x*h.x*d.x*f.y*_-2*u.x*h.x*f.x*d.y*_-4*u.x*h.y*d.x*f.x*_+3*u.y*h.x*d.x*f.x*_+6*u.x*u.y*M*f.y*p.y+6*u.x*w.x*p.x*f.y*_-3*u.x*h.y*d.y*M*f.y+2*u.x*d.x*f.x*B*p.y+2*u.x*d.x*B*p.x*f.y+6*u.x*w.y*f.x*p.x*_+4*u.y*h.x*d.y*M*f.y+6*u.y*w.x*f.x*p.x*_+2*u.y*h.y*d.x*M*f.y-3*u.y*h.y*f.x*d.y*M+2*u.y*d.x*f.x*B*p.x-3*h.x*w.x*d.x*f.y*_+2*h.x*w.x*f.x*d.y*_+h.x*h.y*f.x*B*p.x-3*h.x*d.x*w.y*f.x*_+4*w.x*h.y*d.x*f.x*_-6*u.x*w.y*M*f.y*p.y-2*u.x*$*d.y*f.y*p.y-6*u.y*w.x*M*f.y*p.y-6*u.y*w.y*f.x*M*p.y-2*u.y*$*f.x*d.y*p.y-2*u.y*$*d.y*p.x*f.y-h.x*h.y*$*f.y*p.y-4*h.x*w.y*d.y*M*f.y-2*h.x*D*f.x*p.x*p.y+3*w.x*h.y*d.y*M*f.y-2*w.x*d.x*f.x*B*p.y-2*w.x*d.x*B*p.x*f.y-6*w.x*w.y*f.x*p.x*_-2*h.y*d.x*w.y*M*f.y+3*h.y*w.y*f.x*d.y*M-2*d.x*w.y*f.x*B*p.x-D*d.x*f.x*d.y*p.x+6*w.x*w.y*M*f.y*p.y+2*w.x*$*d.y*f.y*p.y+2*b*h.y*p.x*f.y*p.y+b*d.x*d.y*f.y*p.y+2*$*w.y*f.x*d.y*p.y+2*$*w.y*d.y*p.x*f.y+3*v*f.x*A-3*L*V*f.y+3*N*f.x*A+R*f.x*M-C*f.y*_-3*T*V*f.y-h.x*D*M*f.y+b*h.y*f.x*_-3*v*p.x*f.y*_+3*L*f.x*M*p.y-b*B*p.x*f.y+D*$*f.x*p.y-3*N*p.x*f.y*_+3*T*f.x*M*p.y,u.x*u.y*h.x*d.y*p.x*p.y-u.x*u.y*h.y*d.x*p.x*p.y+u.x*h.x*h.y*d.x*d.y*p.y-u.y*h.x*h.y*d.x*d.y*p.x-u.x*h.x*w.y*d.y*p.x*p.y+6*u.x*w.x*h.y*d.y*p.x*p.y+u.x*h.y*d.x*w.y*p.x*p.y-u.y*h.x*w.x*d.y*p.x*p.y-6*u.y*h.x*d.x*w.y*p.x*p.y+u.y*w.x*h.y*d.x*p.x*p.y-h.x*w.x*h.y*d.x*d.y*p.y+h.x*h.y*d.x*w.y*d.y*p.x+h.x*w.x*w.y*d.y*p.x*p.y-w.x*h.y*d.x*w.y*p.x*p.y-2*u.x*w.x*z*p.x+2*u.y*S*w.y*p.y-3*u.x*u.y*h.x*d.x*_-6*u.x*u.y*w.x*p.x*_+3*u.x*u.y*h.y*d.y*M-2*u.x*u.y*d.x*B*p.x-2*u.x*h.x*w.x*d.y*_-u.x*h.x*h.y*B*p.x+3*u.x*h.x*d.x*w.y*_-4*u.x*w.x*h.y*d.x*_+3*u.y*h.x*w.x*d.x*_+6*u.x*u.y*w.y*M*p.y+2*u.x*u.y*$*d.y*p.y+2*u.x*h.x*D*p.x*p.y+2*u.x*w.x*d.x*B*p.y+6*u.x*w.x*w.y*p.x*_-3*u.x*h.y*w.y*d.y*M+2*u.x*d.x*w.y*B*p.x+u.x*D*d.x*d.y*p.x+u.y*h.x*h.y*$*p.y+4*u.y*h.x*w.y*d.y*M-3*u.y*w.x*h.y*d.y*M+2*u.y*w.x*d.x*B*p.x+2*u.y*h.y*d.x*w.y*M+h.x*w.x*h.y*B*p.x-3*h.x*w.x*d.x*w.y*_-2*u.x*$*w.y*d.y*p.y-6*u.y*w.x*w.y*M*p.y-2*u.y*w.x*$*d.y*p.y-2*u.y*b*h.y*p.x*p.y-u.y*b*d.x*d.y*p.y-2*u.y*$*w.y*d.y*p.x-2*h.x*w.x*D*p.x*p.y-h.x*h.y*$*w.y*p.y+3*w.x*h.y*w.y*d.y*M-2*w.x*d.x*w.y*B*p.x-w.x*D*d.x*d.y*p.x+3*L*h.x*d.x*p.x*p.y+3*h.x*d.x*T*p.x*p.y+2*w.x*$*w.y*d.y*p.y-3*v*h.y*d.y*p.x*p.y+2*b*h.y*w.y*p.x*p.y+b*d.x*w.y*d.y*p.y-3*N*h.y*d.y*p.x*p.y-P*A+k*V+E*A-H*V-3*u.x*N*A-u.x*R*M+3*v*w.x*A+u.y*C*_+3*u.y*T*V+w.x*R*M+v*z*p.x-3*L*w.y*V-L*S*p.y+N*z*p.x-C*w.y*_-S*T*p.y-u.x*b*h.y*_+u.y*h.x*D*M-3*u.x*L*M*p.y-u.x*D*$*p.y+u.y*b*B*p.x-h.x*D*w.y*M+3*v*u.y*p.x*_+v*h.x*d.y*_+2*v*h.y*d.x*_-2*L*h.x*d.y*M-L*h.y*d.x*M+b*w.x*h.y*_-3*u.x*T*M*p.y+3*u.y*N*p.x*_+h.x*N*d.y*_-2*h.x*T*d.y*M+w.x*D*$*p.y-h.y*d.x*T*M-v*d.x*B*p.y-3*v*w.y*p.x*_+3*L*w.x*M*p.y+L*$*d.y*p.x-b*w.y*B*p.x+2*N*h.y*d.x*_+3*w.x*T*M*p.y-N*d.x*B*p.y-3*N*w.y*p.x*_+$*T*d.y*p.x).getRootsInInterval(0,1),X=0;X<Q.length;X++){var Y=Q[X],tt=new Polynomial(p.x,d.x,h.x,u.x-w.x-Y*f.x-Y*Y*m.x-Y*Y*Y*g.x).getRoots(),et=new Polynomial(p.y,d.y,h.y,u.y-w.y-Y*f.y-Y*Y*m.y-Y*Y*Y*g.y).getRoots();if(tt.length>0&&et.length>0){t:for(var yt=0;yt<tt.length;yt++){var xt=tt[yt];if(0<=xt&&xt<=1)for(var nt=0;nt<et.length;nt++)if(Math.abs(xt-et[nt])<1e-4){I.points.push(g.multiply(Y*Y*Y).add(m.multiply(Y*Y).add(f.multiply(Y).add(w))));break t}}}}return I.points.length>0&&(I.status="Intersection"),I},Intersection.intersectBezier3Circle=function(t,e,y,x,n,i){return Intersection.intersectBezier3Ellipse(t,e,y,x,n,i,i)},Intersection.intersectBezier3Ellipse=function(t,e,y,x,n,i,s){var o,r,a,c,l,p,d,h,u=new Intersection("No Intersection");o=t.multiply(-1),r=e.multiply(3),a=y.multiply(-3),c=o.add(r.add(a.add(x))),l=new Vector2D(c.x,c.y),o=t.multiply(3),r=e.multiply(-6),a=y.multiply(3),c=o.add(r.add(a)),p=new Vector2D(c.x,c.y),o=t.multiply(-3),r=e.multiply(3),a=o.add(r),d=new Vector2D(a.x,a.y),h=new Vector2D(t.x,t.y);for(var g=i*i,m=s*s,f=new Polynomial(l.x*l.x*m+l.y*l.y*g,2*(l.x*p.x*m+l.y*p.y*g),2*(l.x*d.x*m+l.y*d.y*g)+p.x*p.x*m+p.y*p.y*g,2*l.x*m*(h.x-n.x)+2*l.y*g*(h.y-n.y)+2*(p.x*d.x*m+p.y*d.y*g),2*p.x*m*(h.x-n.x)+2*p.y*g*(h.y-n.y)+d.x*d.x*m+d.y*d.y*g,2*d.x*m*(h.x-n.x)+2*d.y*g*(h.y-n.y),h.x*h.x*m-2*h.y*n.y*g-2*h.x*n.x*m+h.y*h.y*g+n.x*n.x*m+n.y*n.y*g-g*m).getRootsInInterval(0,1),w=0;w<f.length;w++){var I=f[w];u.points.push(l.multiply(I*I*I).add(p.multiply(I*I).add(d.multiply(I).add(h))))}return u.points.length>0&&(u.status="Intersection"),u},Intersection.intersectBezier3Line=function(t,e,y,x,n,i){var s,o,r,a,c,l,p,d,h,u,g=n.min(i),m=n.max(i),f=new Intersection("No Intersection");s=t.multiply(-1),o=e.multiply(3),r=y.multiply(-3),a=s.add(o.add(r.add(x))),c=new Vector2D(a.x,a.y),s=t.multiply(3),o=e.multiply(-6),r=y.multiply(3),a=s.add(o.add(r)),l=new Vector2D(a.x,a.y),s=t.multiply(-3),o=e.multiply(3),r=s.add(o),p=new Vector2D(r.x,r.y),d=new Vector2D(t.x,t.y),u=new Vector2D(n.y-i.y,i.x-n.x),h=n.x*i.y-i.x*n.y,roots=new Polynomial(u.dot(c),u.dot(l),u.dot(p),u.dot(d)+h).getRoots();for(var w=0;w<roots.length;w++){var I=roots[w];if(0<=I&&I<=1){var v=t.lerp(e,I),P=e.lerp(y,I),L=y.lerp(x,I),k=v.lerp(P,I),b=P.lerp(L,I),C=k.lerp(b,I);n.x==i.x?g.y<=C.y&&C.y<=m.y&&(f.status="Intersection",f.appendPoint(C)):n.y==i.y?g.x<=C.x&&C.x<=m.x&&(f.status="Intersection",f.appendPoint(C)):C.gte(g)&&C.lte(m)&&(f.status="Intersection",f.appendPoint(C))}}return f},Intersection.intersectBezier3Polygon=function(t,e,y,x,n){for(var i=new Intersection("No Intersection"),s=n.length,o=0;o<s;o++){var r=n[o],a=n[(o+1)%s],c=Intersection.intersectBezier3Line(t,e,y,x,r,a);i.appendPoints(c.points)}return i.points.length>0&&(i.status="Intersection"),i},Intersection.intersectBezier3Rectangle=function(t,e,y,x,n,i){var s=n.min(i),o=n.max(i),r=new Point2D(o.x,s.y),a=new Point2D(s.x,o.y),c=Intersection.intersectBezier3Line(t,e,y,x,s,r),l=Intersection.intersectBezier3Line(t,e,y,x,r,o),p=Intersection.intersectBezier3Line(t,e,y,x,o,a),d=Intersection.intersectBezier3Line(t,e,y,x,a,s),h=new Intersection("No Intersection");return h.appendPoints(c.points),h.appendPoints(l.points),h.appendPoints(p.points),h.appendPoints(d.points),h.points.length>0&&(h.status="Intersection"),h},Intersection.intersectCircleCircle=function(t,e,y,x){var n,i=e+x,s=Math.abs(e-x),o=t.distanceFrom(y);if(o>i)n=new Intersection("Outside");else if(o<s)n=new Intersection("Inside");else{n=new Intersection("Intersection");var r=(e*e-x*x+o*o)/(2*o),a=Math.sqrt(e*e-r*r),c=t.lerp(y,r/o),l=a/o;n.points.push(new Point2D(c.x-l*(y.y-t.y),c.y+l*(y.x-t.x))),n.points.push(new Point2D(c.x+l*(y.y-t.y),c.y-l*(y.x-t.x)))}return n},Intersection.intersectCircleEllipse=function(t,e,y,x,n){return Intersection.intersectEllipseEllipse(t,e,e,y,x,n)},Intersection.intersectCircleLine=function(t,e,y,x){var n,i=(x.x-y.x)*(x.x-y.x)+(x.y-y.y)*(x.y-y.y),s=2*((x.x-y.x)*(y.x-t.x)+(x.y-y.y)*(y.y-t.y)),o=s*s-4*i*(t.x*t.x+t.y*t.y+y.x*y.x+y.y*y.y-2*(t.x*y.x+t.y*y.y)-e*e);if(o<0)n=new Intersection("Outside");else if(0==o)n=new Intersection("Tangent");else{var r=Math.sqrt(o),a=(-s+r)/(2*i),c=(-s-r)/(2*i);(a<0||a>1)&&(c<0||c>1)?n=new Intersection(a<0&&c<0||a>1&&c>1?"Outside":"Inside"):(n=new Intersection("Intersection"),0<=a&&a<=1&&n.points.push(y.lerp(x,a)),0<=c&&c<=1&&n.points.push(y.lerp(x,c)))}return n},Intersection.intersectCirclePolygon=function(t,e,y){for(var x,n=new Intersection("No Intersection"),i=y.length,s=0;s<i;s++){var o=y[s],r=y[(s+1)%i];x=Intersection.intersectCircleLine(t,e,o,r),n.appendPoints(x.points)}return n.points.length>0?n.status="Intersection":n.status=x.status,n},Intersection.intersectCircleRectangle=function(t,e,y,x){var n=y.min(x),i=y.max(x),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectCircleLine(t,e,n,s),a=Intersection.intersectCircleLine(t,e,s,i),c=Intersection.intersectCircleLine(t,e,i,o),l=Intersection.intersectCircleLine(t,e,o,n),p=new Intersection("No Intersection");return p.appendPoints(r.points),p.appendPoints(a.points),p.appendPoints(c.points),p.appendPoints(l.points),p.points.length>0?p.status="Intersection":p.status=r.status,p},Intersection.intersectEllipseEllipse=function(t,e,y,x,n,i){for(var s=[y*y,0,e*e,-2*y*y*t.x,-2*e*e*t.y,y*y*t.x*t.x+e*e*t.y*t.y-e*e*y*y],o=[i*i,0,n*n,-2*i*i*x.x,-2*n*n*x.y,i*i*x.x*x.x+n*n*x.y*x.y-n*n*i*i],r=Intersection.bezout(s,o).getRoots(),a=.001*(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2]),c=.001*(o[0]*o[0]+2*o[1]*o[1]+o[2]*o[2]),l=new Intersection("No Intersection"),p=0;p<r.length;p++)for(var d=new Polynomial(s[0],s[3]+r[p]*s[1],s[5]+r[p]*(s[4]+r[p]*s[2])).getRoots(),h=0;h<d.length;h++){var u=(s[0]*d[h]+s[1]*r[p]+s[3])*d[h]+(s[2]*r[p]+s[4])*r[p]+s[5];Math.abs(u)<a&&(u=(o[0]*d[h]+o[1]*r[p]+o[3])*d[h]+(o[2]*r[p]+o[4])*r[p]+o[5],Math.abs(u)<c&&l.appendPoint(new Point2D(d[h],r[p])))}return l.points.length>0&&(l.status="Intersection"),l},Intersection.intersectEllipseLine=function(t,e,y,x,n){var i,s=new Vector2D(x.x,x.y),o=Vector2D.fromPoints(x,n),r=new Vector2D(t.x,t.y),a=s.subtract(r),c=new Vector2D(o.x/(e*e),o.y/(y*y)),l=new Vector2D(a.x/(e*e),a.y/(y*y)),p=o.dot(c),d=o.dot(l),h=d*d-p*(t=a.dot(l)-1);if(h<0)i=new Intersection("Outside");else if(h>0){var u=Math.sqrt(h),g=(-d-u)/p,m=(-d+u)/p;(g<0||1<g)&&(m<0||1<m)?i=new Intersection(g<0&&m<0||g>1&&m>1?"Outside":"Inside"):(i=new Intersection("Intersection"),0<=g&&g<=1&&i.appendPoint(x.lerp(n,g)),0<=m&&m<=1&&i.appendPoint(x.lerp(n,m)))}else{var f=-d/p;0<=f&&f<=1?(i=new Intersection("Intersection")).appendPoint(x.lerp(n,f)):i=new Intersection("Outside")}return i},Intersection.intersectEllipsePolygon=function(t,e,y,x){for(var n=new Intersection("No Intersection"),i=x.length,s=0;s<i;s++){var o=x[s],r=x[(s+1)%i],a=Intersection.intersectEllipseLine(t,e,y,o,r);n.appendPoints(a.points)}return n.points.length>0&&(n.status="Intersection"),n},Intersection.intersectEllipseRectangle=function(t,e,y,x,n){var i=x.min(n),s=x.max(n),o=new Point2D(s.x,i.y),r=new Point2D(i.x,s.y),a=Intersection.intersectEllipseLine(t,e,y,i,o),c=Intersection.intersectEllipseLine(t,e,y,o,s),l=Intersection.intersectEllipseLine(t,e,y,s,r),p=Intersection.intersectEllipseLine(t,e,y,r,i),d=new Intersection("No Intersection");return d.appendPoints(a.points),d.appendPoints(c.points),d.appendPoints(l.points),d.appendPoints(p.points),d.points.length>0&&(d.status="Intersection"),d},Intersection.intersectLineLine=function(t,e,y,x){var n,i=(x.x-y.x)*(t.y-y.y)-(x.y-y.y)*(t.x-y.x),s=(e.x-t.x)*(t.y-y.y)-(e.y-t.y)*(t.x-y.x),o=(x.y-y.y)*(e.x-t.x)-(x.x-y.x)*(e.y-t.y);if(0!=o){var r=i/o,a=s/o;0<=r&&r<=1&&0<=a&&a<=1?(n=new Intersection("Intersection")).points.push(new Point2D(t.x+r*(e.x-t.x),t.y+r*(e.y-t.y))):n=new Intersection("No Intersection")}else n=new Intersection(0==i||0==s?"Coincident":"Parallel");return n},Intersection.intersectLinePolygon=function(t,e,y){for(var x=new Intersection("No Intersection"),n=y.length,i=0;i<n;i++){var s=y[i],o=y[(i+1)%n],r=Intersection.intersectLineLine(t,e,s,o);x.appendPoints(r.points)}return x.points.length>0&&(x.status="Intersection"),x},Intersection.intersectLineRectangle=function(t,e,y,x){var n=y.min(x),i=y.max(x),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectLineLine(n,s,t,e),a=Intersection.intersectLineLine(s,i,t,e),c=Intersection.intersectLineLine(i,o,t,e),l=Intersection.intersectLineLine(o,n,t,e),p=new Intersection("No Intersection");return p.appendPoints(r.points),p.appendPoints(a.points),p.appendPoints(c.points),p.appendPoints(l.points),p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectPolygonPolygon=function(t,e){for(var y=new Intersection("No Intersection"),x=t.length,n=0;n<x;n++){var i=t[n],s=t[(n+1)%x],o=Intersection.intersectLinePolygon(i,s,e);y.appendPoints(o.points)}return y.points.length>0&&(y.status="Intersection"),y},Intersection.intersectPolygonRectangle=function(t,e,y){var x=e.min(y),n=e.max(y),i=new Point2D(n.x,x.y),s=new Point2D(x.x,n.y),o=Intersection.intersectLinePolygon(x,i,t),r=Intersection.intersectLinePolygon(i,n,t),a=Intersection.intersectLinePolygon(n,s,t),c=Intersection.intersectLinePolygon(s,x,t),l=new Intersection("No Intersection");return l.appendPoints(o.points),l.appendPoints(r.points),l.appendPoints(a.points),l.appendPoints(c.points),l.points.length>0&&(l.status="Intersection"),l},Intersection.intersectRayRay=function(t,e,y,x){var n,i=(x.x-y.x)*(t.y-y.y)-(x.y-y.y)*(t.x-y.x),s=(e.x-t.x)*(t.y-y.y)-(e.y-t.y)*(t.x-y.x),o=(x.y-y.y)*(e.x-t.x)-(x.x-y.x)*(e.y-t.y);if(0!=o){var r=i/o;(n=new Intersection("Intersection")).points.push(new Point2D(t.x+r*(e.x-t.x),t.y+r*(e.y-t.y)))}else n=new Intersection(0==i||0==s?"Coincident":"Parallel");return n},Intersection.intersectRectangleRectangle=function(t,e,y,x){var n=t.min(e),i=t.max(e),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectLineRectangle(n,s,y,x),a=Intersection.intersectLineRectangle(s,i,y,x),c=Intersection.intersectLineRectangle(i,o,y,x),l=Intersection.intersectLineRectangle(o,n,y,x),p=new Intersection("No Intersection");return p.appendPoints(r.points),p.appendPoints(a.points),p.appendPoints(c.points),p.appendPoints(l.points),p.points.length>0&&(p.status="Intersection"),p},Intersection.bezout=function(t,e){var y=t[0]*e[1]-e[0]*t[1],x=t[0]*e[2]-e[0]*t[2],n=t[0]*e[3]-e[0]*t[3],i=t[0]*e[4]-e[0]*t[4],s=t[0]*e[5]-e[0]*t[5],o=t[1]*e[2]-e[1]*t[2],r=t[1]*e[4]-e[1]*t[4],a=t[1]*e[5]-e[1]*t[5],c=t[2]*e[3]-e[2]*t[3],l=t[3]*e[4]-e[3]*t[4],p=t[3]*e[5]-e[3]*t[5],d=a+l,h=r-c;return new Polynomial(y*o-x*x,y*h+n*o-2*x*i,y*d+n*h-i*i-2*x*s,y*p+n*d-2*i*s,n*p-s*s)},$(window).resize(function(){xLimit=resetWindowLimit("x"),yLimit=resetWindowLimit("y")}),lifeCnt>0&&(document.onkeydown=function(t){switch($("#spaceship").css("opacity","1"),t.keyCode){case 68:turn=1;break;case 65:turn=-1;break;case 87:thrust=1;break;case 83:thrust=-1;break;case 32:pewpew(),resetGun=!1;break;case 13:hyperspace();break;case 8:case 46:boom()}},document.onkeyup=function(t){switch(t.keyCode){case 65:case 68:turn=0;break;case 87:case 83:thrust=0;break;case 32:resetGun=!0}},$(document).on("touchstart"," .gameBtn",function(t){$("#spaceship").css("opacity","1");var e=t.target.id;switch(console.log(e),e){case"btnLeft":turn=-1;break;case"btnRight":turn=1;break;case"btnUp":thrust=1;break;case"btnDown":thrust=-1;break;case"btnShoot":pewpew();break;case"btnHS":hyperspace()}}),$(document).on("touchend",".gameBtn",function(t){switch(t.target.id){case"btnLeft":case"btnRight":turn=0;break;case"btnUp":case"btnDown":thrust=0;break;case"glyphLeft":turn=0;break;case"btnShoot":endpew(),resetGun=!0}}));