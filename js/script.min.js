var asteroids=[],shots=[],shotCnt=0,spaceship=new Spaceship(xLimit/2,yLimit/2,0,0,0,0,0,0),colors=["#edc951","#eb6841","#cc2a36","#4f372d","#00a0b0"],rocksLrg=["26.087899,1.0434852 49.503787,26.009091 74.220561,2.6541843 96.335572,25.203747 85.278067,50.974686 98.286898,75.940275 62.512619,99.295186 26.087905,100.10053 0.7206885,77.55096 1.3711312,27.619771","27.46638,2.6445482 66.467442,0.98983643 99.048213,24.999426 V 35.822504 L 65.202598,51.325844 98.421452,73.55696 76.484471,97.835645 H 72.723845 L 60.501821,85.842551 27.596351,98.713169 0.95859607,63.02645 1.8987487,25.29194 H 36.997914","14.670645,48.844427 1.9670478,25.614646 27.37424,2.3848478 48.335078,12.875719 73.107033,1.6354928 97.878992,24.865291 75.012591,39.102909 97.878992,60.834007 75.012591,97.552066 39.442599,87.061197 26.739004,99.050766 1.3318868,75.820971"],xLimit=resetWindowLimit("x")-1,yLimit=resetWindowLimit("y")-1,lifeCnt=3,jumpCnt=3,score=0,newLifeTarget=1e4,newLife=newLifeTarget,resetGun=!0,inPlay=!1,mode="asteroids",rockCnt=10,scale=1,rockID=0,nextEnemy=2e4,enemyDelay=2e3,enemyUFO=[],delta_time=20,turn=0,thrust=0,turn_per_milli=.1,thrust_per_milli=15e-5,key_delay=50,del_v=0,del_vx=0,del_vy=0,shootsnd=null,thrustsnd=null;function animateScreen(t,e){for(var y in $("#scoreCnt span").html(score),$("#lifeCnt span").html(lifeCnt),asteroids){if(asteroids.hasOwnProperty(y))asteroids[y].changePosition(asteroids[y].x+asteroids[y].xv,asteroids[y].y+asteroids[y].yv),"asteroids"==mode&&((asteroids[y].x<=0-asteroids[y].width||asteroids[y].x>=xLimit+asteroids[y].width)&&(asteroids[y].x>=xLimit+asteroids[y].width?asteroids[y].x=-Math.abs(0-asteroids[y].width):asteroids[y].x=xLimit+asteroids[y].width),(asteroids[y].y<=0-asteroids[y].width||asteroids[y].y>=yLimit+asteroids[y].height)&&(asteroids[y].y>=yLimit+asteroids[y].height?asteroids[y].y=-Math.abs(0-asteroids[y].height):asteroids[y].y=yLimit+asteroids[y].height)),1==inPlay&&inCollision(asteroids[y])&&boom();$("#rockAnim"+asteroids[y].id).css("left",asteroids[y].x).css("top",asteroids[y].y)}for(var x in e){var n=10*Math.cos(e[x].theta*Math.PI/180)+e[x].x,i=10*Math.sin(e[x].theta*Math.PI/180)+e[x].y,s=e[x].life-5;e[x].changeLife(s),e[x].life<0?clearBullet(x):(e[x].changePosition(n,i),$("#shot"+e[x].id).css("left",e[x].x).css("top",e[x].y),isHit(e[x])&&clearBullet(x))}moveSpaceship(delta_time),updateSpaceship(delta_time)}function inCollision(t){var e=spaceship,y=t;return!(e.y+e.height<y.y||e.y>y.y+y.height||e.x+e.width<y.x||e.x>y.x+y.width)}function isHit(t){var e=asteroids,y=t;for(i=0;i<e.length;i++)if(0==(e[i].y+e[i].height<y.y||e[i].y>y.y+y.height||e[i].x+e[i].width<y.x||e[i].x>y.x+y.width))return blowupAsteroid(e[i],i),!0}function blowupAsteroid(t,e){$("#sndAstroBoom").get(0).pause(),$("#sndAstroBoom").get(0).currentTime=0,$("#sndAstroBoom").get(0).play();var y=t;pointCnt(t.points),y.height>25&&makeAsteroidPieces(y.x,y.y,y.height/2,2),$("#rockAnim"+y.id).remove(),asteroids.splice(e,1),0==asteroids.length&&regenerateAsteroids()}function makeAsteroidPieces(t,e,y,x){for(i=0;i<x;i++){switch(rockID++,thisRockSize=y,y){case 100:scale="1",rockPnt=20;break;case 50:scale=".5",rockPnt=50;break;case 25:scale=".25"}asteroids.push(new Asteroid(rockID,"test",thisRockSize,thisRockSize,t,e,getRandomFloat(-3,3),getRandomFloat(-3,3),colors[Math.floor(getRandomFloat(0,5))],"generic",!1,rockPnt,!0)),$("body").append("<svg id='rockAnim"+asteroids[asteroids.length-1].id+"' data-id='"+asteroids[asteroids.length-1].id+"' class='asteroid rocksize"+y+"'><path cx='"+asteroids[asteroids.length-1].width+"' cy='"+asteroids[asteroids.length-1].height+"' r='"+(asteroids[asteroids.length-1].width/2-5)+"' stroke='"+asteroids[asteroids.length-1].color+"' stroke-width='2' d='M "+rocksLrg[Math.floor(getRandomFloat(0,3))]+" Z'  id='astroPath"+asteroids[asteroids.length-1].id+"' transform='scale("+scale+", "+scale+")' /><text x='20' y='55' fill='"+asteroids[asteroids.length-1].color+"' transform='scale("+scale+", "+scale+")></text></svg>"),$("#rockAnim"+asteroids[asteroids.length-1].id).css("color",asteroids[asteroids.length-1].color).css("border-color",asteroids[asteroids.length-1].color).css("width",asteroids[asteroids.length-1].width).css("height",asteroids[asteroids.length-1].height).addClass("rockAnim")}}function pointCnt(t){score+=t,(newLife-=t)<0&&(lifeCnt++,newLife=newLifeTarget+newLife,extraLifesnd.play())}function checkPathTouch(t){var e=spaceship,y=t,x=[],n=[];for(i=0;i<e.getTotalLength();i+=1)x.push(e.getPointAtLength(i));for(i=0;i<y.getTotalLength();i+=1)n.push(y.getPointAtLength(i));for(i=0;i<x.length;i++){var s=Math.floor(x[i].x),o=Math.floor(x[i].y);for(j=0;j<n.length;j++)if(s==Math.floor(n[j].x)&&o==Math.floor(n[j].y)){console.log(Math.floor(n[j].x)+"- "+Math.floor(n[j].y)),boom();break}}}function boom(){$("#spaceship").hide(),inPlay=!1,$("#sndBoom").get(0).play(),lifeCnt>0&&(lifeCnt--,$("#lifeCnt span").html(lifeCnt),jumpCnt=3,$("#HSCnt span").html(jumpCnt),setTimeout(function(){resetSpaceship()},3e3))}function resetSpaceship(){lifeCnt>0?($("#spaceship").show(),spaceship=new Spaceship(xLimit/2,yLimit/2,0,0,-90,0,0,0),inPlay=!0):(inPlay=!1,$("#spaceship").hide(),$("#gameOverBoard").css("display","block"),checkHighScoreCookie())}function makeShot(){shotCnt++,shots.push(new Shot(shotCnt,spaceship.x,spaceship.y,spaceship.vx,spaceship.vy,spaceship.theta,spaceship.yaw,1800,0,0)),$("body").append("<svg id='shot"+shotCnt+"' data-id='"+shotCnt+"' class='shot' height='6' width='6'><circle cx='3' cy='3' r='3' stroke='white' stroke-width='2' fill='red' /></svg>")}function pewpew(){lifeCnt>0&&1==resetGun&&(shootsnd.play(),makeShot(),resetGun=!1)}function spawnEnemy(){ufo=new Ufo(-100,-100,0,0,0,0,200);Math.random(),Math.random(),ufo.y;console.log("enemy ship")}function resetgame(){$("#gameOverBoard").hide(),$(".asteroid").remove(),lifeCnt=3,jumpCnt=3,score=0,asteroids=[],regenerateAsteroids(),$("body").append("<svg id='spaceship' class=''><path cx='5' cy='5' r='10' stroke='#ffffff' stroke-width='2' d='M "+spaceship.shape+" Z'  id='outerShip' /></svg>"),$("#lifeCnt span").html(lifeCnt),$("#HSCnt span").html(jumpCnt),resetSpaceship()}function regenerateAsteroids(){for(i=0;i<rockCnt;i++)rockID++,thisRockSize=Math.floor(getRandomFloat(50,100)),thisRockSize=100,asteroids.push(new Asteroid(rockID,"test",thisRockSize,thisRockSize,getRandomFloat(0,xLimit-150),getRandomFloat(0,yLimit-150),getRandomFloat(-3,3),getRandomFloat(-3,3),colors[Math.floor(getRandomFloat(0,5))],"generic",!1,20,!0));for(var t in asteroids)asteroids.hasOwnProperty(t)&&($("body").append("<svg id='rockAnim"+asteroids[t].id+"' data-id='"+asteroids[t].id+"' class='asteroid rocksize100'><path cx='"+asteroids[t].width+"' cy='"+asteroids[t].height+"' r='"+(asteroids[t].width/2-5)+"' stroke='"+asteroids[t].color+"' stroke-width='2' d='M "+rocksLrg[Math.floor(getRandomFloat(0,3))]+" Z'  id='astroPath"+asteroids[t].id+"' /><text x='20' y='55' fill='"+asteroids[t].color+"'></text></svg>"),$("#rockAnim"+asteroids[t].id).css("color",asteroids[t].color).css("border-color",asteroids[t].color).css("width",asteroids[t].width).css("height",asteroids[t].height).addClass("rockAnim"))}function Intersection(t){arguments.length>0&&this.init(t)}function Asteroid(t,e,y,x,n,i,s,o,r,a,c,l,h){this.id=t,this.title=e,this.width=y,this.height=x,this.x=n,this.y=i,this.xv=s,this.yv=o,this.color=r,this.type=a,this.oob=c,this.points=l,this.gravity=.1,this.gravitySpeed=0,this.bounce=.4,this.exists=!0,this.resetGravity=function(){},this.newPos=function(){this.gravitySpeed+=this.gravity,this.x+=this.xvel;var t=this.yv;this.yv<0&&(t=0),t=0,this.y+=t+this.gravitySpeed,this.hitBottom()},this.hitBottom=function(){var t=window.innerHeight-this.height;this.y>t&&(this.x=t,this.gravitySpeed=-this.gravitySpeed*this.bounce),this.x>window.innerWidth+this.width&&(this.x=0-this.width),this.x<0-this.width&&(this.x=window.innerWidth+this.width)},this.changeColor=function(t){this.color=t},this.oob=function(t){this.oob=t},this.changeVelocity=function(t,e){"x"==t&&(this.xv=e),"y"==t&&(this.yv=e)},this.changePosition=function(t,e){this.x=t,this.y=e},this.getVelocity=function(t){return this.direction},this.changeExistance=function(t){this.exists=t}}function Spaceship(t,e,y,x,n,i,s,o){this.x=t,this.y=e,this.vx=y,this.vy=x,this.theta=n,this.width=20,this.height=15,this.yaw=i,this.x_points=s,this.y_points=o,this.shape="14.383032,5.9181762 0.35137621,0.04626516 2.7568063,5.9181762 0.35137621,11.338401"}function Shot(t,e,y,x,n,i,s,o,r,a){this.id=t,this.x=e,this.y=y,this.vx=x,this.vy=n,this.theta=i,this.width=6,this.height=6,this.yaw=s,this.life=o,this.x_points=r,this.y_points=a,this.changePosition=function(t,e){this.x=t,this.y=e},this.changeLife=function(t){this.life=t}}function Sound(t){this.sound=document.createElement("audio"),this.sound.src=t,this.sound.setAttribute("preload","auto"),this.sound.setAttribute("controls","none"),this.sound.style.display="none",document.body.appendChild(this.sound),this.play=function(){this.sound.play()},this.stop=function(){this.sound.pause()}}function Ufo(t,e,y,x,n,i,s){this.x=t,this.y=e,this.vx=y,this.vy=x,this.theta=n,this.width=30,this.height=20,this.yaw=i,this.points=s,this.shape="14.383032,5.9181762 0.35137621,0.04626516 2.7568063,5.9181762 0.35137621,11.338401"}function resetWindowLimit(t){var e,y,x;if(y=window.innerHeight,x=window.innerHeight,"x"==t)for(e=window.innerWidth,i=0;i<asteroids.length;i++)asteroids[i].x>=y-asteroids[i].width&&asteroids[i].changePosition(y-asteroids[i].width,x-asteroids[i].height);else for(e=window.innerHeight,i=0;i<asteroids.length;i++)asteroids[i].y>=x-asteroids[i].height&&asteroids[i].changePosition(y-asteroids[i].width,e-asteroids[i].height);return e}function getRandomFloat(t,e){return Math.random()*(e-t)+t}function clearBullet(t){$("#shot"+shots[t].id).remove(),shots.splice(t,1)}function moveSpaceship(t){var e=Math.PI/180;0!=turn&&void 0!=turn?(spaceship.theta=spaceship.theta+turn*turn_per_milli*t,lifeCnt>0&&$("#sndTurn").get(0).play()):($("#sndTurn").get(0).pause(),$("#sndTurn").get(0).currentTime=0),0!=thrust&&void 0!=thrust?(del_vx=(del_v=thrust*thrust_per_milli*t)*Math.cos(spaceship.theta*e),del_vy=del_v*Math.sin(spaceship.theta*e),lifeCnt>0&&thrustsnd.play()):(del_vx=0,del_vy=0,thrustsnd.stop()),spaceship.vx=spaceship.vx+del_vx,spaceship.vy=spaceship.vy+del_vy}function updateSpaceship(t){spaceship.x>=xLimit&&(spaceship.x=0),spaceship.x<0&&(spaceship.x=xLimit),spaceship.y>=yLimit&&(spaceship.y=0),spaceship.y<0&&(spaceship.y=yLimit),spaceship.theta+=spaceship.yaw*t,spaceship.x+=spaceship.vx*t,spaceship.y+=spaceship.vy*t,$("#spaceship").css("left",spaceship.x).css("top",spaceship.y).css({transform:"rotate("+spaceship.theta+"deg)"})}function hyperspace(){lifeCnt>0&&(jumpCnt>0?($("#sndHyperspace").get(0).currentTime=0,$("#sndHyperspace").get(0).play(),spaceship.x=getRandomFloat(1,xLimit-5),spaceship.y=getRandomFloat(1,yLimit-5),jumpCnt--,$("#HSCnt span").html(jumpCnt)):$("#sndHyperspaceFail").get(0).play())}function isPointInPoly(t,e){for(var y=!1,x=-1,n=t.length,i=n-1;++x<n;i=x)(t[x].y<=e.y&&e.y<t[i].y||t[i].y<=e.y&&e.y<t[x].y)&&e.x<(t[i].x-t[x].x)*(e.y-t[x].y)/(t[i].y-t[x].y)+t[x].x&&(y=!y);return y}function setCookie(t,e,y){var x=new Date;x.setTime(x.getTime()+24*y*60*60*1e3);var n="expires="+x.toUTCString();document.cookie=t+"="+e+";"+n+";path=/"}function getCookie(t){for(var e=t+"=",y=document.cookie.split(";"),x=0;x<y.length;x++){for(var n=y[x];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""}function checkHighScoreCookie(){var t=getCookie("highScore");""!=t?setCookie("highScore",score,1e3):t<=score&&setCookie("highScore",score,1e3)}extraLifesnd=null,$(document).ready(function(){shootsnd=new Sound("snd/fire.mp3"),thrustsnd=new Sound("snd/thrust.mp3"),extraLifesnd=new Sound("snd/extraShip.ogg"),resetgame(),xLimit>768&&(inPlay=!1,$("#welcomeModel").modal("show"),$("#welcomeModel").on("hidden.bs.modal",function(t){inPlay=!0}));setInterval(function(){animateScreen(asteroids,shots),nextEnemy=setTimeout(spawnEnemy(),enemyDelay)},delta_time)}),Intersection.prototype.init=function(t){this.status=t,this.points=new Array},Intersection.prototype.appendPoint=function(t){this.points.push(t)},Intersection.prototype.appendPoints=function(t){this.points=this.points.concat(t)},Intersection.intersectShapes=function(t,e){var y,x=t.getIntersectionParams(),n=e.getIntersectionParams();if(null!=x&&null!=n)if("Path"==x.name)y=Intersection.intersectPathShape(t,e);else if("Path"==n.name)y=Intersection.intersectPathShape(e,t);else{var i,s;if(x.name<n.name?(i="intersect"+x.name+n.name,s=x.params.concat(n.params)):(i="intersect"+n.name+x.name,s=n.params.concat(x.params)),!(i in Intersection))throw new Error("Intersection not available: "+i);y=Intersection[i].apply(null,s)}else y=new Intersection("No Intersection");return y},Intersection.intersectPathShape=function(t,e){return t.intersectShape(e)},Intersection.intersectBezier2Bezier2=function(t,e,y,x,n,i){var s,o,r,a,c,l,h,p,d,u=new Intersection("No Intersection");if(s=e.multiply(-2),r=t.add(s.add(y)),s=t.multiply(-2),o=e.multiply(2),a=s.add(o),c=new Point2D(t.x,t.y),s=n.multiply(-2),l=x.add(s.add(i)),s=x.multiply(-2),o=n.multiply(2),h=s.add(o),p=new Point2D(x.x,x.y),0==r.y){var m=(f=r.x*(c.y-p.y))+(w=f-a.x*a.y),g=a.y*a.y;d=new Polynomial(r.x*l.y*l.y,2*r.x*h.y*l.y,r.x*h.y*h.y-l.x*g-l.y*f-l.y*w,-h.x*g-h.y*f-h.y*w,(c.x-p.x)*g+(c.y-p.y)*w)}else{var f=r.x*l.y-r.y*l.x,w=r.x*h.y-h.x*r.y,I=(m=a.x*r.y-a.y*r.x,g=c.y-p.y,r.y*(c.x-p.x)-r.x*g),v=-a.y*m+r.y*I,P=m*m;d=new Polynomial(f*f,2*f*w,(-l.y*P+r.y*w*w+r.y*f*I+f*v)/r.y,(-h.y*P+r.y*w*I+w*v)/r.y,(g*P+I*v)/r.y)}for(var L=d.getRoots(),k=0;k<L.length;k++){var b=L[k];if(0<=b&&b<=1){var C=new Polynomial(r.x,a.x,c.x-p.x-b*h.x-b*b*l.x).getRoots(),D=new Polynomial(r.y,a.y,c.y-p.y-b*h.y-b*b*l.y).getRoots();if(C.length>0&&D.length>0){t:for(var R=0;R<C.length;R++){var S=C[R];if(0<=S&&S<=1)for(var $=0;$<D.length;$++)if(Math.abs(S-D[$])<1e-4){u.points.push(l.multiply(b*b).add(h.multiply(b).add(p)));break t}}}}}return u.points.length>0&&(u.status="Intersection"),u},Intersection.intersectBezier2Bezier3=function(t,e,y,x,n,i,s){var o,r,a,c,l,h,p,d,u,m,g,f=new Intersection("No Intersection");o=e.multiply(-2),l=t.add(o.add(y)),o=t.multiply(-2),r=e.multiply(2),h=o.add(r),p=new Point2D(t.x,t.y),o=x.multiply(-1),r=n.multiply(3),a=i.multiply(-3),c=o.add(r.add(a.add(s))),d=new Vector2D(c.x,c.y),o=x.multiply(3),r=n.multiply(-6),a=i.multiply(3),c=o.add(r.add(a)),u=new Vector2D(c.x,c.y),o=x.multiply(-3),r=n.multiply(3),a=o.add(r),m=new Vector2D(a.x,a.y),g=new Vector2D(x.x,x.y);for(var w=p.x*p.x,I=p.y*p.y,v=h.x*h.x,P=h.y*h.y,L=l.x*l.x,k=l.y*l.y,b=g.x*g.x,C=g.y*g.y,D=m.x*m.x,R=m.y*m.y,S=u.x*u.x,$=u.y*u.y,B=d.x*d.x,z=d.y*d.y,M=new Polynomial(-2*l.x*l.y*d.x*d.y+L*z+k*B,-2*l.x*l.y*u.x*d.y-2*l.x*l.y*u.y*d.x+2*k*u.x*d.x+2*L*u.y*d.y,-2*l.x*m.x*l.y*d.y-2*l.x*l.y*m.y*d.x-2*l.x*l.y*u.x*u.y+2*m.x*k*d.x+k*S+L*(2*m.y*d.y+$),2*p.x*l.x*l.y*d.y+2*p.y*l.x*l.y*d.x+h.x*h.y*l.x*d.y+h.x*h.y*l.y*d.x-2*g.x*l.x*l.y*d.y-2*l.x*g.y*l.y*d.x-2*l.x*m.x*l.y*u.y-2*l.x*l.y*m.y*u.x-2*p.x*k*d.x-2*p.y*L*d.y+2*g.x*k*d.x+2*m.x*k*u.x-P*l.x*d.x-v*l.y*d.y+L*(2*g.y*d.y+2*m.y*u.y),2*p.x*l.x*l.y*u.y+2*p.y*l.x*l.y*u.x+h.x*h.y*l.x*u.y+h.x*h.y*l.y*u.x-2*g.x*l.x*l.y*u.y-2*l.x*g.y*l.y*u.x-2*l.x*m.x*l.y*m.y-2*p.x*k*u.x-2*p.y*L*u.y+2*g.x*k*u.x-P*l.x*u.x-v*l.y*u.y+D*k+L*(2*g.y*u.y+R),2*p.x*l.x*l.y*m.y+2*p.y*l.x*m.x*l.y+h.x*h.y*l.x*m.y+h.x*h.y*m.x*l.y-2*g.x*l.x*l.y*m.y-2*l.x*g.y*m.x*l.y-2*p.x*m.x*k-2*p.y*L*m.y+2*g.x*m.x*k-P*l.x*m.x-v*l.y*m.y+2*L*g.y*m.y,-2*p.x*p.y*l.x*l.y-p.x*h.x*h.y*l.y-p.y*h.x*h.y*l.x+2*p.x*l.x*g.y*l.y+2*p.y*g.x*l.x*l.y+h.x*g.x*h.y*l.y+h.x*h.y*l.x*g.y-2*g.x*l.x*g.y*l.y-2*p.x*g.x*k+p.x*P*l.x+p.y*v*l.y-2*p.y*L*g.y-g.x*P*l.x-v*g.y*l.y+w*k+I*L+b*k+L*C).getRootsInInterval(0,1),V=0;V<M.length;V++){var _=M[V],A=new Polynomial(l.x,h.x,p.x-g.x-_*m.x-_*_*u.x-_*_*_*d.x).getRoots(),E=new Polynomial(l.y,h.y,p.y-g.y-_*m.y-_*_*u.y-_*_*_*d.y).getRoots();if(A.length>0&&E.length>0){t:for(var N=0;N<A.length;N++){var T=A[N];if(0<=T&&T<=1)for(var F=0;F<E.length;F++)if(Math.abs(T-E[F])<1e-4){f.points.push(d.multiply(_*_*_).add(u.multiply(_*_).add(m.multiply(_).add(g))));break t}}}}return f.points.length>0&&(f.status="Intersection"),f},Intersection.intersectBezier2Circle=function(t,e,y,x,n){return Intersection.intersectBezier2Ellipse(t,e,y,x,n,n)},Intersection.intersectBezier2Ellipse=function(t,e,y,x,n,i){var s,o,r,a,c,l=new Intersection("No Intersection");s=e.multiply(-2),r=t.add(s.add(y)),s=t.multiply(-2),o=e.multiply(2),a=s.add(o),c=new Point2D(t.x,t.y);for(var h=n*n,p=i*i,d=new Polynomial(p*r.x*r.x+h*r.y*r.y,2*(p*r.x*a.x+h*r.y*a.y),p*(2*r.x*c.x+a.x*a.x)+h*(2*r.y*c.y+a.y*a.y)-2*(p*x.x*r.x+h*x.y*r.y),2*(p*a.x*(c.x-x.x)+h*a.y*(c.y-x.y)),p*(c.x*c.x+x.x*x.x)+h*(c.y*c.y+x.y*x.y)-2*(p*x.x*c.x+h*x.y*c.y)-h*p).getRoots(),u=0;u<d.length;u++){var m=d[u];0<=m&&m<=1&&l.points.push(r.multiply(m*m).add(a.multiply(m).add(c)))}return l.points.length>0&&(l.status="Intersection"),l},Intersection.intersectBezier2Line=function(t,e,y,x,n){var i,s,o,r,a,c,l,h=x.min(n),p=x.max(n),d=new Intersection("No Intersection");i=e.multiply(-2),o=t.add(i.add(y)),i=t.multiply(-2),s=e.multiply(2),r=i.add(s),a=new Point2D(t.x,t.y),l=new Vector2D(x.y-n.y,n.x-x.x),c=x.x*n.y-n.x*x.y,roots=new Polynomial(l.dot(o),l.dot(r),l.dot(a)+c).getRoots();for(var u=0;u<roots.length;u++){var m=roots[u];if(0<=m&&m<=1){var g=t.lerp(e,m),f=e.lerp(y,m),w=g.lerp(f,m);x.x==n.x?h.y<=w.y&&w.y<=p.y&&(d.status="Intersection",d.appendPoint(w)):x.y==n.y?h.x<=w.x&&w.x<=p.x&&(d.status="Intersection",d.appendPoint(w)):w.gte(h)&&w.lte(p)&&(d.status="Intersection",d.appendPoint(w))}}return d},Intersection.intersectBezier2Polygon=function(t,e,y,x){for(var n=new Intersection("No Intersection"),i=x.length,s=0;s<i;s++){var o=x[s],r=x[(s+1)%i],a=Intersection.intersectBezier2Line(t,e,y,o,r);n.appendPoints(a.points)}return n.points.length>0&&(n.status="Intersection"),n},Intersection.intersectBezier2Rectangle=function(t,e,y,x,n){var i=x.min(n),s=x.max(n),o=new Point2D(s.x,i.y),r=new Point2D(i.x,s.y),a=Intersection.intersectBezier2Line(t,e,y,i,o),c=Intersection.intersectBezier2Line(t,e,y,o,s),l=Intersection.intersectBezier2Line(t,e,y,s,r),h=Intersection.intersectBezier2Line(t,e,y,r,i),p=new Intersection("No Intersection");return p.appendPoints(a.points),p.appendPoints(c.points),p.appendPoints(l.points),p.appendPoints(h.points),p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectBezier3Bezier3=function(t,e,y,x,n,i,s,o){var r,a,c,l,h,p,d,u,m,g,f,w,I=new Intersection("No Intersection");r=t.multiply(-1),a=e.multiply(3),c=y.multiply(-3),l=r.add(a.add(c.add(x))),h=new Vector2D(l.x,l.y),r=t.multiply(3),a=e.multiply(-6),c=y.multiply(3),l=r.add(a.add(c)),p=new Vector2D(l.x,l.y),r=t.multiply(-3),a=e.multiply(3),c=r.add(a),d=new Vector2D(c.x,c.y),u=new Vector2D(t.x,t.y),r=n.multiply(-1),a=i.multiply(3),c=s.multiply(-3),l=r.add(a.add(c.add(o))),m=new Vector2D(l.x,l.y),r=n.multiply(3),a=i.multiply(-6),c=s.multiply(3),l=r.add(a.add(c)),g=new Vector2D(l.x,l.y),r=n.multiply(-3),a=i.multiply(3),c=r.add(a),f=new Vector2D(c.x,c.y),w=new Vector2D(n.x,n.y);for(var v=u.x*u.x,P=u.x*u.x*u.x,L=u.y*u.y,k=u.y*u.y*u.y,b=d.x*d.x,C=d.x*d.x*d.x,D=d.y*d.y,R=d.y*d.y*d.y,S=p.x*p.x,$=p.x*p.x*p.x,B=p.y*p.y,z=p.y*p.y*p.y,M=h.x*h.x,V=h.x*h.x*h.x,_=h.y*h.y,A=h.y*h.y*h.y,E=w.x*w.x,N=w.x*w.x*w.x,T=w.y*w.y,F=w.y*w.y*w.y,H=f.x*f.x,j=f.x*f.x*f.x,O=f.y*f.y,W=g.x*g.x,G=g.x*g.x*g.x,U=g.y*g.y,q=m.x*m.x,Z=m.x*m.x*m.x,J=m.y*m.y,K=m.y*m.y*m.y,Q=new Polynomial(-V*K+A*Z-3*h.x*_*q*m.y+3*M*h.y*m.x*J,-6*h.x*g.x*_*m.x*m.y+6*M*h.y*g.y*m.x*m.y+3*g.x*A*q-3*V*g.y*J-3*h.x*_*g.y*q+3*M*g.x*h.y*J,-6*f.x*h.x*_*m.x*m.y-6*h.x*g.x*_*g.y*m.x+6*M*g.x*h.y*g.y*m.y+3*f.x*A*q+3*W*A*m.x+3*f.x*M*h.y*J-3*h.x*f.y*_*q-3*h.x*W*_*m.y+M*h.y*m.x*(6*f.y*m.y+3*U)+V*(-f.y*J-2*U*m.y-m.y*(2*f.y*m.y+U)),d.x*p.y*h.x*h.y*m.x*m.y-d.y*p.x*h.x*h.y*m.x*m.y+6*f.x*g.x*A*m.x+3*d.x*p.x*h.x*h.y*J+6*u.x*h.x*_*m.x*m.y-3*d.x*p.x*_*m.x*m.y-3*d.y*p.y*h.x*h.y*q-6*u.y*M*h.y*m.x*m.y-6*w.x*h.x*_*m.x*m.y+3*d.y*p.y*M*m.x*m.y-2*p.x*B*h.x*m.x*m.y-6*f.x*h.x*g.x*_*m.y-6*f.x*h.x*_*g.y*m.x-6*h.x*f.y*g.x*_*m.x+6*f.x*M*h.y*g.y*m.y+2*S*p.y*h.y*m.x*m.y+G*A-3*u.x*A*q+3*u.y*V*J+3*w.x*A*q+z*h.x*q-$*h.y*J-3*u.x*M*h.y*J+3*u.y*h.x*_*q-2*d.x*p.y*M*J+d.x*p.y*_*q-d.y*p.x*M*J+2*d.y*p.x*_*q+3*w.x*M*h.y*J-p.x*B*h.y*q-3*w.y*h.x*_*q+S*p.y*h.x*J-3*h.x*W*_*g.y+M*h.y*m.x*(6*w.y*m.y+6*f.y*g.y)+M*g.x*h.y*(6*f.y*m.y+3*U)+V*(-2*f.y*g.y*m.y-w.y*J-g.y*(2*f.y*m.y+U)-m.y*(2*w.y*m.y+2*f.y*g.y)),6*d.x*p.x*h.x*h.y*g.y*m.y+d.x*p.y*h.x*g.x*h.y*m.y+d.x*p.y*h.x*h.y*g.y*m.x-d.y*p.x*h.x*g.x*h.y*m.y-d.y*p.x*h.x*h.y*g.y*m.x-6*d.y*p.y*h.x*g.x*h.y*m.x-6*u.x*g.x*A*m.x+6*w.x*g.x*A*m.x+6*u.y*V*g.y*m.y+2*z*h.x*g.x*m.x-2*$*h.y*g.y*m.y+6*u.x*h.x*g.x*_*m.y+6*u.x*h.x*_*g.y*m.x+6*u.y*h.x*g.x*_*m.x-3*d.x*p.x*g.x*_*m.y-3*d.x*p.x*_*g.y*m.x+2*d.x*p.y*g.x*_*m.x+4*d.y*p.x*g.x*_*m.x-6*u.x*M*h.y*g.y*m.y-6*u.y*M*g.x*h.y*m.y-6*u.y*M*h.y*g.y*m.x-4*d.x*p.y*M*g.y*m.y-6*w.x*h.x*g.x*_*m.y-6*w.x*h.x*_*g.y*m.x-2*d.y*p.x*M*g.y*m.y+3*d.y*p.y*M*g.x*m.y+3*d.y*p.y*M*g.y*m.x-2*p.x*B*h.x*g.x*m.y-2*p.x*B*h.x*g.y*m.x-2*p.x*B*g.x*h.y*m.x-6*w.y*h.x*g.x*_*m.x-6*f.x*h.x*f.y*_*m.x-6*f.x*h.x*g.x*_*g.y+6*w.x*M*h.y*g.y*m.y+2*S*p.y*h.x*g.y*m.y+2*S*p.y*g.x*h.y*m.y+2*S*p.y*h.y*g.y*m.x+3*f.x*W*A+3*H*A*m.x-3*h.x*f.y*W*_-3*H*h.x*_*m.y+M*g.x*h.y*(6*w.y*m.y+6*f.y*g.y)+M*h.y*m.x*(6*w.y*g.y+3*O)+f.x*M*h.y*(6*f.y*m.y+3*U)+V*(-2*w.y*g.y*m.y-m.y*(2*w.y*g.y+O)-f.y*(2*f.y*m.y+U)-g.y*(2*w.y*m.y+2*f.y*g.y)),d.x*f.x*p.y*h.x*h.y*m.y+d.x*p.y*h.x*f.y*h.y*m.x+d.x*p.y*h.x*g.x*h.y*g.y-d.y*p.x*f.x*h.x*h.y*m.y-d.y*p.x*h.x*f.y*h.y*m.x-d.y*p.x*h.x*g.x*h.y*g.y-6*d.y*f.x*p.y*h.x*h.y*m.x-6*u.x*f.x*A*m.x+6*w.x*f.x*A*m.x+2*f.x*z*h.x*m.x+6*u.x*f.x*h.x*_*m.y+6*u.x*h.x*f.y*_*m.x+6*u.x*h.x*g.x*_*g.y+6*u.y*f.x*h.x*_*m.x-3*d.x*p.x*f.x*_*m.y-3*d.x*p.x*f.y*_*m.x-3*d.x*p.x*g.x*_*g.y+2*d.x*f.x*p.y*_*m.x+4*d.y*p.x*f.x*_*m.x-6*u.y*f.x*M*h.y*m.y-6*u.y*M*f.y*h.y*m.x-6*u.y*M*g.x*h.y*g.y-6*w.x*f.x*h.x*_*m.y-6*w.x*h.x*f.y*_*m.x-6*w.x*h.x*g.x*_*g.y+3*d.y*f.x*p.y*M*m.y-3*d.y*p.y*h.x*W*h.y+3*d.y*p.y*M*f.y*m.x+3*d.y*p.y*M*g.x*g.y-2*p.x*f.x*B*h.x*m.y-2*p.x*f.x*B*h.y*m.x-2*p.x*B*h.x*f.y*m.x-2*p.x*B*h.x*g.x*g.y-6*w.y*f.x*h.x*_*m.x-6*f.x*h.x*f.y*g.x*_+6*w.y*M*f.y*h.y*m.x+2*S*f.x*p.y*h.y*m.y+2*S*p.y*f.y*h.y*m.x+2*S*p.y*g.x*h.y*g.y-3*u.x*W*A+3*w.x*W*A+3*H*g.x*A+z*h.x*W+3*u.y*h.x*W*_+d.x*p.y*W*_+2*d.y*p.x*W*_-p.x*B*W*h.y-3*w.y*h.x*W*_-3*H*h.x*_*g.y+S*p.y*h.x*(2*f.y*m.y+U)+d.x*p.x*h.x*h.y*(6*f.y*m.y+3*U)+f.x*M*h.y*(6*w.y*m.y+6*f.y*g.y)+$*h.y*(-2*f.y*m.y-U)+u.y*V*(6*f.y*m.y+3*U)+d.y*p.x*M*(-2*f.y*m.y-U)+d.x*p.y*M*(-4*f.y*m.y-2*U)+u.x*M*h.y*(-6*f.y*m.y-3*U)+M*g.x*h.y*(6*w.y*g.y+3*O)+w.x*M*h.y*(6*f.y*m.y+3*U)+V*(-2*w.y*f.y*m.y-g.y*(2*w.y*g.y+O)-w.y*(2*f.y*m.y+U)-f.y*(2*w.y*m.y+2*f.y*g.y)),-u.x*d.x*p.y*h.x*h.y*m.y+u.x*d.y*p.x*h.x*h.y*m.y+6*u.x*d.y*p.y*h.x*h.y*m.x-6*u.y*d.x*p.x*h.x*h.y*m.y-u.y*d.x*p.y*h.x*h.y*m.x+u.y*d.y*p.x*h.x*h.y*m.x+d.x*d.y*p.x*p.y*h.x*m.y-d.x*d.y*p.x*p.y*h.y*m.x+d.x*w.x*p.y*h.x*h.y*m.y+d.x*w.y*p.y*h.x*h.y*m.x+d.x*f.x*p.y*h.x*h.y*g.y+d.x*p.y*h.x*f.y*g.x*h.y-w.x*d.y*p.x*h.x*h.y*m.y-6*w.x*d.y*p.y*h.x*h.y*m.x-d.y*p.x*w.y*h.x*h.y*m.x-d.y*p.x*f.x*h.x*h.y*g.y-d.y*p.x*h.x*f.y*g.x*h.y-6*d.y*f.x*p.y*h.x*g.x*h.y-6*u.x*w.x*A*m.x-6*u.x*f.x*g.x*A-2*u.x*z*h.x*m.x+6*w.x*f.x*g.x*A+2*w.x*z*h.x*m.x+2*f.x*z*h.x*g.x+2*u.y*$*h.y*m.y-6*u.x*u.y*h.x*_*m.x+3*u.x*d.x*p.x*_*m.y-2*u.x*d.x*p.y*_*m.x-4*u.x*d.y*p.x*_*m.x+3*u.y*d.x*p.x*_*m.x+6*u.x*u.y*M*h.y*m.y+6*u.x*w.x*h.x*_*m.y-3*u.x*d.y*p.y*M*m.y+2*u.x*p.x*B*h.x*m.y+2*u.x*p.x*B*h.y*m.x+6*u.x*w.y*h.x*_*m.x+6*u.x*f.x*h.x*_*g.y+6*u.x*h.x*f.y*g.x*_+4*u.y*d.x*p.y*M*m.y+6*u.y*w.x*h.x*_*m.x+2*u.y*d.y*p.x*M*m.y-3*u.y*d.y*p.y*M*m.x+2*u.y*p.x*B*h.x*m.x+6*u.y*f.x*h.x*g.x*_-3*d.x*w.x*p.x*_*m.y+2*d.x*w.x*p.y*_*m.x+d.x*d.y*B*h.x*m.x-3*d.x*p.x*w.y*_*m.x-3*d.x*p.x*f.x*_*g.y-3*d.x*p.x*f.y*g.x*_+2*d.x*f.x*p.y*g.x*_+4*w.x*d.y*p.x*_*m.x+4*d.y*p.x*f.x*g.x*_-2*u.x*S*p.y*h.y*m.y-6*u.y*w.x*M*h.y*m.y-6*u.y*w.y*M*h.y*m.x-6*u.y*f.x*M*h.y*g.y-2*u.y*S*p.y*h.x*m.y-2*u.y*S*p.y*h.y*m.x-6*u.y*M*f.y*g.x*h.y-d.x*d.y*S*h.y*m.y-2*d.x*D*h.x*h.y*m.x+3*w.x*d.y*p.y*M*m.y-2*w.x*p.x*B*h.x*m.y-2*w.x*p.x*B*h.y*m.x-6*w.x*w.y*h.x*_*m.x-6*w.x*f.x*h.x*_*g.y-6*w.x*h.x*f.y*g.x*_+3*d.y*w.y*p.y*M*m.x+3*d.y*f.x*p.y*M*g.y+3*d.y*p.y*M*f.y*g.x-2*p.x*w.y*B*h.x*m.x-2*p.x*f.x*B*h.x*g.y-2*p.x*f.x*B*g.x*h.y-2*p.x*B*h.x*f.y*g.x-6*w.y*f.x*h.x*g.x*_-D*p.x*p.y*h.x*m.x+2*w.x*S*p.y*h.y*m.y+6*w.y*M*f.y*g.x*h.y+2*b*d.y*h.x*h.y*m.y+b*p.x*p.y*h.y*m.y+2*S*w.y*p.y*h.y*m.x+2*S*f.x*p.y*h.y*g.y+2*S*p.y*f.y*g.x*h.y+j*A+3*v*A*m.x-3*L*V*m.y+3*E*A*m.x+R*M*m.x-C*_*m.y-d.x*D*M*m.y+b*d.y*_*m.x-3*v*h.x*_*m.y+3*L*M*h.y*m.x-b*B*h.x*m.y+D*S*h.y*m.x-3*H*h.x*f.y*_-3*E*h.x*_*m.y+3*T*M*h.y*m.x+d.x*p.x*h.x*h.y*(6*w.y*m.y+6*f.y*g.y)+$*h.y*(-2*w.y*m.y-2*f.y*g.y)+u.y*V*(6*w.y*m.y+6*f.y*g.y)+d.y*p.x*M*(-2*w.y*m.y-2*f.y*g.y)+S*p.y*h.x*(2*w.y*m.y+2*f.y*g.y)+d.x*p.y*M*(-4*w.y*m.y-4*f.y*g.y)+u.x*M*h.y*(-6*w.y*m.y-6*f.y*g.y)+w.x*M*h.y*(6*w.y*m.y+6*f.y*g.y)+f.x*M*h.y*(6*w.y*g.y+3*O)+V*(-2*w.y*f.y*g.y-T*m.y-f.y*(2*w.y*g.y+O)-w.y*(2*w.y*m.y+2*f.y*g.y)),-u.x*d.x*p.y*h.x*h.y*g.y+u.x*d.y*p.x*h.x*h.y*g.y+6*u.x*d.y*p.y*h.x*g.x*h.y-6*u.y*d.x*p.x*h.x*h.y*g.y-u.y*d.x*p.y*h.x*g.x*h.y+u.y*d.y*p.x*h.x*g.x*h.y+d.x*d.y*p.x*p.y*h.x*g.y-d.x*d.y*p.x*p.y*g.x*h.y+d.x*w.x*p.y*h.x*h.y*g.y+d.x*w.y*p.y*h.x*g.x*h.y+d.x*f.x*p.y*h.x*f.y*h.y-w.x*d.y*p.x*h.x*h.y*g.y-6*w.x*d.y*p.y*h.x*g.x*h.y-d.y*p.x*w.y*h.x*g.x*h.y-d.y*p.x*f.x*h.x*f.y*h.y-6*u.x*w.x*g.x*A-2*u.x*z*h.x*g.x+2*w.x*z*h.x*g.x+2*u.y*$*h.y*g.y-6*u.x*u.y*h.x*g.x*_+3*u.x*d.x*p.x*_*g.y-2*u.x*d.x*p.y*g.x*_-4*u.x*d.y*p.x*g.x*_+3*u.y*d.x*p.x*g.x*_+6*u.x*u.y*M*h.y*g.y+6*u.x*w.x*h.x*_*g.y-3*u.x*d.y*p.y*M*g.y+2*u.x*p.x*B*h.x*g.y+2*u.x*p.x*B*g.x*h.y+6*u.x*w.y*h.x*g.x*_+6*u.x*f.x*h.x*f.y*_+4*u.y*d.x*p.y*M*g.y+6*u.y*w.x*h.x*g.x*_+2*u.y*d.y*p.x*M*g.y-3*u.y*d.y*p.y*M*g.x+2*u.y*p.x*B*h.x*g.x-3*d.x*w.x*p.x*_*g.y+2*d.x*w.x*p.y*g.x*_+d.x*d.y*B*h.x*g.x-3*d.x*p.x*w.y*g.x*_-3*d.x*p.x*f.x*f.y*_+4*w.x*d.y*p.x*g.x*_-2*u.x*S*p.y*h.y*g.y-6*u.y*w.x*M*h.y*g.y-6*u.y*w.y*M*g.x*h.y-6*u.y*f.x*M*f.y*h.y-2*u.y*S*p.y*h.x*g.y-2*u.y*S*p.y*g.x*h.y-d.x*d.y*S*h.y*g.y-2*d.x*D*h.x*g.x*h.y+3*w.x*d.y*p.y*M*g.y-2*w.x*p.x*B*h.x*g.y-2*w.x*p.x*B*g.x*h.y-6*w.x*w.y*h.x*g.x*_-6*w.x*f.x*h.x*f.y*_+3*d.y*w.y*p.y*M*g.x+3*d.y*f.x*p.y*M*f.y-2*p.x*w.y*B*h.x*g.x-2*p.x*f.x*B*h.x*f.y-D*p.x*p.y*h.x*g.x+2*w.x*S*p.y*h.y*g.y-3*d.y*H*p.y*h.x*h.y+6*w.y*f.x*M*f.y*h.y+2*b*d.y*h.x*h.y*g.y+b*p.x*p.y*h.y*g.y+2*S*w.y*p.y*g.x*h.y+2*S*f.x*p.y*f.y*h.y-3*u.x*H*A+3*w.x*H*A+3*v*g.x*A-3*L*V*g.y+3*E*g.x*A+H*z*h.x+R*M*g.x-C*_*g.y+3*u.y*H*h.x*_-d.x*D*M*g.y+d.x*H*p.y*_+2*d.y*p.x*H*_+b*d.y*g.x*_-p.x*H*B*h.y-3*w.y*H*h.x*_-3*v*h.x*_*g.y+3*L*M*g.x*h.y-b*B*h.x*g.y+D*S*g.x*h.y-3*E*h.x*_*g.y+3*T*M*g.x*h.y+S*p.y*h.x*(2*w.y*g.y+O)+d.x*p.x*h.x*h.y*(6*w.y*g.y+3*O)+$*h.y*(-2*w.y*g.y-O)+u.y*V*(6*w.y*g.y+3*O)+d.y*p.x*M*(-2*w.y*g.y-O)+d.x*p.y*M*(-4*w.y*g.y-2*O)+u.x*M*h.y*(-6*w.y*g.y-3*O)+w.x*M*h.y*(6*w.y*g.y+3*O)+V*(-2*w.y*O-T*g.y-w.y*(2*w.y*g.y+O)),-u.x*d.x*p.y*h.x*f.y*h.y+u.x*d.y*p.x*h.x*f.y*h.y+6*u.x*d.y*f.x*p.y*h.x*h.y-6*u.y*d.x*p.x*h.x*f.y*h.y-u.y*d.x*f.x*p.y*h.x*h.y+u.y*d.y*p.x*f.x*h.x*h.y-d.x*d.y*p.x*f.x*p.y*h.y+d.x*d.y*p.x*p.y*h.x*f.y+d.x*w.x*p.y*h.x*f.y*h.y+6*d.x*p.x*w.y*h.x*f.y*h.y+d.x*w.y*f.x*p.y*h.x*h.y-w.x*d.y*p.x*h.x*f.y*h.y-6*w.x*d.y*f.x*p.y*h.x*h.y-d.y*p.x*w.y*f.x*h.x*h.y-6*u.x*w.x*f.x*A-2*u.x*f.x*z*h.x+6*u.y*w.y*V*f.y+2*w.x*f.x*z*h.x+2*u.y*$*f.y*h.y-2*$*w.y*f.y*h.y-6*u.x*u.y*f.x*h.x*_+3*u.x*d.x*p.x*f.y*_-2*u.x*d.x*f.x*p.y*_-4*u.x*d.y*p.x*f.x*_+3*u.y*d.x*p.x*f.x*_+6*u.x*u.y*M*f.y*h.y+6*u.x*w.x*h.x*f.y*_-3*u.x*d.y*p.y*M*f.y+2*u.x*p.x*f.x*B*h.y+2*u.x*p.x*B*h.x*f.y+6*u.x*w.y*f.x*h.x*_+4*u.y*d.x*p.y*M*f.y+6*u.y*w.x*f.x*h.x*_+2*u.y*d.y*p.x*M*f.y-3*u.y*d.y*f.x*p.y*M+2*u.y*p.x*f.x*B*h.x-3*d.x*w.x*p.x*f.y*_+2*d.x*w.x*f.x*p.y*_+d.x*d.y*f.x*B*h.x-3*d.x*p.x*w.y*f.x*_+4*w.x*d.y*p.x*f.x*_-6*u.x*w.y*M*f.y*h.y-2*u.x*S*p.y*f.y*h.y-6*u.y*w.x*M*f.y*h.y-6*u.y*w.y*f.x*M*h.y-2*u.y*S*f.x*p.y*h.y-2*u.y*S*p.y*h.x*f.y-d.x*d.y*S*f.y*h.y-4*d.x*w.y*p.y*M*f.y-2*d.x*D*f.x*h.x*h.y+3*w.x*d.y*p.y*M*f.y-2*w.x*p.x*f.x*B*h.y-2*w.x*p.x*B*h.x*f.y-6*w.x*w.y*f.x*h.x*_-2*d.y*p.x*w.y*M*f.y+3*d.y*w.y*f.x*p.y*M-2*p.x*w.y*f.x*B*h.x-D*p.x*f.x*p.y*h.x+6*w.x*w.y*M*f.y*h.y+2*w.x*S*p.y*f.y*h.y+2*b*d.y*h.x*f.y*h.y+b*p.x*p.y*f.y*h.y+2*S*w.y*f.x*p.y*h.y+2*S*w.y*p.y*h.x*f.y+3*v*f.x*A-3*L*V*f.y+3*E*f.x*A+R*f.x*M-C*f.y*_-3*T*V*f.y-d.x*D*M*f.y+b*d.y*f.x*_-3*v*h.x*f.y*_+3*L*f.x*M*h.y-b*B*h.x*f.y+D*S*f.x*h.y-3*E*h.x*f.y*_+3*T*f.x*M*h.y,u.x*u.y*d.x*p.y*h.x*h.y-u.x*u.y*d.y*p.x*h.x*h.y+u.x*d.x*d.y*p.x*p.y*h.y-u.y*d.x*d.y*p.x*p.y*h.x-u.x*d.x*w.y*p.y*h.x*h.y+6*u.x*w.x*d.y*p.y*h.x*h.y+u.x*d.y*p.x*w.y*h.x*h.y-u.y*d.x*w.x*p.y*h.x*h.y-6*u.y*d.x*p.x*w.y*h.x*h.y+u.y*w.x*d.y*p.x*h.x*h.y-d.x*w.x*d.y*p.x*p.y*h.y+d.x*d.y*p.x*w.y*p.y*h.x+d.x*w.x*w.y*p.y*h.x*h.y-w.x*d.y*p.x*w.y*h.x*h.y-2*u.x*w.x*z*h.x+2*u.y*$*w.y*h.y-3*u.x*u.y*d.x*p.x*_-6*u.x*u.y*w.x*h.x*_+3*u.x*u.y*d.y*p.y*M-2*u.x*u.y*p.x*B*h.x-2*u.x*d.x*w.x*p.y*_-u.x*d.x*d.y*B*h.x+3*u.x*d.x*p.x*w.y*_-4*u.x*w.x*d.y*p.x*_+3*u.y*d.x*w.x*p.x*_+6*u.x*u.y*w.y*M*h.y+2*u.x*u.y*S*p.y*h.y+2*u.x*d.x*D*h.x*h.y+2*u.x*w.x*p.x*B*h.y+6*u.x*w.x*w.y*h.x*_-3*u.x*d.y*w.y*p.y*M+2*u.x*p.x*w.y*B*h.x+u.x*D*p.x*p.y*h.x+u.y*d.x*d.y*S*h.y+4*u.y*d.x*w.y*p.y*M-3*u.y*w.x*d.y*p.y*M+2*u.y*w.x*p.x*B*h.x+2*u.y*d.y*p.x*w.y*M+d.x*w.x*d.y*B*h.x-3*d.x*w.x*p.x*w.y*_-2*u.x*S*w.y*p.y*h.y-6*u.y*w.x*w.y*M*h.y-2*u.y*w.x*S*p.y*h.y-2*u.y*b*d.y*h.x*h.y-u.y*b*p.x*p.y*h.y-2*u.y*S*w.y*p.y*h.x-2*d.x*w.x*D*h.x*h.y-d.x*d.y*S*w.y*h.y+3*w.x*d.y*w.y*p.y*M-2*w.x*p.x*w.y*B*h.x-w.x*D*p.x*p.y*h.x+3*L*d.x*p.x*h.x*h.y+3*d.x*p.x*T*h.x*h.y+2*w.x*S*w.y*p.y*h.y-3*v*d.y*p.y*h.x*h.y+2*b*d.y*w.y*h.x*h.y+b*p.x*w.y*p.y*h.y-3*E*d.y*p.y*h.x*h.y-P*A+k*V+N*A-F*V-3*u.x*E*A-u.x*R*M+3*v*w.x*A+u.y*C*_+3*u.y*T*V+w.x*R*M+v*z*h.x-3*L*w.y*V-L*$*h.y+E*z*h.x-C*w.y*_-$*T*h.y-u.x*b*d.y*_+u.y*d.x*D*M-3*u.x*L*M*h.y-u.x*D*S*h.y+u.y*b*B*h.x-d.x*D*w.y*M+3*v*u.y*h.x*_+v*d.x*p.y*_+2*v*d.y*p.x*_-2*L*d.x*p.y*M-L*d.y*p.x*M+b*w.x*d.y*_-3*u.x*T*M*h.y+3*u.y*E*h.x*_+d.x*E*p.y*_-2*d.x*T*p.y*M+w.x*D*S*h.y-d.y*p.x*T*M-v*p.x*B*h.y-3*v*w.y*h.x*_+3*L*w.x*M*h.y+L*S*p.y*h.x-b*w.y*B*h.x+2*E*d.y*p.x*_+3*w.x*T*M*h.y-E*p.x*B*h.y-3*E*w.y*h.x*_+S*T*p.y*h.x).getRootsInInterval(0,1),X=0;X<Q.length;X++){var Y=Q[X],tt=new Polynomial(h.x,p.x,d.x,u.x-w.x-Y*f.x-Y*Y*g.x-Y*Y*Y*m.x).getRoots(),et=new Polynomial(h.y,p.y,d.y,u.y-w.y-Y*f.y-Y*Y*g.y-Y*Y*Y*m.y).getRoots();if(tt.length>0&&et.length>0){t:for(var yt=0;yt<tt.length;yt++){var xt=tt[yt];if(0<=xt&&xt<=1)for(var nt=0;nt<et.length;nt++)if(Math.abs(xt-et[nt])<1e-4){I.points.push(m.multiply(Y*Y*Y).add(g.multiply(Y*Y).add(f.multiply(Y).add(w))));break t}}}}return I.points.length>0&&(I.status="Intersection"),I},Intersection.intersectBezier3Circle=function(t,e,y,x,n,i){return Intersection.intersectBezier3Ellipse(t,e,y,x,n,i,i)},Intersection.intersectBezier3Ellipse=function(t,e,y,x,n,i,s){var o,r,a,c,l,h,p,d,u=new Intersection("No Intersection");o=t.multiply(-1),r=e.multiply(3),a=y.multiply(-3),c=o.add(r.add(a.add(x))),l=new Vector2D(c.x,c.y),o=t.multiply(3),r=e.multiply(-6),a=y.multiply(3),c=o.add(r.add(a)),h=new Vector2D(c.x,c.y),o=t.multiply(-3),r=e.multiply(3),a=o.add(r),p=new Vector2D(a.x,a.y),d=new Vector2D(t.x,t.y);for(var m=i*i,g=s*s,f=new Polynomial(l.x*l.x*g+l.y*l.y*m,2*(l.x*h.x*g+l.y*h.y*m),2*(l.x*p.x*g+l.y*p.y*m)+h.x*h.x*g+h.y*h.y*m,2*l.x*g*(d.x-n.x)+2*l.y*m*(d.y-n.y)+2*(h.x*p.x*g+h.y*p.y*m),2*h.x*g*(d.x-n.x)+2*h.y*m*(d.y-n.y)+p.x*p.x*g+p.y*p.y*m,2*p.x*g*(d.x-n.x)+2*p.y*m*(d.y-n.y),d.x*d.x*g-2*d.y*n.y*m-2*d.x*n.x*g+d.y*d.y*m+n.x*n.x*g+n.y*n.y*m-m*g).getRootsInInterval(0,1),w=0;w<f.length;w++){var I=f[w];u.points.push(l.multiply(I*I*I).add(h.multiply(I*I).add(p.multiply(I).add(d))))}return u.points.length>0&&(u.status="Intersection"),u},Intersection.intersectBezier3Line=function(t,e,y,x,n,i){var s,o,r,a,c,l,h,p,d,u,m=n.min(i),g=n.max(i),f=new Intersection("No Intersection");s=t.multiply(-1),o=e.multiply(3),r=y.multiply(-3),a=s.add(o.add(r.add(x))),c=new Vector2D(a.x,a.y),s=t.multiply(3),o=e.multiply(-6),r=y.multiply(3),a=s.add(o.add(r)),l=new Vector2D(a.x,a.y),s=t.multiply(-3),o=e.multiply(3),r=s.add(o),h=new Vector2D(r.x,r.y),p=new Vector2D(t.x,t.y),u=new Vector2D(n.y-i.y,i.x-n.x),d=n.x*i.y-i.x*n.y,roots=new Polynomial(u.dot(c),u.dot(l),u.dot(h),u.dot(p)+d).getRoots();for(var w=0;w<roots.length;w++){var I=roots[w];if(0<=I&&I<=1){var v=t.lerp(e,I),P=e.lerp(y,I),L=y.lerp(x,I),k=v.lerp(P,I),b=P.lerp(L,I),C=k.lerp(b,I);n.x==i.x?m.y<=C.y&&C.y<=g.y&&(f.status="Intersection",f.appendPoint(C)):n.y==i.y?m.x<=C.x&&C.x<=g.x&&(f.status="Intersection",f.appendPoint(C)):C.gte(m)&&C.lte(g)&&(f.status="Intersection",f.appendPoint(C))}}return f},Intersection.intersectBezier3Polygon=function(t,e,y,x,n){for(var i=new Intersection("No Intersection"),s=n.length,o=0;o<s;o++){var r=n[o],a=n[(o+1)%s],c=Intersection.intersectBezier3Line(t,e,y,x,r,a);i.appendPoints(c.points)}return i.points.length>0&&(i.status="Intersection"),i},Intersection.intersectBezier3Rectangle=function(t,e,y,x,n,i){var s=n.min(i),o=n.max(i),r=new Point2D(o.x,s.y),a=new Point2D(s.x,o.y),c=Intersection.intersectBezier3Line(t,e,y,x,s,r),l=Intersection.intersectBezier3Line(t,e,y,x,r,o),h=Intersection.intersectBezier3Line(t,e,y,x,o,a),p=Intersection.intersectBezier3Line(t,e,y,x,a,s),d=new Intersection("No Intersection");return d.appendPoints(c.points),d.appendPoints(l.points),d.appendPoints(h.points),d.appendPoints(p.points),d.points.length>0&&(d.status="Intersection"),d},Intersection.intersectCircleCircle=function(t,e,y,x){var n,i=e+x,s=Math.abs(e-x),o=t.distanceFrom(y);if(o>i)n=new Intersection("Outside");else if(o<s)n=new Intersection("Inside");else{n=new Intersection("Intersection");var r=(e*e-x*x+o*o)/(2*o),a=Math.sqrt(e*e-r*r),c=t.lerp(y,r/o),l=a/o;n.points.push(new Point2D(c.x-l*(y.y-t.y),c.y+l*(y.x-t.x))),n.points.push(new Point2D(c.x+l*(y.y-t.y),c.y-l*(y.x-t.x)))}return n},Intersection.intersectCircleEllipse=function(t,e,y,x,n){return Intersection.intersectEllipseEllipse(t,e,e,y,x,n)},Intersection.intersectCircleLine=function(t,e,y,x){var n,i=(x.x-y.x)*(x.x-y.x)+(x.y-y.y)*(x.y-y.y),s=2*((x.x-y.x)*(y.x-t.x)+(x.y-y.y)*(y.y-t.y)),o=s*s-4*i*(t.x*t.x+t.y*t.y+y.x*y.x+y.y*y.y-2*(t.x*y.x+t.y*y.y)-e*e);if(o<0)n=new Intersection("Outside");else if(0==o)n=new Intersection("Tangent");else{var r=Math.sqrt(o),a=(-s+r)/(2*i),c=(-s-r)/(2*i);(a<0||a>1)&&(c<0||c>1)?n=new Intersection(a<0&&c<0||a>1&&c>1?"Outside":"Inside"):(n=new Intersection("Intersection"),0<=a&&a<=1&&n.points.push(y.lerp(x,a)),0<=c&&c<=1&&n.points.push(y.lerp(x,c)))}return n},Intersection.intersectCirclePolygon=function(t,e,y){for(var x,n=new Intersection("No Intersection"),i=y.length,s=0;s<i;s++){var o=y[s],r=y[(s+1)%i];x=Intersection.intersectCircleLine(t,e,o,r),n.appendPoints(x.points)}return n.points.length>0?n.status="Intersection":n.status=x.status,n},Intersection.intersectCircleRectangle=function(t,e,y,x){var n=y.min(x),i=y.max(x),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectCircleLine(t,e,n,s),a=Intersection.intersectCircleLine(t,e,s,i),c=Intersection.intersectCircleLine(t,e,i,o),l=Intersection.intersectCircleLine(t,e,o,n),h=new Intersection("No Intersection");return h.appendPoints(r.points),h.appendPoints(a.points),h.appendPoints(c.points),h.appendPoints(l.points),h.points.length>0?h.status="Intersection":h.status=r.status,h},Intersection.intersectEllipseEllipse=function(t,e,y,x,n,i){for(var s=[y*y,0,e*e,-2*y*y*t.x,-2*e*e*t.y,y*y*t.x*t.x+e*e*t.y*t.y-e*e*y*y],o=[i*i,0,n*n,-2*i*i*x.x,-2*n*n*x.y,i*i*x.x*x.x+n*n*x.y*x.y-n*n*i*i],r=Intersection.bezout(s,o).getRoots(),a=.001*(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2]),c=.001*(o[0]*o[0]+2*o[1]*o[1]+o[2]*o[2]),l=new Intersection("No Intersection"),h=0;h<r.length;h++)for(var p=new Polynomial(s[0],s[3]+r[h]*s[1],s[5]+r[h]*(s[4]+r[h]*s[2])).getRoots(),d=0;d<p.length;d++){var u=(s[0]*p[d]+s[1]*r[h]+s[3])*p[d]+(s[2]*r[h]+s[4])*r[h]+s[5];Math.abs(u)<a&&(u=(o[0]*p[d]+o[1]*r[h]+o[3])*p[d]+(o[2]*r[h]+o[4])*r[h]+o[5],Math.abs(u)<c&&l.appendPoint(new Point2D(p[d],r[h])))}return l.points.length>0&&(l.status="Intersection"),l},Intersection.intersectEllipseLine=function(t,e,y,x,n){var i,s=new Vector2D(x.x,x.y),o=Vector2D.fromPoints(x,n),r=new Vector2D(t.x,t.y),a=s.subtract(r),c=new Vector2D(o.x/(e*e),o.y/(y*y)),l=new Vector2D(a.x/(e*e),a.y/(y*y)),h=o.dot(c),p=o.dot(l),d=p*p-h*(t=a.dot(l)-1);if(d<0)i=new Intersection("Outside");else if(d>0){var u=Math.sqrt(d),m=(-p-u)/h,g=(-p+u)/h;(m<0||1<m)&&(g<0||1<g)?i=new Intersection(m<0&&g<0||m>1&&g>1?"Outside":"Inside"):(i=new Intersection("Intersection"),0<=m&&m<=1&&i.appendPoint(x.lerp(n,m)),0<=g&&g<=1&&i.appendPoint(x.lerp(n,g)))}else{var f=-p/h;0<=f&&f<=1?(i=new Intersection("Intersection")).appendPoint(x.lerp(n,f)):i=new Intersection("Outside")}return i},Intersection.intersectEllipsePolygon=function(t,e,y,x){for(var n=new Intersection("No Intersection"),i=x.length,s=0;s<i;s++){var o=x[s],r=x[(s+1)%i],a=Intersection.intersectEllipseLine(t,e,y,o,r);n.appendPoints(a.points)}return n.points.length>0&&(n.status="Intersection"),n},Intersection.intersectEllipseRectangle=function(t,e,y,x,n){var i=x.min(n),s=x.max(n),o=new Point2D(s.x,i.y),r=new Point2D(i.x,s.y),a=Intersection.intersectEllipseLine(t,e,y,i,o),c=Intersection.intersectEllipseLine(t,e,y,o,s),l=Intersection.intersectEllipseLine(t,e,y,s,r),h=Intersection.intersectEllipseLine(t,e,y,r,i),p=new Intersection("No Intersection");return p.appendPoints(a.points),p.appendPoints(c.points),p.appendPoints(l.points),p.appendPoints(h.points),p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectLineLine=function(t,e,y,x){var n,i=(x.x-y.x)*(t.y-y.y)-(x.y-y.y)*(t.x-y.x),s=(e.x-t.x)*(t.y-y.y)-(e.y-t.y)*(t.x-y.x),o=(x.y-y.y)*(e.x-t.x)-(x.x-y.x)*(e.y-t.y);if(0!=o){var r=i/o,a=s/o;0<=r&&r<=1&&0<=a&&a<=1?(n=new Intersection("Intersection")).points.push(new Point2D(t.x+r*(e.x-t.x),t.y+r*(e.y-t.y))):n=new Intersection("No Intersection")}else n=new Intersection(0==i||0==s?"Coincident":"Parallel");return n},Intersection.intersectLinePolygon=function(t,e,y){for(var x=new Intersection("No Intersection"),n=y.length,i=0;i<n;i++){var s=y[i],o=y[(i+1)%n],r=Intersection.intersectLineLine(t,e,s,o);x.appendPoints(r.points)}return x.points.length>0&&(x.status="Intersection"),x},Intersection.intersectLineRectangle=function(t,e,y,x){var n=y.min(x),i=y.max(x),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectLineLine(n,s,t,e),a=Intersection.intersectLineLine(s,i,t,e),c=Intersection.intersectLineLine(i,o,t,e),l=Intersection.intersectLineLine(o,n,t,e),h=new Intersection("No Intersection");return h.appendPoints(r.points),h.appendPoints(a.points),h.appendPoints(c.points),h.appendPoints(l.points),h.points.length>0&&(h.status="Intersection"),h},Intersection.intersectPolygonPolygon=function(t,e){for(var y=new Intersection("No Intersection"),x=t.length,n=0;n<x;n++){var i=t[n],s=t[(n+1)%x],o=Intersection.intersectLinePolygon(i,s,e);y.appendPoints(o.points)}return y.points.length>0&&(y.status="Intersection"),y},Intersection.intersectPolygonRectangle=function(t,e,y){var x=e.min(y),n=e.max(y),i=new Point2D(n.x,x.y),s=new Point2D(x.x,n.y),o=Intersection.intersectLinePolygon(x,i,t),r=Intersection.intersectLinePolygon(i,n,t),a=Intersection.intersectLinePolygon(n,s,t),c=Intersection.intersectLinePolygon(s,x,t),l=new Intersection("No Intersection");return l.appendPoints(o.points),l.appendPoints(r.points),l.appendPoints(a.points),l.appendPoints(c.points),l.points.length>0&&(l.status="Intersection"),l},Intersection.intersectRayRay=function(t,e,y,x){var n,i=(x.x-y.x)*(t.y-y.y)-(x.y-y.y)*(t.x-y.x),s=(e.x-t.x)*(t.y-y.y)-(e.y-t.y)*(t.x-y.x),o=(x.y-y.y)*(e.x-t.x)-(x.x-y.x)*(e.y-t.y);if(0!=o){var r=i/o;(n=new Intersection("Intersection")).points.push(new Point2D(t.x+r*(e.x-t.x),t.y+r*(e.y-t.y)))}else n=new Intersection(0==i||0==s?"Coincident":"Parallel");return n},Intersection.intersectRectangleRectangle=function(t,e,y,x){var n=t.min(e),i=t.max(e),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectLineRectangle(n,s,y,x),a=Intersection.intersectLineRectangle(s,i,y,x),c=Intersection.intersectLineRectangle(i,o,y,x),l=Intersection.intersectLineRectangle(o,n,y,x),h=new Intersection("No Intersection");return h.appendPoints(r.points),h.appendPoints(a.points),h.appendPoints(c.points),h.appendPoints(l.points),h.points.length>0&&(h.status="Intersection"),h},Intersection.bezout=function(t,e){var y=t[0]*e[1]-e[0]*t[1],x=t[0]*e[2]-e[0]*t[2],n=t[0]*e[3]-e[0]*t[3],i=t[0]*e[4]-e[0]*t[4],s=t[0]*e[5]-e[0]*t[5],o=t[1]*e[2]-e[1]*t[2],r=t[1]*e[4]-e[1]*t[4],a=t[1]*e[5]-e[1]*t[5],c=t[2]*e[3]-e[2]*t[3],l=t[3]*e[4]-e[3]*t[4],h=t[3]*e[5]-e[3]*t[5],p=a+l,d=r-c;return new Polynomial(y*o-x*x,y*d+n*o-2*x*i,y*p+n*d-i*i-2*x*s,y*h+n*p-2*i*s,n*h-s*s)},$(window).resize(function(){xLimit=resetWindowLimit("x"),yLimit=resetWindowLimit("y")}),lifeCnt>0&&(document.onkeydown=function(t){switch($("#spaceship").css("opacity","1"),t.keyCode){case 68:turn=2;break;case 65:turn=-2;break;case 87:thrust=1;break;case 83:thrust=-1;break;case 32:pewpew(),resetGun=!1;break;case 13:hyperspace();break;case 8:case 46:boom()}},document.onkeyup=function(t){switch(t.keyCode){case 65:case 68:turn=0;break;case 87:case 83:thrust=0;break;case 32:resetGun=!0}},$(document).on("touchstart"," .gameBtn",function(t){$("#spaceship").css("opacity","1");var e=t.target.id;switch(console.log(e),e){case"btnLeft":turn=-1;break;case"btnRight":turn=1;break;case"btnUp":thrust=1;break;case"btnDown":thrust=-1;break;case"btnShoot":pewpew();break;case"btnHS":hyperspace()}}),$(document).on("touchend",".gameBtn",function(t){switch(t.target.id){case"btnLeft":case"btnRight":turn=0;break;case"btnUp":case"btnDown":thrust=0;break;case"glyphLeft":turn=0;break;case"btnShoot":resetGun=!0}}));