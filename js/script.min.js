var asteroids=[],shots=[],shotCnt=0,spaceship=new Spaceship(xLimit/2,yLimit/2,0,0,0,0,0,0),colors=["#edc951","#eb6841","#cc2a36","#4f372d","#00a0b0"],rocksLrg=["26.087899,1.0434852 49.503787,26.009091 74.220561,2.6541843 96.335572,25.203747 85.278067,50.974686 98.286898,75.940275 62.512619,99.295186 26.087905,100.10053 0.7206885,77.55096 1.3711312,27.619771","27.46638,2.6445482 66.467442,0.98983643 99.048213,24.999426 V 35.822504 L 65.202598,51.325844 98.421452,73.55696 76.484471,97.835645 H 72.723845 L 60.501821,85.842551 27.596351,98.713169 0.95859607,63.02645 1.8987487,25.29194 H 36.997914","14.670645,48.844427 1.9670478,25.614646 27.37424,2.3848478 48.335078,12.875719 73.107033,1.6354928 97.878992,24.865291 75.012591,39.102909 97.878992,60.834007 75.012591,97.552066 39.442599,87.061197 26.739004,99.050766 1.3318868,75.820971"],xLimit=resetWindowLimit("x")-1,yLimit=resetWindowLimit("y")-1,lifeCnt=3,jumpCnt=3,score=0,inPlay=!1,mode="asteroids",rockCnt=10,delta_time=20,turn=0,thrust=0,turn_per_milli=.1,thrust_per_milli=15e-5,key_delay=50,del_v=0,del_vx=0,del_vy=0;function animateScreen(y,t){var e=y;t=t;for(var x in console.log("inplay",inPlay),$("#scoreCnt span").html(score),e){if(e.hasOwnProperty(x))e[x].changePosition(e[x].x+e[x].xv,e[x].y+e[x].yv),"asteroids"==mode&&((e[x].x<=0-e[x].width||e[x].x>=xLimit+e[x].width)&&(e[x].x>=xLimit+e[x].width?e[x].x=-Math.abs(0-e[x].width):e[x].x=xLimit+e[x].width),(e[x].y<=0-e[x].width||e[x].y>=yLimit+e[x].height)&&(e[x].y>=yLimit+e[x].height?e[x].y=-Math.abs(0-e[x].height):e[x].y=yLimit+e[x].height)),1==inPlay&&inCollision(e[x])&&boom();for(var n in t)t[n].changePosition(t[n].x+10*t[n].vx,t[n].y+10*t[n].vy),console.log(n,t[n].vx,t[n].vy),$("#shot"+t[n].id).css("left",t[n].x).css("top",t[n].y);$("#rockAnim"+e[x].id).css("left",e[x].x).css("top",e[x].y)}!function(y){var t=Math.PI/180;0!=turn&&void 0!=turn?(spaceship.theta=spaceship.theta+turn*turn_per_milli*y,lifeCnt>0&&$("#sndTurn").get(0).play()):($("#sndTurn").get(0).pause(),$("#sndTurn").get(0).currentTime=0),0!=thrust&&void 0!=thrust?(del_vx=(del_v=thrust*thrust_per_milli*y)*Math.cos(spaceship.theta*t),del_vy=del_v*Math.sin(spaceship.theta*t),lifeCnt>0&&$("#sndPlayer").get(0).play()):(del_vx=0,del_vy=0,$("#sndPlayer").get(0).pause(),$("#sndPlayer").get(0).currentTime=0),spaceship.vx=spaceship.vx+del_vx,spaceship.vy=spaceship.vy+del_vy}(delta_time),function(y){spaceship.x>=xLimit&&(spaceship.x=0),spaceship.x<0&&(spaceship.x=xLimit),spaceship.y>=yLimit&&(spaceship.y=0),spaceship.y<0&&(spaceship.y=yLimit),spaceship.theta+=spaceship.yaw*y,spaceship.x+=spaceship.vx*y,spaceship.y+=spaceship.vy*y,$("#spaceship").css("left",spaceship.x).css("top",spaceship.y).css({transform:"rotate("+spaceship.theta+"deg)"})}(delta_time)}function inCollision(y){var t=y,e=spaceship;return!(e.y+e.height<t.y||e.y>t.y+t.height||e.x+e.width<t.x||e.x>t.x+t.width)}function boom(){$("#spaceship").hide(),inPlay=!1,$("#sndBoom").get(0).play(),lifeCnt>0&&(lifeCnt--,$("#lifeCnt span").html(lifeCnt),jumpCnt=3,$("#HSCnt span").html(jumpCnt),setTimeout(function(){resetSpaceship()},3e3))}function resetSpaceship(){lifeCnt>0?($("#spaceship").show(),spaceship=new Spaceship(xLimit/2,yLimit/2,0,0,0,0,0,0),inPlay=!0):(inPlay=!1,$("#spaceship").hide(),$("#gameOverBoard").css("display","block"))}function hyperspace(){lifeCnt>0&&(jumpCnt>0?($("#sndHyperspace").get(0).currentTime=0,$("#sndHyperspace").get(0).play(),spaceship.x=getRandomFloat(1,xLimit-5),spaceship.y=getRandomFloat(1,yLimit-5),jumpCnt--,$("#HSCnt span").html(jumpCnt)):$("#sndHyperspaceFail").get(0).play())}function makeShot(){shotCnt++,shots.push(new Shot(shotCnt,spaceship.x,spaceship.y,spaceship.vx,spaceship.vy,spaceship.theta,spaceship.yaw,1800,0,0)),$("body").append("<svg id='shot"+shotCnt+"' data-id='"+shotCnt+"' class='shot' height='6' width='6'><circle cx='3' cy='3' r='3' stroke='white' stroke-width='2' fill='red' /></svg>")}function pewpew(){lifeCnt>0&&($("#sndLaser").get(0).play(),makeShot())}function endpew(){$("#sndLaser").get(0).pause(),$("#sndLaser").get(0).currentTime=0}function resetgame(){$("#gameOverBoard").hide(),$(".asteroid").remove(),lifeCnt=3,jumpCnt=3,score=0,asteroids=[],RegeneratgeAsteroids(),$("body").append("<svg id='spaceship' class=''><path cx='5' cy='5' r='10' stroke='#ffffff' stroke-width='2' d='M "+spaceship.shape+" Z'  id='outerShip' /></svg>"),$("#lifeCnt span").html(lifeCnt),$("#HSCnt span").html(jumpCnt),resetSpaceship()}function RegeneratgeAsteroids(){for(i=0;i<rockCnt;i++)thisRockSize=Math.floor(getRandomFloat(50,100)),thisRockSize=100,asteroids.push(new Asteroid(i,"test",thisRockSize,thisRockSize,getRandomFloat(0,xLimit-150),getRandomFloat(0,yLimit-150),getRandomFloat(-3,3),getRandomFloat(-3,3),colors[Math.floor(getRandomFloat(0,5))],"generic",!1));for(var y in asteroids)asteroids.hasOwnProperty(y)&&($("body").append("<svg id='rockAnim"+asteroids[y].id+"' data-id='"+asteroids[y].id+"' class='asteroid'><path cx='"+asteroids[y].width+"' cy='"+asteroids[y].height+"' r='"+(asteroids[y].width/2-5)+"' stroke='"+asteroids[y].color+"' stroke-width='2' d='M "+rocksLrg[Math.floor(getRandomFloat(0,3))]+" Z'  id='path81' /><text x='20' y='55' fill='"+asteroids[y].color+"'>"+asteroids[y].id+"</text></svg>"),$("#rockAnim"+asteroids[y].id).css("color",asteroids[y].color).css("border-color",asteroids[y].color).css("width",asteroids[y].width).css("height",asteroids[y].height).addClass("rockAnim"))}function Intersection(y){arguments.length>0&&this.init(y)}function Asteroid(y,t,e,x,n,i,s,o,r,a,c){this.id=y,this.title=t,this.width=e,this.height=x,this.x=n,this.y=i,this.xv=s,this.yv=o,this.color=r,this.type=a,this.oob=c,this.gravity=.1,this.gravitySpeed=0,this.bounce=.4,this.resetGravity=function(){},this.newPos=function(){this.gravitySpeed+=this.gravity,this.x+=this.xvel;var y=this.yv;this.yv<0&&(y=0),y=0,this.y+=y+this.gravitySpeed,this.hitBottom()},this.hitBottom=function(){var y=window.innerHeight-this.height;this.y>y&&(this.x=y,this.gravitySpeed=-this.gravitySpeed*this.bounce),this.x>window.innerWidth+this.width&&(this.x=0-this.width),this.x<0-this.width&&(this.x=window.innerWidth+this.width)},this.changeColor=function(y){this.color=y},this.oob=function(y){this.oob=y},this.changeVelocity=function(y,t){"x"==y&&(this.xv=t),"y"==y&&(this.yv=t)},this.changePosition=function(y,t){this.x=y,this.y=t},this.getVelocity=function(y){return this.direction}}function Spaceship(y,t,e,x,n,i,s,o){this.x=y,this.y=t,this.vx=e,this.vy=x,this.theta=n,this.width=20,this.height=15,this.yaw=i,this.x_points=s,this.y_points=o,this.shape="14.383032,5.9181762 0.35137621,0.04626516 2.7568063,5.9181762 0.35137621,11.338401"}function Shot(y,t,e,x,n,i,s,o,r,a){this.id=y,this.x=t,this.y=e,this.vx=x,this.vy=n,this.theta=i,this.width=6,this.height=6,this.yaw=s,this.life=o,this.x_points=r,this.y_points=a,this.changePosition=function(y,t){this.x=y,this.y=t},this.changeLife=function(y){this.life=y}}function resetWindowLimit(y){var t,e,x;if(e=window.innerHeight,x=window.innerHeight,"x"==y)for(t=window.innerWidth,i=0;i<asteroids.length;i++)asteroids[i].x>=e-asteroids[i].width&&asteroids[i].changePosition(e-asteroids[i].width,x-asteroids[i].height);else for(t=window.innerHeight,i=0;i<asteroids.length;i++)asteroids[i].y>=x-asteroids[i].height&&asteroids[i].changePosition(e-asteroids[i].width,t-asteroids[i].height);return t}function getRandomFloat(y,t){return Math.random()*(t-y)+y}function isPointInPoly(y,t){for(var e=!1,x=-1,n=y.length,i=n-1;++x<n;i=x)(y[x].y<=t.y&&t.y<y[i].y||y[i].y<=t.y&&t.y<y[x].y)&&t.x<(y[i].x-y[x].x)*(t.y-y[x].y)/(y[i].y-y[x].y)+y[x].x&&(e=!e);return e}$(window).resize(function(){xLimit=resetWindowLimit("x"),yLimit=resetWindowLimit("y")}),$(document).ready(function(){resetgame(),xLimit>768&&(inPlay=!1,$("#welcomeModel").modal("show"),$("#welcomeModel").on("hidden.bs.modal",function(y){inPlay=!0}));setInterval(function(){animateScreen(asteroids,shots)},delta_time)}),Intersection.prototype.init=function(y){this.status=y,this.points=new Array},Intersection.prototype.appendPoint=function(y){this.points.push(y)},Intersection.prototype.appendPoints=function(y){this.points=this.points.concat(y)},Intersection.intersectShapes=function(y,t){var e,x=y.getIntersectionParams(),n=t.getIntersectionParams();if(null!=x&&null!=n)if("Path"==x.name)e=Intersection.intersectPathShape(y,t);else if("Path"==n.name)e=Intersection.intersectPathShape(t,y);else{var i,s;if(x.name<n.name?(i="intersect"+x.name+n.name,s=x.params.concat(n.params)):(i="intersect"+n.name+x.name,s=n.params.concat(x.params)),!(i in Intersection))throw new Error("Intersection not available: "+i);e=Intersection[i].apply(null,s)}else e=new Intersection("No Intersection");return e},Intersection.intersectPathShape=function(y,t){return y.intersectShape(t)},Intersection.intersectBezier2Bezier2=function(y,t,e,x,n,i){var s,o,r,a,c,p,l,h,d,u=new Intersection("No Intersection");if(s=t.multiply(-2),r=y.add(s.add(e)),s=y.multiply(-2),o=t.multiply(2),a=s.add(o),c=new Point2D(y.x,y.y),s=n.multiply(-2),p=x.add(s.add(i)),s=x.multiply(-2),o=n.multiply(2),l=s.add(o),h=new Point2D(x.x,x.y),0==r.y){var m=(I=r.x*(c.y-h.y))+(g=I-a.x*a.y),w=a.y*a.y;d=new Polynomial(r.x*p.y*p.y,2*r.x*l.y*p.y,r.x*l.y*l.y-p.x*w-p.y*I-p.y*g,-l.x*w-l.y*I-l.y*g,(c.x-h.x)*w+(c.y-h.y)*g)}else{var I=r.x*p.y-r.y*p.x,g=r.x*l.y-l.x*r.y,f=(m=a.x*r.y-a.y*r.x,w=c.y-h.y,r.y*(c.x-h.x)-r.x*w),v=-a.y*m+r.y*f,P=m*m;d=new Polynomial(I*I,2*I*g,(-p.y*P+r.y*g*g+r.y*I*f+I*v)/r.y,(-l.y*P+r.y*g*f+g*v)/r.y,(w*P+f*v)/r.y)}for(var L=d.getRoots(),b=0;b<L.length;b++){var C=L[b];if(0<=C&&C<=1){var D=new Polynomial(r.x,a.x,c.x-h.x-C*l.x-C*C*p.x).getRoots(),R=new Polynomial(r.y,a.y,c.y-h.y-C*l.y-C*C*p.y).getRoots();if(D.length>0&&R.length>0){y:for(var k=0;k<D.length;k++){var $=D[k];if(0<=$&&$<=1)for(var z=0;z<R.length;z++)if(Math.abs($-R[z])<1e-4){u.points.push(p.multiply(C*C).add(l.multiply(C).add(h)));break y}}}}}return u.points.length>0&&(u.status="Intersection"),u},Intersection.intersectBezier2Bezier3=function(y,t,e,x,n,i,s){var o,r,a,c,p,l,h,d,u,m,w,I=new Intersection("No Intersection");o=t.multiply(-2),p=y.add(o.add(e)),o=y.multiply(-2),r=t.multiply(2),l=o.add(r),h=new Point2D(y.x,y.y),o=x.multiply(-1),r=n.multiply(3),a=i.multiply(-3),c=o.add(r.add(a.add(s))),d=new Vector2D(c.x,c.y),o=x.multiply(3),r=n.multiply(-6),a=i.multiply(3),c=o.add(r.add(a)),u=new Vector2D(c.x,c.y),o=x.multiply(-3),r=n.multiply(3),a=o.add(r),m=new Vector2D(a.x,a.y),w=new Vector2D(x.x,x.y);for(var g=h.x*h.x,f=h.y*h.y,v=l.x*l.x,P=l.y*l.y,L=p.x*p.x,b=p.y*p.y,C=w.x*w.x,D=w.y*w.y,R=m.x*m.x,k=m.y*m.y,$=u.x*u.x,z=u.y*u.y,B=d.x*d.x,S=d.y*d.y,V=new Polynomial(-2*p.x*p.y*d.x*d.y+L*S+b*B,-2*p.x*p.y*u.x*d.y-2*p.x*p.y*u.y*d.x+2*b*u.x*d.x+2*L*u.y*d.y,-2*p.x*m.x*p.y*d.y-2*p.x*p.y*m.y*d.x-2*p.x*p.y*u.x*u.y+2*m.x*b*d.x+b*$+L*(2*m.y*d.y+z),2*h.x*p.x*p.y*d.y+2*h.y*p.x*p.y*d.x+l.x*l.y*p.x*d.y+l.x*l.y*p.y*d.x-2*w.x*p.x*p.y*d.y-2*p.x*w.y*p.y*d.x-2*p.x*m.x*p.y*u.y-2*p.x*p.y*m.y*u.x-2*h.x*b*d.x-2*h.y*L*d.y+2*w.x*b*d.x+2*m.x*b*u.x-P*p.x*d.x-v*p.y*d.y+L*(2*w.y*d.y+2*m.y*u.y),2*h.x*p.x*p.y*u.y+2*h.y*p.x*p.y*u.x+l.x*l.y*p.x*u.y+l.x*l.y*p.y*u.x-2*w.x*p.x*p.y*u.y-2*p.x*w.y*p.y*u.x-2*p.x*m.x*p.y*m.y-2*h.x*b*u.x-2*h.y*L*u.y+2*w.x*b*u.x-P*p.x*u.x-v*p.y*u.y+R*b+L*(2*w.y*u.y+k),2*h.x*p.x*p.y*m.y+2*h.y*p.x*m.x*p.y+l.x*l.y*p.x*m.y+l.x*l.y*m.x*p.y-2*w.x*p.x*p.y*m.y-2*p.x*w.y*m.x*p.y-2*h.x*m.x*b-2*h.y*L*m.y+2*w.x*m.x*b-P*p.x*m.x-v*p.y*m.y+2*L*w.y*m.y,-2*h.x*h.y*p.x*p.y-h.x*l.x*l.y*p.y-h.y*l.x*l.y*p.x+2*h.x*p.x*w.y*p.y+2*h.y*w.x*p.x*p.y+l.x*w.x*l.y*p.y+l.x*l.y*p.x*w.y-2*w.x*p.x*w.y*p.y-2*h.x*w.x*b+h.x*P*p.x+h.y*v*p.y-2*h.y*L*w.y-w.x*P*p.x-v*w.y*p.y+g*b+f*L+C*b+L*D).getRootsInInterval(0,1),_=0;_<V.length;_++){var N=V[_],M=new Polynomial(p.x,l.x,h.x-w.x-N*m.x-N*N*u.x-N*N*N*d.x).getRoots(),E=new Polynomial(p.y,l.y,h.y-w.y-N*m.y-N*N*u.y-N*N*N*d.y).getRoots();if(M.length>0&&E.length>0){y:for(var H=0;H<M.length;H++){var F=M[H];if(0<=F&&F<=1)for(var O=0;O<E.length;O++)if(Math.abs(F-E[O])<1e-4){I.points.push(d.multiply(N*N*N).add(u.multiply(N*N).add(m.multiply(N).add(w))));break y}}}}return I.points.length>0&&(I.status="Intersection"),I},Intersection.intersectBezier2Circle=function(y,t,e,x,n){return Intersection.intersectBezier2Ellipse(y,t,e,x,n,n)},Intersection.intersectBezier2Ellipse=function(y,t,e,x,n,i){var s,o,r,a,c,p=new Intersection("No Intersection");s=t.multiply(-2),r=y.add(s.add(e)),s=y.multiply(-2),o=t.multiply(2),a=s.add(o),c=new Point2D(y.x,y.y);for(var l=n*n,h=i*i,d=new Polynomial(h*r.x*r.x+l*r.y*r.y,2*(h*r.x*a.x+l*r.y*a.y),h*(2*r.x*c.x+a.x*a.x)+l*(2*r.y*c.y+a.y*a.y)-2*(h*x.x*r.x+l*x.y*r.y),2*(h*a.x*(c.x-x.x)+l*a.y*(c.y-x.y)),h*(c.x*c.x+x.x*x.x)+l*(c.y*c.y+x.y*x.y)-2*(h*x.x*c.x+l*x.y*c.y)-l*h).getRoots(),u=0;u<d.length;u++){var m=d[u];0<=m&&m<=1&&p.points.push(r.multiply(m*m).add(a.multiply(m).add(c)))}return p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectBezier2Line=function(y,t,e,x,n){var i,s,o,r,a,c,p,l=x.min(n),h=x.max(n),d=new Intersection("No Intersection");i=t.multiply(-2),o=y.add(i.add(e)),i=y.multiply(-2),s=t.multiply(2),r=i.add(s),a=new Point2D(y.x,y.y),p=new Vector2D(x.y-n.y,n.x-x.x),c=x.x*n.y-n.x*x.y,roots=new Polynomial(p.dot(o),p.dot(r),p.dot(a)+c).getRoots();for(var u=0;u<roots.length;u++){var m=roots[u];if(0<=m&&m<=1){var w=y.lerp(t,m),I=t.lerp(e,m),g=w.lerp(I,m);x.x==n.x?l.y<=g.y&&g.y<=h.y&&(d.status="Intersection",d.appendPoint(g)):x.y==n.y?l.x<=g.x&&g.x<=h.x&&(d.status="Intersection",d.appendPoint(g)):g.gte(l)&&g.lte(h)&&(d.status="Intersection",d.appendPoint(g))}}return d},Intersection.intersectBezier2Polygon=function(y,t,e,x){for(var n=new Intersection("No Intersection"),i=x.length,s=0;s<i;s++){var o=x[s],r=x[(s+1)%i],a=Intersection.intersectBezier2Line(y,t,e,o,r);n.appendPoints(a.points)}return n.points.length>0&&(n.status="Intersection"),n},Intersection.intersectBezier2Rectangle=function(y,t,e,x,n){var i=x.min(n),s=x.max(n),o=new Point2D(s.x,i.y),r=new Point2D(i.x,s.y),a=Intersection.intersectBezier2Line(y,t,e,i,o),c=Intersection.intersectBezier2Line(y,t,e,o,s),p=Intersection.intersectBezier2Line(y,t,e,s,r),l=Intersection.intersectBezier2Line(y,t,e,r,i),h=new Intersection("No Intersection");return h.appendPoints(a.points),h.appendPoints(c.points),h.appendPoints(p.points),h.appendPoints(l.points),h.points.length>0&&(h.status="Intersection"),h},Intersection.intersectBezier3Bezier3=function(y,t,e,x,n,i,s,o){var r,a,c,p,l,h,d,u,m,w,I,g,f=new Intersection("No Intersection");r=y.multiply(-1),a=t.multiply(3),c=e.multiply(-3),p=r.add(a.add(c.add(x))),l=new Vector2D(p.x,p.y),r=y.multiply(3),a=t.multiply(-6),c=e.multiply(3),p=r.add(a.add(c)),h=new Vector2D(p.x,p.y),r=y.multiply(-3),a=t.multiply(3),c=r.add(a),d=new Vector2D(c.x,c.y),u=new Vector2D(y.x,y.y),r=n.multiply(-1),a=i.multiply(3),c=s.multiply(-3),p=r.add(a.add(c.add(o))),m=new Vector2D(p.x,p.y),r=n.multiply(3),a=i.multiply(-6),c=s.multiply(3),p=r.add(a.add(c)),w=new Vector2D(p.x,p.y),r=n.multiply(-3),a=i.multiply(3),c=r.add(a),I=new Vector2D(c.x,c.y),g=new Vector2D(n.x,n.y);for(var v=u.x*u.x,P=u.x*u.x*u.x,L=u.y*u.y,b=u.y*u.y*u.y,C=d.x*d.x,D=d.x*d.x*d.x,R=d.y*d.y,k=d.y*d.y*d.y,$=h.x*h.x,z=h.x*h.x*h.x,B=h.y*h.y,S=h.y*h.y*h.y,V=l.x*l.x,_=l.x*l.x*l.x,N=l.y*l.y,M=l.y*l.y*l.y,E=g.x*g.x,H=g.x*g.x*g.x,F=g.y*g.y,O=g.y*g.y*g.y,A=I.x*I.x,T=I.x*I.x*I.x,j=I.y*I.y,W=w.x*w.x,q=w.x*w.x*w.x,U=w.y*w.y,Z=m.x*m.x,G=m.x*m.x*m.x,J=m.y*m.y,K=m.y*m.y*m.y,Q=new Polynomial(-_*K+M*G-3*l.x*N*Z*m.y+3*V*l.y*m.x*J,-6*l.x*w.x*N*m.x*m.y+6*V*l.y*w.y*m.x*m.y+3*w.x*M*Z-3*_*w.y*J-3*l.x*N*w.y*Z+3*V*w.x*l.y*J,-6*I.x*l.x*N*m.x*m.y-6*l.x*w.x*N*w.y*m.x+6*V*w.x*l.y*w.y*m.y+3*I.x*M*Z+3*W*M*m.x+3*I.x*V*l.y*J-3*l.x*I.y*N*Z-3*l.x*W*N*m.y+V*l.y*m.x*(6*I.y*m.y+3*U)+_*(-I.y*J-2*U*m.y-m.y*(2*I.y*m.y+U)),d.x*h.y*l.x*l.y*m.x*m.y-d.y*h.x*l.x*l.y*m.x*m.y+6*I.x*w.x*M*m.x+3*d.x*h.x*l.x*l.y*J+6*u.x*l.x*N*m.x*m.y-3*d.x*h.x*N*m.x*m.y-3*d.y*h.y*l.x*l.y*Z-6*u.y*V*l.y*m.x*m.y-6*g.x*l.x*N*m.x*m.y+3*d.y*h.y*V*m.x*m.y-2*h.x*B*l.x*m.x*m.y-6*I.x*l.x*w.x*N*m.y-6*I.x*l.x*N*w.y*m.x-6*l.x*I.y*w.x*N*m.x+6*I.x*V*l.y*w.y*m.y+2*$*h.y*l.y*m.x*m.y+q*M-3*u.x*M*Z+3*u.y*_*J+3*g.x*M*Z+S*l.x*Z-z*l.y*J-3*u.x*V*l.y*J+3*u.y*l.x*N*Z-2*d.x*h.y*V*J+d.x*h.y*N*Z-d.y*h.x*V*J+2*d.y*h.x*N*Z+3*g.x*V*l.y*J-h.x*B*l.y*Z-3*g.y*l.x*N*Z+$*h.y*l.x*J-3*l.x*W*N*w.y+V*l.y*m.x*(6*g.y*m.y+6*I.y*w.y)+V*w.x*l.y*(6*I.y*m.y+3*U)+_*(-2*I.y*w.y*m.y-g.y*J-w.y*(2*I.y*m.y+U)-m.y*(2*g.y*m.y+2*I.y*w.y)),6*d.x*h.x*l.x*l.y*w.y*m.y+d.x*h.y*l.x*w.x*l.y*m.y+d.x*h.y*l.x*l.y*w.y*m.x-d.y*h.x*l.x*w.x*l.y*m.y-d.y*h.x*l.x*l.y*w.y*m.x-6*d.y*h.y*l.x*w.x*l.y*m.x-6*u.x*w.x*M*m.x+6*g.x*w.x*M*m.x+6*u.y*_*w.y*m.y+2*S*l.x*w.x*m.x-2*z*l.y*w.y*m.y+6*u.x*l.x*w.x*N*m.y+6*u.x*l.x*N*w.y*m.x+6*u.y*l.x*w.x*N*m.x-3*d.x*h.x*w.x*N*m.y-3*d.x*h.x*N*w.y*m.x+2*d.x*h.y*w.x*N*m.x+4*d.y*h.x*w.x*N*m.x-6*u.x*V*l.y*w.y*m.y-6*u.y*V*w.x*l.y*m.y-6*u.y*V*l.y*w.y*m.x-4*d.x*h.y*V*w.y*m.y-6*g.x*l.x*w.x*N*m.y-6*g.x*l.x*N*w.y*m.x-2*d.y*h.x*V*w.y*m.y+3*d.y*h.y*V*w.x*m.y+3*d.y*h.y*V*w.y*m.x-2*h.x*B*l.x*w.x*m.y-2*h.x*B*l.x*w.y*m.x-2*h.x*B*w.x*l.y*m.x-6*g.y*l.x*w.x*N*m.x-6*I.x*l.x*I.y*N*m.x-6*I.x*l.x*w.x*N*w.y+6*g.x*V*l.y*w.y*m.y+2*$*h.y*l.x*w.y*m.y+2*$*h.y*w.x*l.y*m.y+2*$*h.y*l.y*w.y*m.x+3*I.x*W*M+3*A*M*m.x-3*l.x*I.y*W*N-3*A*l.x*N*m.y+V*w.x*l.y*(6*g.y*m.y+6*I.y*w.y)+V*l.y*m.x*(6*g.y*w.y+3*j)+I.x*V*l.y*(6*I.y*m.y+3*U)+_*(-2*g.y*w.y*m.y-m.y*(2*g.y*w.y+j)-I.y*(2*I.y*m.y+U)-w.y*(2*g.y*m.y+2*I.y*w.y)),d.x*I.x*h.y*l.x*l.y*m.y+d.x*h.y*l.x*I.y*l.y*m.x+d.x*h.y*l.x*w.x*l.y*w.y-d.y*h.x*I.x*l.x*l.y*m.y-d.y*h.x*l.x*I.y*l.y*m.x-d.y*h.x*l.x*w.x*l.y*w.y-6*d.y*I.x*h.y*l.x*l.y*m.x-6*u.x*I.x*M*m.x+6*g.x*I.x*M*m.x+2*I.x*S*l.x*m.x+6*u.x*I.x*l.x*N*m.y+6*u.x*l.x*I.y*N*m.x+6*u.x*l.x*w.x*N*w.y+6*u.y*I.x*l.x*N*m.x-3*d.x*h.x*I.x*N*m.y-3*d.x*h.x*I.y*N*m.x-3*d.x*h.x*w.x*N*w.y+2*d.x*I.x*h.y*N*m.x+4*d.y*h.x*I.x*N*m.x-6*u.y*I.x*V*l.y*m.y-6*u.y*V*I.y*l.y*m.x-6*u.y*V*w.x*l.y*w.y-6*g.x*I.x*l.x*N*m.y-6*g.x*l.x*I.y*N*m.x-6*g.x*l.x*w.x*N*w.y+3*d.y*I.x*h.y*V*m.y-3*d.y*h.y*l.x*W*l.y+3*d.y*h.y*V*I.y*m.x+3*d.y*h.y*V*w.x*w.y-2*h.x*I.x*B*l.x*m.y-2*h.x*I.x*B*l.y*m.x-2*h.x*B*l.x*I.y*m.x-2*h.x*B*l.x*w.x*w.y-6*g.y*I.x*l.x*N*m.x-6*I.x*l.x*I.y*w.x*N+6*g.y*V*I.y*l.y*m.x+2*$*I.x*h.y*l.y*m.y+2*$*h.y*I.y*l.y*m.x+2*$*h.y*w.x*l.y*w.y-3*u.x*W*M+3*g.x*W*M+3*A*w.x*M+S*l.x*W+3*u.y*l.x*W*N+d.x*h.y*W*N+2*d.y*h.x*W*N-h.x*B*W*l.y-3*g.y*l.x*W*N-3*A*l.x*N*w.y+$*h.y*l.x*(2*I.y*m.y+U)+d.x*h.x*l.x*l.y*(6*I.y*m.y+3*U)+I.x*V*l.y*(6*g.y*m.y+6*I.y*w.y)+z*l.y*(-2*I.y*m.y-U)+u.y*_*(6*I.y*m.y+3*U)+d.y*h.x*V*(-2*I.y*m.y-U)+d.x*h.y*V*(-4*I.y*m.y-2*U)+u.x*V*l.y*(-6*I.y*m.y-3*U)+V*w.x*l.y*(6*g.y*w.y+3*j)+g.x*V*l.y*(6*I.y*m.y+3*U)+_*(-2*g.y*I.y*m.y-w.y*(2*g.y*w.y+j)-g.y*(2*I.y*m.y+U)-I.y*(2*g.y*m.y+2*I.y*w.y)),-u.x*d.x*h.y*l.x*l.y*m.y+u.x*d.y*h.x*l.x*l.y*m.y+6*u.x*d.y*h.y*l.x*l.y*m.x-6*u.y*d.x*h.x*l.x*l.y*m.y-u.y*d.x*h.y*l.x*l.y*m.x+u.y*d.y*h.x*l.x*l.y*m.x+d.x*d.y*h.x*h.y*l.x*m.y-d.x*d.y*h.x*h.y*l.y*m.x+d.x*g.x*h.y*l.x*l.y*m.y+d.x*g.y*h.y*l.x*l.y*m.x+d.x*I.x*h.y*l.x*l.y*w.y+d.x*h.y*l.x*I.y*w.x*l.y-g.x*d.y*h.x*l.x*l.y*m.y-6*g.x*d.y*h.y*l.x*l.y*m.x-d.y*h.x*g.y*l.x*l.y*m.x-d.y*h.x*I.x*l.x*l.y*w.y-d.y*h.x*l.x*I.y*w.x*l.y-6*d.y*I.x*h.y*l.x*w.x*l.y-6*u.x*g.x*M*m.x-6*u.x*I.x*w.x*M-2*u.x*S*l.x*m.x+6*g.x*I.x*w.x*M+2*g.x*S*l.x*m.x+2*I.x*S*l.x*w.x+2*u.y*z*l.y*m.y-6*u.x*u.y*l.x*N*m.x+3*u.x*d.x*h.x*N*m.y-2*u.x*d.x*h.y*N*m.x-4*u.x*d.y*h.x*N*m.x+3*u.y*d.x*h.x*N*m.x+6*u.x*u.y*V*l.y*m.y+6*u.x*g.x*l.x*N*m.y-3*u.x*d.y*h.y*V*m.y+2*u.x*h.x*B*l.x*m.y+2*u.x*h.x*B*l.y*m.x+6*u.x*g.y*l.x*N*m.x+6*u.x*I.x*l.x*N*w.y+6*u.x*l.x*I.y*w.x*N+4*u.y*d.x*h.y*V*m.y+6*u.y*g.x*l.x*N*m.x+2*u.y*d.y*h.x*V*m.y-3*u.y*d.y*h.y*V*m.x+2*u.y*h.x*B*l.x*m.x+6*u.y*I.x*l.x*w.x*N-3*d.x*g.x*h.x*N*m.y+2*d.x*g.x*h.y*N*m.x+d.x*d.y*B*l.x*m.x-3*d.x*h.x*g.y*N*m.x-3*d.x*h.x*I.x*N*w.y-3*d.x*h.x*I.y*w.x*N+2*d.x*I.x*h.y*w.x*N+4*g.x*d.y*h.x*N*m.x+4*d.y*h.x*I.x*w.x*N-2*u.x*$*h.y*l.y*m.y-6*u.y*g.x*V*l.y*m.y-6*u.y*g.y*V*l.y*m.x-6*u.y*I.x*V*l.y*w.y-2*u.y*$*h.y*l.x*m.y-2*u.y*$*h.y*l.y*m.x-6*u.y*V*I.y*w.x*l.y-d.x*d.y*$*l.y*m.y-2*d.x*R*l.x*l.y*m.x+3*g.x*d.y*h.y*V*m.y-2*g.x*h.x*B*l.x*m.y-2*g.x*h.x*B*l.y*m.x-6*g.x*g.y*l.x*N*m.x-6*g.x*I.x*l.x*N*w.y-6*g.x*l.x*I.y*w.x*N+3*d.y*g.y*h.y*V*m.x+3*d.y*I.x*h.y*V*w.y+3*d.y*h.y*V*I.y*w.x-2*h.x*g.y*B*l.x*m.x-2*h.x*I.x*B*l.x*w.y-2*h.x*I.x*B*w.x*l.y-2*h.x*B*l.x*I.y*w.x-6*g.y*I.x*l.x*w.x*N-R*h.x*h.y*l.x*m.x+2*g.x*$*h.y*l.y*m.y+6*g.y*V*I.y*w.x*l.y+2*C*d.y*l.x*l.y*m.y+C*h.x*h.y*l.y*m.y+2*$*g.y*h.y*l.y*m.x+2*$*I.x*h.y*l.y*w.y+2*$*h.y*I.y*w.x*l.y+T*M+3*v*M*m.x-3*L*_*m.y+3*E*M*m.x+k*V*m.x-D*N*m.y-d.x*R*V*m.y+C*d.y*N*m.x-3*v*l.x*N*m.y+3*L*V*l.y*m.x-C*B*l.x*m.y+R*$*l.y*m.x-3*A*l.x*I.y*N-3*E*l.x*N*m.y+3*F*V*l.y*m.x+d.x*h.x*l.x*l.y*(6*g.y*m.y+6*I.y*w.y)+z*l.y*(-2*g.y*m.y-2*I.y*w.y)+u.y*_*(6*g.y*m.y+6*I.y*w.y)+d.y*h.x*V*(-2*g.y*m.y-2*I.y*w.y)+$*h.y*l.x*(2*g.y*m.y+2*I.y*w.y)+d.x*h.y*V*(-4*g.y*m.y-4*I.y*w.y)+u.x*V*l.y*(-6*g.y*m.y-6*I.y*w.y)+g.x*V*l.y*(6*g.y*m.y+6*I.y*w.y)+I.x*V*l.y*(6*g.y*w.y+3*j)+_*(-2*g.y*I.y*w.y-F*m.y-I.y*(2*g.y*w.y+j)-g.y*(2*g.y*m.y+2*I.y*w.y)),-u.x*d.x*h.y*l.x*l.y*w.y+u.x*d.y*h.x*l.x*l.y*w.y+6*u.x*d.y*h.y*l.x*w.x*l.y-6*u.y*d.x*h.x*l.x*l.y*w.y-u.y*d.x*h.y*l.x*w.x*l.y+u.y*d.y*h.x*l.x*w.x*l.y+d.x*d.y*h.x*h.y*l.x*w.y-d.x*d.y*h.x*h.y*w.x*l.y+d.x*g.x*h.y*l.x*l.y*w.y+d.x*g.y*h.y*l.x*w.x*l.y+d.x*I.x*h.y*l.x*I.y*l.y-g.x*d.y*h.x*l.x*l.y*w.y-6*g.x*d.y*h.y*l.x*w.x*l.y-d.y*h.x*g.y*l.x*w.x*l.y-d.y*h.x*I.x*l.x*I.y*l.y-6*u.x*g.x*w.x*M-2*u.x*S*l.x*w.x+2*g.x*S*l.x*w.x+2*u.y*z*l.y*w.y-6*u.x*u.y*l.x*w.x*N+3*u.x*d.x*h.x*N*w.y-2*u.x*d.x*h.y*w.x*N-4*u.x*d.y*h.x*w.x*N+3*u.y*d.x*h.x*w.x*N+6*u.x*u.y*V*l.y*w.y+6*u.x*g.x*l.x*N*w.y-3*u.x*d.y*h.y*V*w.y+2*u.x*h.x*B*l.x*w.y+2*u.x*h.x*B*w.x*l.y+6*u.x*g.y*l.x*w.x*N+6*u.x*I.x*l.x*I.y*N+4*u.y*d.x*h.y*V*w.y+6*u.y*g.x*l.x*w.x*N+2*u.y*d.y*h.x*V*w.y-3*u.y*d.y*h.y*V*w.x+2*u.y*h.x*B*l.x*w.x-3*d.x*g.x*h.x*N*w.y+2*d.x*g.x*h.y*w.x*N+d.x*d.y*B*l.x*w.x-3*d.x*h.x*g.y*w.x*N-3*d.x*h.x*I.x*I.y*N+4*g.x*d.y*h.x*w.x*N-2*u.x*$*h.y*l.y*w.y-6*u.y*g.x*V*l.y*w.y-6*u.y*g.y*V*w.x*l.y-6*u.y*I.x*V*I.y*l.y-2*u.y*$*h.y*l.x*w.y-2*u.y*$*h.y*w.x*l.y-d.x*d.y*$*l.y*w.y-2*d.x*R*l.x*w.x*l.y+3*g.x*d.y*h.y*V*w.y-2*g.x*h.x*B*l.x*w.y-2*g.x*h.x*B*w.x*l.y-6*g.x*g.y*l.x*w.x*N-6*g.x*I.x*l.x*I.y*N+3*d.y*g.y*h.y*V*w.x+3*d.y*I.x*h.y*V*I.y-2*h.x*g.y*B*l.x*w.x-2*h.x*I.x*B*l.x*I.y-R*h.x*h.y*l.x*w.x+2*g.x*$*h.y*l.y*w.y-3*d.y*A*h.y*l.x*l.y+6*g.y*I.x*V*I.y*l.y+2*C*d.y*l.x*l.y*w.y+C*h.x*h.y*l.y*w.y+2*$*g.y*h.y*w.x*l.y+2*$*I.x*h.y*I.y*l.y-3*u.x*A*M+3*g.x*A*M+3*v*w.x*M-3*L*_*w.y+3*E*w.x*M+A*S*l.x+k*V*w.x-D*N*w.y+3*u.y*A*l.x*N-d.x*R*V*w.y+d.x*A*h.y*N+2*d.y*h.x*A*N+C*d.y*w.x*N-h.x*A*B*l.y-3*g.y*A*l.x*N-3*v*l.x*N*w.y+3*L*V*w.x*l.y-C*B*l.x*w.y+R*$*w.x*l.y-3*E*l.x*N*w.y+3*F*V*w.x*l.y+$*h.y*l.x*(2*g.y*w.y+j)+d.x*h.x*l.x*l.y*(6*g.y*w.y+3*j)+z*l.y*(-2*g.y*w.y-j)+u.y*_*(6*g.y*w.y+3*j)+d.y*h.x*V*(-2*g.y*w.y-j)+d.x*h.y*V*(-4*g.y*w.y-2*j)+u.x*V*l.y*(-6*g.y*w.y-3*j)+g.x*V*l.y*(6*g.y*w.y+3*j)+_*(-2*g.y*j-F*w.y-g.y*(2*g.y*w.y+j)),-u.x*d.x*h.y*l.x*I.y*l.y+u.x*d.y*h.x*l.x*I.y*l.y+6*u.x*d.y*I.x*h.y*l.x*l.y-6*u.y*d.x*h.x*l.x*I.y*l.y-u.y*d.x*I.x*h.y*l.x*l.y+u.y*d.y*h.x*I.x*l.x*l.y-d.x*d.y*h.x*I.x*h.y*l.y+d.x*d.y*h.x*h.y*l.x*I.y+d.x*g.x*h.y*l.x*I.y*l.y+6*d.x*h.x*g.y*l.x*I.y*l.y+d.x*g.y*I.x*h.y*l.x*l.y-g.x*d.y*h.x*l.x*I.y*l.y-6*g.x*d.y*I.x*h.y*l.x*l.y-d.y*h.x*g.y*I.x*l.x*l.y-6*u.x*g.x*I.x*M-2*u.x*I.x*S*l.x+6*u.y*g.y*_*I.y+2*g.x*I.x*S*l.x+2*u.y*z*I.y*l.y-2*z*g.y*I.y*l.y-6*u.x*u.y*I.x*l.x*N+3*u.x*d.x*h.x*I.y*N-2*u.x*d.x*I.x*h.y*N-4*u.x*d.y*h.x*I.x*N+3*u.y*d.x*h.x*I.x*N+6*u.x*u.y*V*I.y*l.y+6*u.x*g.x*l.x*I.y*N-3*u.x*d.y*h.y*V*I.y+2*u.x*h.x*I.x*B*l.y+2*u.x*h.x*B*l.x*I.y+6*u.x*g.y*I.x*l.x*N+4*u.y*d.x*h.y*V*I.y+6*u.y*g.x*I.x*l.x*N+2*u.y*d.y*h.x*V*I.y-3*u.y*d.y*I.x*h.y*V+2*u.y*h.x*I.x*B*l.x-3*d.x*g.x*h.x*I.y*N+2*d.x*g.x*I.x*h.y*N+d.x*d.y*I.x*B*l.x-3*d.x*h.x*g.y*I.x*N+4*g.x*d.y*h.x*I.x*N-6*u.x*g.y*V*I.y*l.y-2*u.x*$*h.y*I.y*l.y-6*u.y*g.x*V*I.y*l.y-6*u.y*g.y*I.x*V*l.y-2*u.y*$*I.x*h.y*l.y-2*u.y*$*h.y*l.x*I.y-d.x*d.y*$*I.y*l.y-4*d.x*g.y*h.y*V*I.y-2*d.x*R*I.x*l.x*l.y+3*g.x*d.y*h.y*V*I.y-2*g.x*h.x*I.x*B*l.y-2*g.x*h.x*B*l.x*I.y-6*g.x*g.y*I.x*l.x*N-2*d.y*h.x*g.y*V*I.y+3*d.y*g.y*I.x*h.y*V-2*h.x*g.y*I.x*B*l.x-R*h.x*I.x*h.y*l.x+6*g.x*g.y*V*I.y*l.y+2*g.x*$*h.y*I.y*l.y+2*C*d.y*l.x*I.y*l.y+C*h.x*h.y*I.y*l.y+2*$*g.y*I.x*h.y*l.y+2*$*g.y*h.y*l.x*I.y+3*v*I.x*M-3*L*_*I.y+3*E*I.x*M+k*I.x*V-D*I.y*N-3*F*_*I.y-d.x*R*V*I.y+C*d.y*I.x*N-3*v*l.x*I.y*N+3*L*I.x*V*l.y-C*B*l.x*I.y+R*$*I.x*l.y-3*E*l.x*I.y*N+3*F*I.x*V*l.y,u.x*u.y*d.x*h.y*l.x*l.y-u.x*u.y*d.y*h.x*l.x*l.y+u.x*d.x*d.y*h.x*h.y*l.y-u.y*d.x*d.y*h.x*h.y*l.x-u.x*d.x*g.y*h.y*l.x*l.y+6*u.x*g.x*d.y*h.y*l.x*l.y+u.x*d.y*h.x*g.y*l.x*l.y-u.y*d.x*g.x*h.y*l.x*l.y-6*u.y*d.x*h.x*g.y*l.x*l.y+u.y*g.x*d.y*h.x*l.x*l.y-d.x*g.x*d.y*h.x*h.y*l.y+d.x*d.y*h.x*g.y*h.y*l.x+d.x*g.x*g.y*h.y*l.x*l.y-g.x*d.y*h.x*g.y*l.x*l.y-2*u.x*g.x*S*l.x+2*u.y*z*g.y*l.y-3*u.x*u.y*d.x*h.x*N-6*u.x*u.y*g.x*l.x*N+3*u.x*u.y*d.y*h.y*V-2*u.x*u.y*h.x*B*l.x-2*u.x*d.x*g.x*h.y*N-u.x*d.x*d.y*B*l.x+3*u.x*d.x*h.x*g.y*N-4*u.x*g.x*d.y*h.x*N+3*u.y*d.x*g.x*h.x*N+6*u.x*u.y*g.y*V*l.y+2*u.x*u.y*$*h.y*l.y+2*u.x*d.x*R*l.x*l.y+2*u.x*g.x*h.x*B*l.y+6*u.x*g.x*g.y*l.x*N-3*u.x*d.y*g.y*h.y*V+2*u.x*h.x*g.y*B*l.x+u.x*R*h.x*h.y*l.x+u.y*d.x*d.y*$*l.y+4*u.y*d.x*g.y*h.y*V-3*u.y*g.x*d.y*h.y*V+2*u.y*g.x*h.x*B*l.x+2*u.y*d.y*h.x*g.y*V+d.x*g.x*d.y*B*l.x-3*d.x*g.x*h.x*g.y*N-2*u.x*$*g.y*h.y*l.y-6*u.y*g.x*g.y*V*l.y-2*u.y*g.x*$*h.y*l.y-2*u.y*C*d.y*l.x*l.y-u.y*C*h.x*h.y*l.y-2*u.y*$*g.y*h.y*l.x-2*d.x*g.x*R*l.x*l.y-d.x*d.y*$*g.y*l.y+3*g.x*d.y*g.y*h.y*V-2*g.x*h.x*g.y*B*l.x-g.x*R*h.x*h.y*l.x+3*L*d.x*h.x*l.x*l.y+3*d.x*h.x*F*l.x*l.y+2*g.x*$*g.y*h.y*l.y-3*v*d.y*h.y*l.x*l.y+2*C*d.y*g.y*l.x*l.y+C*h.x*g.y*h.y*l.y-3*E*d.y*h.y*l.x*l.y-P*M+b*_+H*M-O*_-3*u.x*E*M-u.x*k*V+3*v*g.x*M+u.y*D*N+3*u.y*F*_+g.x*k*V+v*S*l.x-3*L*g.y*_-L*z*l.y+E*S*l.x-D*g.y*N-z*F*l.y-u.x*C*d.y*N+u.y*d.x*R*V-3*u.x*L*V*l.y-u.x*R*$*l.y+u.y*C*B*l.x-d.x*R*g.y*V+3*v*u.y*l.x*N+v*d.x*h.y*N+2*v*d.y*h.x*N-2*L*d.x*h.y*V-L*d.y*h.x*V+C*g.x*d.y*N-3*u.x*F*V*l.y+3*u.y*E*l.x*N+d.x*E*h.y*N-2*d.x*F*h.y*V+g.x*R*$*l.y-d.y*h.x*F*V-v*h.x*B*l.y-3*v*g.y*l.x*N+3*L*g.x*V*l.y+L*$*h.y*l.x-C*g.y*B*l.x+2*E*d.y*h.x*N+3*g.x*F*V*l.y-E*h.x*B*l.y-3*E*g.y*l.x*N+$*F*h.y*l.x).getRootsInInterval(0,1),X=0;X<Q.length;X++){var Y=Q[X],yy=new Polynomial(l.x,h.x,d.x,u.x-g.x-Y*I.x-Y*Y*w.x-Y*Y*Y*m.x).getRoots(),ty=new Polynomial(l.y,h.y,d.y,u.y-g.y-Y*I.y-Y*Y*w.y-Y*Y*Y*m.y).getRoots();if(yy.length>0&&ty.length>0){y:for(var ey=0;ey<yy.length;ey++){var xy=yy[ey];if(0<=xy&&xy<=1)for(var ny=0;ny<ty.length;ny++)if(Math.abs(xy-ty[ny])<1e-4){f.points.push(m.multiply(Y*Y*Y).add(w.multiply(Y*Y).add(I.multiply(Y).add(g))));break y}}}}return f.points.length>0&&(f.status="Intersection"),f},Intersection.intersectBezier3Circle=function(y,t,e,x,n,i){return Intersection.intersectBezier3Ellipse(y,t,e,x,n,i,i)},Intersection.intersectBezier3Ellipse=function(y,t,e,x,n,i,s){var o,r,a,c,p,l,h,d,u=new Intersection("No Intersection");o=y.multiply(-1),r=t.multiply(3),a=e.multiply(-3),c=o.add(r.add(a.add(x))),p=new Vector2D(c.x,c.y),o=y.multiply(3),r=t.multiply(-6),a=e.multiply(3),c=o.add(r.add(a)),l=new Vector2D(c.x,c.y),o=y.multiply(-3),r=t.multiply(3),a=o.add(r),h=new Vector2D(a.x,a.y),d=new Vector2D(y.x,y.y);for(var m=i*i,w=s*s,I=new Polynomial(p.x*p.x*w+p.y*p.y*m,2*(p.x*l.x*w+p.y*l.y*m),2*(p.x*h.x*w+p.y*h.y*m)+l.x*l.x*w+l.y*l.y*m,2*p.x*w*(d.x-n.x)+2*p.y*m*(d.y-n.y)+2*(l.x*h.x*w+l.y*h.y*m),2*l.x*w*(d.x-n.x)+2*l.y*m*(d.y-n.y)+h.x*h.x*w+h.y*h.y*m,2*h.x*w*(d.x-n.x)+2*h.y*m*(d.y-n.y),d.x*d.x*w-2*d.y*n.y*m-2*d.x*n.x*w+d.y*d.y*m+n.x*n.x*w+n.y*n.y*m-m*w).getRootsInInterval(0,1),g=0;g<I.length;g++){var f=I[g];u.points.push(p.multiply(f*f*f).add(l.multiply(f*f).add(h.multiply(f).add(d))))}return u.points.length>0&&(u.status="Intersection"),u},Intersection.intersectBezier3Line=function(y,t,e,x,n,i){var s,o,r,a,c,p,l,h,d,u,m=n.min(i),w=n.max(i),I=new Intersection("No Intersection");s=y.multiply(-1),o=t.multiply(3),r=e.multiply(-3),a=s.add(o.add(r.add(x))),c=new Vector2D(a.x,a.y),s=y.multiply(3),o=t.multiply(-6),r=e.multiply(3),a=s.add(o.add(r)),p=new Vector2D(a.x,a.y),s=y.multiply(-3),o=t.multiply(3),r=s.add(o),l=new Vector2D(r.x,r.y),h=new Vector2D(y.x,y.y),u=new Vector2D(n.y-i.y,i.x-n.x),d=n.x*i.y-i.x*n.y,roots=new Polynomial(u.dot(c),u.dot(p),u.dot(l),u.dot(h)+d).getRoots();for(var g=0;g<roots.length;g++){var f=roots[g];if(0<=f&&f<=1){var v=y.lerp(t,f),P=t.lerp(e,f),L=e.lerp(x,f),b=v.lerp(P,f),C=P.lerp(L,f),D=b.lerp(C,f);n.x==i.x?m.y<=D.y&&D.y<=w.y&&(I.status="Intersection",I.appendPoint(D)):n.y==i.y?m.x<=D.x&&D.x<=w.x&&(I.status="Intersection",I.appendPoint(D)):D.gte(m)&&D.lte(w)&&(I.status="Intersection",I.appendPoint(D))}}return I},Intersection.intersectBezier3Polygon=function(y,t,e,x,n){for(var i=new Intersection("No Intersection"),s=n.length,o=0;o<s;o++){var r=n[o],a=n[(o+1)%s],c=Intersection.intersectBezier3Line(y,t,e,x,r,a);i.appendPoints(c.points)}return i.points.length>0&&(i.status="Intersection"),i},Intersection.intersectBezier3Rectangle=function(y,t,e,x,n,i){var s=n.min(i),o=n.max(i),r=new Point2D(o.x,s.y),a=new Point2D(s.x,o.y),c=Intersection.intersectBezier3Line(y,t,e,x,s,r),p=Intersection.intersectBezier3Line(y,t,e,x,r,o),l=Intersection.intersectBezier3Line(y,t,e,x,o,a),h=Intersection.intersectBezier3Line(y,t,e,x,a,s),d=new Intersection("No Intersection");return d.appendPoints(c.points),d.appendPoints(p.points),d.appendPoints(l.points),d.appendPoints(h.points),d.points.length>0&&(d.status="Intersection"),d},Intersection.intersectCircleCircle=function(y,t,e,x){var n,i=t+x,s=Math.abs(t-x),o=y.distanceFrom(e);if(o>i)n=new Intersection("Outside");else if(o<s)n=new Intersection("Inside");else{n=new Intersection("Intersection");var r=(t*t-x*x+o*o)/(2*o),a=Math.sqrt(t*t-r*r),c=y.lerp(e,r/o),p=a/o;n.points.push(new Point2D(c.x-p*(e.y-y.y),c.y+p*(e.x-y.x))),n.points.push(new Point2D(c.x+p*(e.y-y.y),c.y-p*(e.x-y.x)))}return n},Intersection.intersectCircleEllipse=function(y,t,e,x,n){return Intersection.intersectEllipseEllipse(y,t,t,e,x,n)},Intersection.intersectCircleLine=function(y,t,e,x){var n,i=(x.x-e.x)*(x.x-e.x)+(x.y-e.y)*(x.y-e.y),s=2*((x.x-e.x)*(e.x-y.x)+(x.y-e.y)*(e.y-y.y)),o=s*s-4*i*(y.x*y.x+y.y*y.y+e.x*e.x+e.y*e.y-2*(y.x*e.x+y.y*e.y)-t*t);if(o<0)n=new Intersection("Outside");else if(0==o)n=new Intersection("Tangent");else{var r=Math.sqrt(o),a=(-s+r)/(2*i),c=(-s-r)/(2*i);(a<0||a>1)&&(c<0||c>1)?n=new Intersection(a<0&&c<0||a>1&&c>1?"Outside":"Inside"):(n=new Intersection("Intersection"),0<=a&&a<=1&&n.points.push(e.lerp(x,a)),0<=c&&c<=1&&n.points.push(e.lerp(x,c)))}return n},Intersection.intersectCirclePolygon=function(y,t,e){for(var x,n=new Intersection("No Intersection"),i=e.length,s=0;s<i;s++){var o=e[s],r=e[(s+1)%i];x=Intersection.intersectCircleLine(y,t,o,r),n.appendPoints(x.points)}return n.points.length>0?n.status="Intersection":n.status=x.status,n},Intersection.intersectCircleRectangle=function(y,t,e,x){var n=e.min(x),i=e.max(x),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectCircleLine(y,t,n,s),a=Intersection.intersectCircleLine(y,t,s,i),c=Intersection.intersectCircleLine(y,t,i,o),p=Intersection.intersectCircleLine(y,t,o,n),l=new Intersection("No Intersection");return l.appendPoints(r.points),l.appendPoints(a.points),l.appendPoints(c.points),l.appendPoints(p.points),l.points.length>0?l.status="Intersection":l.status=r.status,l},Intersection.intersectEllipseEllipse=function(y,t,e,x,n,i){for(var s=[e*e,0,t*t,-2*e*e*y.x,-2*t*t*y.y,e*e*y.x*y.x+t*t*y.y*y.y-t*t*e*e],o=[i*i,0,n*n,-2*i*i*x.x,-2*n*n*x.y,i*i*x.x*x.x+n*n*x.y*x.y-n*n*i*i],r=Intersection.bezout(s,o).getRoots(),a=.001*(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2]),c=.001*(o[0]*o[0]+2*o[1]*o[1]+o[2]*o[2]),p=new Intersection("No Intersection"),l=0;l<r.length;l++)for(var h=new Polynomial(s[0],s[3]+r[l]*s[1],s[5]+r[l]*(s[4]+r[l]*s[2])).getRoots(),d=0;d<h.length;d++){var u=(s[0]*h[d]+s[1]*r[l]+s[3])*h[d]+(s[2]*r[l]+s[4])*r[l]+s[5];Math.abs(u)<a&&(u=(o[0]*h[d]+o[1]*r[l]+o[3])*h[d]+(o[2]*r[l]+o[4])*r[l]+o[5],Math.abs(u)<c&&p.appendPoint(new Point2D(h[d],r[l])))}return p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectEllipseLine=function(y,t,e,x,n){var i,s=new Vector2D(x.x,x.y),o=Vector2D.fromPoints(x,n),r=new Vector2D(y.x,y.y),a=s.subtract(r),c=new Vector2D(o.x/(t*t),o.y/(e*e)),p=new Vector2D(a.x/(t*t),a.y/(e*e)),l=o.dot(c),h=o.dot(p),d=h*h-l*(y=a.dot(p)-1);if(d<0)i=new Intersection("Outside");else if(d>0){var u=Math.sqrt(d),m=(-h-u)/l,w=(-h+u)/l;(m<0||1<m)&&(w<0||1<w)?i=new Intersection(m<0&&w<0||m>1&&w>1?"Outside":"Inside"):(i=new Intersection("Intersection"),0<=m&&m<=1&&i.appendPoint(x.lerp(n,m)),0<=w&&w<=1&&i.appendPoint(x.lerp(n,w)))}else{var I=-h/l;0<=I&&I<=1?(i=new Intersection("Intersection")).appendPoint(x.lerp(n,I)):i=new Intersection("Outside")}return i},Intersection.intersectEllipsePolygon=function(y,t,e,x){for(var n=new Intersection("No Intersection"),i=x.length,s=0;s<i;s++){var o=x[s],r=x[(s+1)%i],a=Intersection.intersectEllipseLine(y,t,e,o,r);n.appendPoints(a.points)}return n.points.length>0&&(n.status="Intersection"),n},Intersection.intersectEllipseRectangle=function(y,t,e,x,n){var i=x.min(n),s=x.max(n),o=new Point2D(s.x,i.y),r=new Point2D(i.x,s.y),a=Intersection.intersectEllipseLine(y,t,e,i,o),c=Intersection.intersectEllipseLine(y,t,e,o,s),p=Intersection.intersectEllipseLine(y,t,e,s,r),l=Intersection.intersectEllipseLine(y,t,e,r,i),h=new Intersection("No Intersection");return h.appendPoints(a.points),h.appendPoints(c.points),h.appendPoints(p.points),h.appendPoints(l.points),h.points.length>0&&(h.status="Intersection"),h},Intersection.intersectLineLine=function(y,t,e,x){var n,i=(x.x-e.x)*(y.y-e.y)-(x.y-e.y)*(y.x-e.x),s=(t.x-y.x)*(y.y-e.y)-(t.y-y.y)*(y.x-e.x),o=(x.y-e.y)*(t.x-y.x)-(x.x-e.x)*(t.y-y.y);if(0!=o){var r=i/o,a=s/o;0<=r&&r<=1&&0<=a&&a<=1?(n=new Intersection("Intersection")).points.push(new Point2D(y.x+r*(t.x-y.x),y.y+r*(t.y-y.y))):n=new Intersection("No Intersection")}else n=new Intersection(0==i||0==s?"Coincident":"Parallel");return n},Intersection.intersectLinePolygon=function(y,t,e){for(var x=new Intersection("No Intersection"),n=e.length,i=0;i<n;i++){var s=e[i],o=e[(i+1)%n],r=Intersection.intersectLineLine(y,t,s,o);x.appendPoints(r.points)}return x.points.length>0&&(x.status="Intersection"),x},Intersection.intersectLineRectangle=function(y,t,e,x){var n=e.min(x),i=e.max(x),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectLineLine(n,s,y,t),a=Intersection.intersectLineLine(s,i,y,t),c=Intersection.intersectLineLine(i,o,y,t),p=Intersection.intersectLineLine(o,n,y,t),l=new Intersection("No Intersection");return l.appendPoints(r.points),l.appendPoints(a.points),l.appendPoints(c.points),l.appendPoints(p.points),l.points.length>0&&(l.status="Intersection"),l},Intersection.intersectPolygonPolygon=function(y,t){for(var e=new Intersection("No Intersection"),x=y.length,n=0;n<x;n++){var i=y[n],s=y[(n+1)%x],o=Intersection.intersectLinePolygon(i,s,t);e.appendPoints(o.points)}return e.points.length>0&&(e.status="Intersection"),e},Intersection.intersectPolygonRectangle=function(y,t,e){var x=t.min(e),n=t.max(e),i=new Point2D(n.x,x.y),s=new Point2D(x.x,n.y),o=Intersection.intersectLinePolygon(x,i,y),r=Intersection.intersectLinePolygon(i,n,y),a=Intersection.intersectLinePolygon(n,s,y),c=Intersection.intersectLinePolygon(s,x,y),p=new Intersection("No Intersection");return p.appendPoints(o.points),p.appendPoints(r.points),p.appendPoints(a.points),p.appendPoints(c.points),p.points.length>0&&(p.status="Intersection"),p},Intersection.intersectRayRay=function(y,t,e,x){var n,i=(x.x-e.x)*(y.y-e.y)-(x.y-e.y)*(y.x-e.x),s=(t.x-y.x)*(y.y-e.y)-(t.y-y.y)*(y.x-e.x),o=(x.y-e.y)*(t.x-y.x)-(x.x-e.x)*(t.y-y.y);if(0!=o){var r=i/o;(n=new Intersection("Intersection")).points.push(new Point2D(y.x+r*(t.x-y.x),y.y+r*(t.y-y.y)))}else n=new Intersection(0==i||0==s?"Coincident":"Parallel");return n},Intersection.intersectRectangleRectangle=function(y,t,e,x){var n=y.min(t),i=y.max(t),s=new Point2D(i.x,n.y),o=new Point2D(n.x,i.y),r=Intersection.intersectLineRectangle(n,s,e,x),a=Intersection.intersectLineRectangle(s,i,e,x),c=Intersection.intersectLineRectangle(i,o,e,x),p=Intersection.intersectLineRectangle(o,n,e,x),l=new Intersection("No Intersection");return l.appendPoints(r.points),l.appendPoints(a.points),l.appendPoints(c.points),l.appendPoints(p.points),l.points.length>0&&(l.status="Intersection"),l},Intersection.bezout=function(y,t){var e=y[0]*t[1]-t[0]*y[1],x=y[0]*t[2]-t[0]*y[2],n=y[0]*t[3]-t[0]*y[3],i=y[0]*t[4]-t[0]*y[4],s=y[0]*t[5]-t[0]*y[5],o=y[1]*t[2]-t[1]*y[2],r=y[1]*t[4]-t[1]*y[4],a=y[1]*t[5]-t[1]*y[5],c=y[2]*t[3]-t[2]*y[3],p=y[3]*t[4]-t[3]*y[4],l=y[3]*t[5]-t[3]*y[5],h=a+p,d=r-c;return new Polynomial(e*o-x*x,e*d+n*o-2*x*i,e*h+n*d-i*i-2*x*s,e*l+n*h-2*i*s,n*l-s*s)},lifeCnt>0&&(document.onkeydown=function(y){switch($("#spaceship").css("opacity","1"),y.keyCode){case 68:turn=1;break;case 65:turn=-1;break;case 87:thrust=1;break;case 83:thrust=-1;break;case 32:pewpew();break;case 13:hyperspace();break;case 8:case 46:boom()}},document.onkeyup=function(y){switch(y.keyCode){case 65:case 68:turn=0;break;case 87:case 83:thrust=0;break;case 32:endpew()}},$(document).on("touchstart"," .gameBtn",function(y){$("#spaceship").css("opacity","1");var t=y.target.id;switch(console.log(t),t){case"btnLeft":turn=-1;break;case"btnRight":turn=1;break;case"btnUp":thrust=1;break;case"btnDown":thrust=-1;break;case"btnShoot":case"glyphShoot":pewpew();break;case"btnHS":hyperspace()}}),$(document).on("touchend",".gameBtn",function(y){switch(y.target.id){case"btnLeft":case"btnRight":turn=0;break;case"btnUp":case"btnDown":thrust=0;break;case"glyphLeft":turn=0;break;case"btnShoot":endpew()}}));